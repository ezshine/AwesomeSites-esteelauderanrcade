(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{223:function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"d",(function(){return a})),i.d(e,"e",(function(){return n})),i.d(e,"c",(function(){return h})),i.d(e,"a",(function(){return l}));var s=i(1),o=s.vec3.create();function r(t,e){return e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function a(t){return r(t,s.vec3.create())}function n(t,e){const i=r(t,s.vec3.create());return i[0]*=e,i[1]*=e,i[2]*=e,i}function h(t,e,i){const s=t>>16,o=t>>8&255,r=255&t;return(s+i*((e>>16)-s)<<16)+(o+i*((e>>8&255)-o)<<8)+(0|r+i*((255&e)-r))}function l(t,e,i){return function(t){o[0]=(t>>16&255)/255,o[1]=(t>>8&255)/255,o[2]=(255&t)/255}(t),i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=e,i}},225:function(t,e,i){"use strict";i.d(e,"b",(function(){return u})),i.d(e,"a",(function(){return d}));var s=i(29),o=i(36),r=i(17);class a extends r.b{constructor(t,e,i,s){super(t,e,i,s),this.textureType=r.a.TEXTURE_CUBE,this._target=34067,t.bindTexture(34067,this.id),this.setFilter(!0)}fromImages(t){var e=this.gl,i=this.format,s=this.internal,o=this.type;this.width=t[0].width,this.height=t[0].height,e.bindTexture(34067,this.id),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,s,i,o,t[0]),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,s,i,o,t[1]),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,s,i,o,t[2]),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,s,i,o,t[3]),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,s,i,o,t[4]),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,s,i,o,t[5])}}var n,h=i(37),l=i(35);!function(t){t[t.CLAMP=0]="CLAMP",t[t.REPEAT=1]="REPEAT",t[t.MIRROR=2]="MIRROR"}(n||(n={}));class c extends s.a{constructor(t,e,i){super(t,i),this.request=e}set request(t){this._request=t}get request(){return this._request}get value(){return this.texture}load(){const t=this.group.lodLevel;this.loadLevelAsync(t)}unload(){}async loadLevelAsync(t){const e=this.group.loader.extTextures,[i,s]=l.a.getCodecForRequest(this._request,e);await this.loadSourceLod(s.lods[t]),await i.decodeLod(s,t,e),this.group.loader.upload(this,s.datas);for(let e=0;e<s.lods[t].files.length;e++)this.group.removeResourceByName(s.lods[t].files[e]);this.resolve(this.texture)}async loadSourceLod(t){const e=[];for(let i=0;i<t.files.length;i++)e.push(Object(h.c)(t.files[i],this.group));const i=await Promise.all(e);return t.buffers=i,i}}class u extends c{constructor(t,e,i){super(t,e,i),this.texture=new o.a(this.group.gl)}}class d extends c{constructor(t,e,i){super(t,e,i),this.texture=new a(this.group.gl)}async loadLevelAsync(t){const e=this.group.loader.extTextures,[i,s]=l.a.getCodecForRequest(this._request,e);for(let t=0;t<s.lods.length;t++)await this.loadSourceLod(s.lods[t]);await i.decodeCube(s,e),this.group.loader.upload(this,s.datas);for(let t=0;t<s.lods.length;t++)for(let e=0;e<s.lods[t].files.length;e++)this.group.removeResourceByName(s.lods[t].files[e]);this.resolve(this.texture)}}},229:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var s=i(14);const o=["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"],r=["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"],a=["WEBGL_compressed_texture_etc1","WEBKIT_WEBGL_compressed_texture_etc1"],n=["WEBGL_compressed_texture_astc"];class h{constructor(t){this.gl=t,this.dxt=this.pickExtension(o),this.pvr=this.pickExtension(r),this.etc=this.pickExtension(a),this.astc=this.pickExtension(n)}pickExtension(t){let e=null;for(const i of t)if(e=this.gl.getExtension(i),e)break;return e}}var l=i(17),c=i(19);class u{constructor(t){this.gl=t,this.extTextures=new h(t),this.extAniso=t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||t.getExtension("EXT_texture_filter_anisotropic")}upload(t,e){this.gl;const i=t.texture;if(i.textureType!==e.textureType)throw new Error("TexturesLoader::upload() texture type mismatch");switch(i.bind(),i.textureType){case l.a.TEXTURE_2D:this.uploadTexture2D(i,e,0);break;case l.a.TEXTURE_CUBE:this.uploadTextureCube(i,e,0)}}uploadTexture2D(t,e,i=0){this.uploadAllSurfaceLevels(t,e,i,0,t.textureType)}uploadTextureCube(t,e,i=0){for(let s=0;s<6;s++){const o=Object(c.b)(s);this.uploadAllSurfaceLevels(t,e,i,s,o)}}uploadAllSurfaceLevels(t,e,i,s,o){switch(e.datatype){case c.a.RAW_COMPRESSED:this.uploadLevelsCompressed(t,e,i,s,o);break;case c.a.IMAGE:this.uploadLevels(t,e,i,s,o);break;case c.a.RAW:this.uploadLevelsRaw(t,e,i,s,o)}}uploadLevels(t,e,i,s,o){const r=e.sources[i].surfaces[s];for(let t=0;t<r.length;t++)this.gl.texImage2D(o,t,e.internalformat,e.format,e.type,r[t].data)}uploadLevelsRaw(t,e,i,s,o){const r=e.sources[i].surfaces[s];for(let t=0;t<r.length;t++){const i=r[t];this.gl.texImage2D(o,t,e.internalformat,i.width,i.height,0,e.format,e.type,i.data)}}uploadLevelsCompressed(t,e,i,s,o){const r=e.sources[i].surfaces[s];let a=r[0].width,n=r[0].height;for(let t=0;t<r.length;t++){const i=r[t];this.gl.compressedTexImage2D(o,t,e.internalformat,a,n,0,i.data),a=Math.max(1,a>>1),n=Math.max(1,n>>1)}}}class d extends s.a{constructor(t="default",e,i=s.a.default){super(t,i),this._lodLevel=0,this.gl=e,this.loader=new u(e)}set lodLevel(t){this._lodLevel=t}get lodLevel(){return this._lodLevel}}},235:function(t,e,i){"use strict";var s,o;i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return a})),function(t){t[t.CLAMP=0]="CLAMP",t[t.REPEAT=1]="REPEAT",t[t.MIRROR=2]="MIRROR"}(s||(s={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(o||(o={}));class r{constructor(t){"string"==typeof t&&(t={std:t}),this.sources=[];for(const e in t){const i=t[e];this.sources.push({codec:e,lods:[{files:[i],buffers:null}],datas:null})}}}class a{constructor(t){this.sources=[];for(const e in t){let i=[];for(let s=0;s<t[e].length;s++)i.push({files:[t[e][s]],buffers:null});this.sources.push({codec:e,lods:i,datas:null})}}}},286:function(t,e){var i=function(t){return"\n#define PI 3.141592653589793\n\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\nvec3 dithering( vec3 color ) {\n    float grid_position = rand( gl_FragCoord.xy );\n    vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n    dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n    return color + dither_shift_RGB;\n}","\n#define PI 3.141592653589793\n\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\nvec3 dithering( vec3 color ) {\n    float grid_position = rand( gl_FragCoord.xy );\n    vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n    dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n    return color + dither_shift_RGB;\n}"};i.toString=i,t.exports=i},287:function(t,e,i){var s=i(484);"string"==typeof s&&(s=[[t.i,s,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(11)(s,o);s.locals&&(t.exports=s.locals)},288:function(t,e,i){var s=i(486);"string"==typeof s&&(s=[[t.i,s,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(11)(s,o);s.locals&&(t.exports=s.locals)},455:function(t,e){var i=function(t){return"precision mediump float;\n\nuniform sampler2D tInput;\n\nuniform vec3 uKernel[BLUR_SAMPLES];\nvarying vec2 vTexCoordVP;\n\nvoid main(void)\n{\n\n  vec4 color = vec4( 0.0 );\n\n  for(int i=0; i<BLUR_SAMPLES; ++i)\n  {\n    vec3 kernel = uKernel[i];\n    color += texture2D( tInput, vTexCoordVP + kernel.xy ) * kernel.z;\n  }\n\n  gl_FragColor = color;\n\n}\n","precision mediump float;\n\nuniform sampler2D tInput;\n\nuniform vec3 uKernel[BLUR_SAMPLES];\nvarying vec2 vTexCoordVP;\n\nvoid main(void)\n{\n\n  vec4 color = vec4( 0.0 );\n\n  for(int i=0; i<BLUR_SAMPLES; ++i)\n  {\n    vec3 kernel = uKernel[i];\n    color += texture2D( tInput, vTexCoordVP + kernel.xy ) * kernel.z;\n  }\n\n  gl_FragColor = color;\n\n}\n"};i.toString=i,t.exports=i},456:function(t,e){var i=function(t){return"\n\n{\n  c.rgb += texture2D(uGlowTexture, texCoordVP).rgb * uGlowIntensity;\n}","\n\n{\n  c.rgb += texture2D(uGlowTexture, texCoordVP).rgb * uGlowIntensity;\n}"};i.toString=i,t.exports=i},457:function(t,e){var i=function(t){return"\nuniform sampler2D uGlowTexture;\nuniform float uGlowIntensity;","\nuniform sampler2D uGlowTexture;\nuniform float uGlowIntensity;"};i.toString=i,t.exports=i},458:function(t,e){var i=function(t){return"{\n    \n    vec3 gradientOverlayColor = dithering(mix(uGradientTop, uGradientBottom, 1.0 - texCoordVP.y));\n    c = blendHardLight(c, gradientOverlayColor, uColorLayerOpacity);\n    // c.rgb = gradientOverlayColor * uColorLayerOpacity;\n}","{\n    \n    vec3 gradientOverlayColor = dithering(mix(uGradientTop, uGradientBottom, 1.0 - texCoordVP.y));\n    c = blendHardLight(c, gradientOverlayColor, uColorLayerOpacity);\n    // c.rgb = gradientOverlayColor * uColorLayerOpacity;\n}"};i.toString=i,t.exports=i},459:function(t,e,i){var s=function(t){var e="";return e+="\nuniform vec3 uGradientTop;\nuniform vec3 uGradientBottom;\nuniform float uColorLayerOpacity;\n\nfloat blendOverlay(float base, float blend) {\n\treturn base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend) {\n\treturn vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n}\n\nvec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n\treturn (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nvec3 blendHardLight(vec3 base, vec3 blend) {\n\treturn blendOverlay(blend,base);\n}\n\nvec3 blendHardLight(vec3 base, vec3 blend, float opacity) {\n\treturn (blendHardLight(base, blend) * opacity + base * (1.0 - opacity));\n}\n\n"+i(286)()};s.toString=s,t.exports=s},460:function(t,e){var i=function(t){return"{\n    float grey = 0.21 * c.r + 0.71 * c.g + 0.07 * c.b;\n    c = c.rgb * (1.0 - uGrayscaleAmount) + (grey * uGrayscaleAmount);\n}","{\n    float grey = 0.21 * c.r + 0.71 * c.g + 0.07 * c.b;\n    c = c.rgb * (1.0 - uGrayscaleAmount) + (grey * uGrayscaleAmount);\n}"};i.toString=i,t.exports=i},461:function(t,e){var i=function(t){return"uniform float uGrayscaleAmount;","uniform float uGrayscaleAmount;"};i.toString=i,t.exports=i},462:function(t,e){var i=function(t){return"attribute vec2 aPosition;\nattribute vec2 aTextureCoord;\n\n#ifdef HAS_vertexColor\n  attribute vec4 aColor;\n  varying vec4 vColor;\n#endif\n\nuniform mat4 uProjection;\n\nvarying vec2 vUv;\n\n\nvoid main(void){\n  vUv = aTextureCoord;\n\n  #ifdef HAS_vertexColor\n  vColor = aColor;\n  #endif\n\n  gl_Position = uProjection * vec4(aPosition, 0.0, 1.0);\n}","attribute vec2 aPosition;\nattribute vec2 aTextureCoord;\n\n#ifdef HAS_vertexColor\n  attribute vec4 aColor;\n  varying vec4 vColor;\n#endif\n\nuniform mat4 uProjection;\n\nvarying vec2 vUv;\n\n\nvoid main(void){\n  vUv = aTextureCoord;\n\n  #ifdef HAS_vertexColor\n  vColor = aColor;\n  #endif\n\n  gl_Position = uProjection * vec4(aPosition, 0.0, 1.0);\n}"};i.toString=i,t.exports=i},463:function(t,e){var i=function(t){return"uniform sampler2D uTexture;\nuniform sampler2D uAlphaTexture;\n\nvarying vec2 vUv;\nvarying vec4 vColor;\n\nvoid main(void){\n    vec4 DiffuseColor = texture2D(uTexture, vUv);\n    vec4 datas = texture2D(uAlphaTexture, vUv);\n\n\tDiffuseColor.rgb *= vColor.rgb;\n\n    float newAlpha = datas.r * vColor.a;\n\n    gl_FragColor = vec4(DiffuseColor.rgb, datas.r * vColor.a);\n}  ","uniform sampler2D uTexture;\nuniform sampler2D uAlphaTexture;\n\nvarying vec2 vUv;\nvarying vec4 vColor;\n\nvoid main(void){\n    vec4 DiffuseColor = texture2D(uTexture, vUv);\n    vec4 datas = texture2D(uAlphaTexture, vUv);\n\n\tDiffuseColor.rgb *= vColor.rgb;\n\n    float newAlpha = datas.r * vColor.a;\n\n    gl_FragColor = vec4(DiffuseColor.rgb, datas.r * vColor.a);\n}  "};i.toString=i,t.exports=i},464:function(t,e){var i=function(t){return"uniform sampler2D uTexture;\n\nvarying vec2 vUv;\n\nvoid main(void){\n    vec4 DiffuseColor = texture2D(uTexture, vUv);\n    gl_FragColor = DiffuseColor;\n}  ","uniform sampler2D uTexture;\n\nvarying vec2 vUv;\n\nvoid main(void){\n    vec4 DiffuseColor = texture2D(uTexture, vUv);\n    gl_FragColor = DiffuseColor;\n}  "};i.toString=i,t.exports=i},465:function(t,e){var i=function(t){return"attribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord0;\n  \nvoid main( void ){\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord0 = aTexCoord;\n}\n","attribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord0;\n  \nvoid main( void ){\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord0 = aTexCoord;\n}\n"};i.toString=i,t.exports=i},466:function(t,e){var i=function(t){return"varying vec2 vTexCoord0;\n\nuniform sampler2D tTex;\n\nvoid main(void){\n  gl_FragColor = texture2D( tTex, vTexCoord0 );\n}\n","varying vec2 vTexCoord0;\n\nuniform sampler2D tTex;\n\nvoid main(void){\n  gl_FragColor = texture2D( tTex, vTexCoord0 );\n}\n"};i.toString=i,t.exports=i},467:function(t,e,i){var s=function(t){var e="";return e+="uniform sampler2D uRamp;\nuniform float uRampWidth;\nuniform float uOpacity;\n\nvarying vec2 vUv;\n\n"+i(286)()+"\n\nvec2 center = vec2(0.5);\n\nvoid main(void){\n    vec2 st = vUv;\n    float mixValue = distance(vUv, center) * 2.0;\n\n    float u = (mixValue * (uRampWidth - 1.) + .5) / uRampWidth;\n    float v = 0.5;\n\n    vec4 color = texture2D(uRamp, vec2(u, v));\n\n    gl_FragColor = vec4(dithering(color.rgb), color.a * uOpacity);\n}  "};s.toString=s,t.exports=s},468:function(t,e,i){var s=function(t){var e="";return e+="uniform sampler2D uRamp;\nuniform float uRampWidth;\nuniform float uOpacity;\n\nvarying vec2 vUv;\n\n"+i(286)()+"\n\nvoid main(void){\n    float u = (vUv.y * (uRampWidth - 1.) + .5) / uRampWidth;\n    float v = 0.5;\n\n    vec4 color = texture2D(uRamp, vec2(u, v));\n\n    gl_FragColor = vec4(dithering(color.rgb), color.a * uOpacity);\n}  "};s.toString=s,t.exports=s},469:function(t,e){var i=function(t){return"attribute vec2 aPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aTextureCoord2;\n\nuniform mat4 uProjection;\n\nvarying vec2 vUv;\nvarying vec2 vUv2;\n\nvoid main(void){\n  vUv = aTextureCoord;\n  vUv2 = aTextureCoord2;\n  gl_Position = uProjection * vec4(aPosition, 0.0, 1.0);\n}","attribute vec2 aPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aTextureCoord2;\n\nuniform mat4 uProjection;\n\nvarying vec2 vUv;\nvarying vec2 vUv2;\n\nvoid main(void){\n  vUv = aTextureCoord;\n  vUv2 = aTextureCoord2;\n  gl_Position = uProjection * vec4(aPosition, 0.0, 1.0);\n}"};i.toString=i,t.exports=i},470:function(t,e){var i=function(t){return"uniform sampler2D uTextureMap;\nuniform vec3 uPlanetColor;\nuniform vec3 uRimColor;\nuniform vec3 uRimShape;\nuniform vec3 uPlanetShape;\n\nvarying vec2 vUv;\nvarying vec2 vUv2;\n\nfloat circle(vec2 pos, float radius){\n    vec2 dist = (vUv2 * vec2(1.0, 0.3) + vec2(0.0, 0.5)) - pos;\n\treturn 1.0 - smoothstep(radius, radius, dot(dist, dist) * 4.0);\n}\n\nvoid main(void){\n    vec4 mapColor = texture2D(uTextureMap, vUv);\n    float rimShape = circle(uRimShape.xy, uRimShape.z);\n    float planetShape = circle(uPlanetShape.xy, uPlanetShape.z);\n    vec4 color = vec4(1.0);\n\n    planetShape = step(0.5, planetShape);\n\n    color.rgb = mapColor.rgb * mapColor.b + uPlanetColor.rgb * (1.0 - mapColor.b);\n\n    color = mix(vec4(uRimColor, rimShape), color, planetShape);\n\n    gl_FragColor = color;\n}  ","uniform sampler2D uTextureMap;\nuniform vec3 uPlanetColor;\nuniform vec3 uRimColor;\nuniform vec3 uRimShape;\nuniform vec3 uPlanetShape;\n\nvarying vec2 vUv;\nvarying vec2 vUv2;\n\nfloat circle(vec2 pos, float radius){\n    vec2 dist = (vUv2 * vec2(1.0, 0.3) + vec2(0.0, 0.5)) - pos;\n\treturn 1.0 - smoothstep(radius, radius, dot(dist, dist) * 4.0);\n}\n\nvoid main(void){\n    vec4 mapColor = texture2D(uTextureMap, vUv);\n    float rimShape = circle(uRimShape.xy, uRimShape.z);\n    float planetShape = circle(uPlanetShape.xy, uPlanetShape.z);\n    vec4 color = vec4(1.0);\n\n    planetShape = step(0.5, planetShape);\n\n    color.rgb = mapColor.rgb * mapColor.b + uPlanetColor.rgb * (1.0 - mapColor.b);\n\n    color = mix(vec4(uRimColor, rimShape), color, planetShape);\n\n    gl_FragColor = color;\n}  "};i.toString=i,t.exports=i},471:function(t,e){var i=function(t){return"attribute vec2 aPosition;\nattribute vec4 aColor;\nattribute float aSize;\n\nuniform mat4 uProjection;\n\nvarying vec4 vColor;\n\nvoid main(void){\n  vColor = aColor;\n  gl_Position = uProjection * vec4(aPosition, 0.0, 1.0);\n  gl_PointSize = aSize;\n}","attribute vec2 aPosition;\nattribute vec4 aColor;\nattribute float aSize;\n\nuniform mat4 uProjection;\n\nvarying vec4 vColor;\n\nvoid main(void){\n  vColor = aColor;\n  gl_Position = uProjection * vec4(aPosition, 0.0, 1.0);\n  gl_PointSize = aSize;\n}"};i.toString=i,t.exports=i},472:function(t,e){var i=function(t){return"varying vec4 vColor;\n\nvoid main(void){\n    vec4 color = vColor;\n\n    if(color.a == 0.0){\n        discard;\n    }\n\n    gl_FragColor = color;\n}  ","varying vec4 vColor;\n\nvoid main(void){\n    vec4 color = vColor;\n\n    if(color.a == 0.0){\n        discard;\n    }\n\n    gl_FragColor = color;\n}  "};i.toString=i,t.exports=i},473:function(t,e){var i=function(t){return"attribute vec2 aPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aTextureSize;\nattribute vec4 aColor;\nattribute float aSize;\n\nuniform mat4 uProjection;\n\nvarying vec2 vUv;\nvarying vec4 vColor;\nvarying vec2 vTextureSize;\n\nvoid main(void){\n  vUv = aTextureCoord;\n  vTextureSize = aTextureSize;\n  vColor = aColor;\n  gl_Position = uProjection * vec4(aPosition, 0.0, 1.0);\n  gl_PointSize = aSize;\n}","attribute vec2 aPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aTextureSize;\nattribute vec4 aColor;\nattribute float aSize;\n\nuniform mat4 uProjection;\n\nvarying vec2 vUv;\nvarying vec4 vColor;\nvarying vec2 vTextureSize;\n\nvoid main(void){\n  vUv = aTextureCoord;\n  vTextureSize = aTextureSize;\n  vColor = aColor;\n  gl_Position = uProjection * vec4(aPosition, 0.0, 1.0);\n  gl_PointSize = aSize;\n}"};i.toString=i,t.exports=i},474:function(t,e){var i=function(t){return"uniform sampler2D uTexture;\nuniform sampler2D uAlphaTexture;\n\nvarying vec2 vUv;\nvarying vec2 vTextureSize;\nvarying vec4 vColor;\n\nvoid main(void){\n    vec2 uv = vUv + (gl_PointCoord * vTextureSize);\n    vec4 DiffuseColor = texture2D(uTexture, uv);\n    vec4 datas = texture2D(uAlphaTexture, uv);\n    vec4 color = vec4(DiffuseColor.rgb * vColor.rgb, vColor.a * datas.r);\n\n    if(color.a == 0.0){\n        discard;\n    }\n\n    gl_FragColor = color;\n}  ","uniform sampler2D uTexture;\nuniform sampler2D uAlphaTexture;\n\nvarying vec2 vUv;\nvarying vec2 vTextureSize;\nvarying vec4 vColor;\n\nvoid main(void){\n    vec2 uv = vUv + (gl_PointCoord * vTextureSize);\n    vec4 DiffuseColor = texture2D(uTexture, uv);\n    vec4 datas = texture2D(uAlphaTexture, uv);\n    vec4 color = vec4(DiffuseColor.rgb * vColor.rgb, vColor.a * datas.r);\n\n    if(color.a == 0.0){\n        discard;\n    }\n\n    gl_FragColor = color;\n}  "};i.toString=i,t.exports=i},475:function(t,e,i){t.exports=i.p+"assets/img/logo-serum-quest-f8eb49c0.png"},476:function(t,e,i){t.exports=i.p+"assets/img/poster-game3-rule1-ce10448b.jpg"},477:function(t,e,i){t.exports=i.p+"assets/img/poster-game3-rule2-92a4ccce.jpg"},478:function(t,e,i){t.exports=i.p+"assets/img/poster-game3-rule3-c18779b9.jpg"},479:function(t,e,i){var s={"./share-challenge-game-3-desktop.png":480,"./share-challenge-game-3-mobile.png":481};function o(t){var e=r(t);return i(e)}function r(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}o.keys=function(){return Object.keys(s)},o.resolve=r,t.exports=o,o.id=479},480:function(t,e,i){t.exports=i.p+"assets/img/share-challenge-game-3-desktop-06f3659d.png"},481:function(t,e,i){t.exports=i.p+"assets/img/share-challenge-game-3-mobile-5a266b8d.png"},482:function(t,e,i){t.exports=i.p+"assets/img/share-game-3-21d6856a.png"},483:function(t,e,i){"use strict";var s=i(287);i.n(s).a},484:function(t,e,i){(t.exports=i(10)(!1)).push([t.i,".c-ScorePopup[data-v-70ee53ee] {\n  position: absolute;\n  font-size: 30px;\n}\n",""])},485:function(t,e,i){"use strict";var s=i(288);i.n(s).a},486:function(t,e,i){(t.exports=i(10)(!1)).push([t.i,".c-Popups[data-v-3dad59d4] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  overflow: hidden;\n}\n",""])},509:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.isLoaded?i("popups",{attrs:{score:t.gameState.score,popupX:t.gameState.popupX,popupY:t.gameState.popupY}}):t._e(),t._v(" "),i("score-ui",{attrs:{active:t.isStarted&&!t.gameState.ended,score:t.gameState.score,health:t.gameState.health}}),t._v(" "),t.isLoaded?i("scoreboard",{attrs:{"is-game-ended":t.gameState.ended,"game-id":t.gameState.gameId,score:t.finalScore,"product-img":this.getResource("share-product"),"push-img":this.getResource("share-push"),"share-game-img":this.getResource("share-game"),"share-game-canvas-img":this.getResource("share-game-canvas"),"share-label":t.t("gaming.score_name_points"),"share-text-y":225,"share-text-x":7,"game-thumbnails":[this.getResource("game-thumbnail-1"),this.getResource("game-thumbnail-2"),this.getResource("game-thumbnail-3"),this.getResource("game-thumbnail-4")]},on:{onRestart:t.onClickRestart}}):t._e(),t._v(" "),i("instructions-panel",{ref:"loader",attrs:{active:t.instructionActive,onStart:t.onStart,title:t.t("gaming.game3_name"),legends:[t.t("gaming.game3_tuto1"),t.labelForDesktop("gaming.game3_tuto2","gaming.game3_tuto2_desktop"),t.t("gaming.game3_tuto3")],videos:["/assets/video/rules/game3-rule1.mp4","/assets/video/rules/game3-rule2.mp4","/assets/video/rules/game3-rule3.mp4"],posters:[this.getResource("poster-rule1"),this.getResource("poster-rule2"),this.getResource("poster-rule3")],background:this.getResource("game-preview"),logo:this.getResource("game-logo")}}),t._v(" "),t.isLoaded?i("PraiseCvs",{ref:"praise",staticClass:"praise-game-3"}):t._e()],1)};s._withStripped=!0;var o=i(235),r=i(225),a=i(229),n=i(40),h=i(232),l=i(38),c=i(29),u=i(37);class d extends c.a{constructor(t,e,i){super(t,i),this.url=e}async load(){try{const t=await Object(u.b)(this.url),e=await t.json();return this.resolve(e),e}catch(t){return console.log(t),this.reject(t),null}}unload(){this._abortCtrl.abort()}}var p,g=i(1),m=i(230),v=i(239),f=i(47),b=i(77),w=i(20),x=i(16),y=i(218);!function(t){t.MUSIC_FULL="MUSIC_FULL",t.COLLECT_BOTTLE="COLLECT_BOTTLE",t.BOTTLE_DEATH="BOTTLE_DEATH",t.BOTTLE_HIT="BOTTLE_HIT",t.EXPLOSION_BLUELIGHT="EXPLOSION_BLUELIGHT",t.EXPLOSION_INFRARED="EXPLOSION_INFRARED",t.EXPLOSION_POLLUTION="EXPLOSION_POLLUTION",t.EXPLOSION_TRAVEL="EXPLOSION_TRAVEL",t.EXPLOSION_ULTRAVIOLET="EXPLOSION_ULTRAVIOLET",t.FIRE_LOOP="FIRE_LOOP",t.HYPE_WORDS="HYPE_WORDS"}(p||(p={}));function _(t){return new Promise(e=>setTimeout(e,1e3*t))}class S{constructor(t){this.group=t,this.lowPassConnected=!1,this._lowpass=0,this.context=this.group.audioModule.context,this.masterDest=this.group.audioModule.masterNode,this.masterGain=this.context.createGain(),this.masterGain.connect(this.masterDest),this.lowpassFilter=this.context.createBiquadFilter(),this.lowpassFilter.type="lowpass",this.lowpassFilter.frequency.value=2e3,this.lowpassMaxFreq=this.context.sampleRate/2,this.group.getAllLoadables().forEach(async t=>{(await t).output=this.masterGain})}playMainTrack(){null==this.soundtrack&&(this.soundtrack=this.group.get(p.MUSIC_FULL).play(.8,!0),this.soundtrack.node.loopEnd=110.347,this.soundtrack.node.loopStart=16.509)}setLowPassActve(t){this.lowPassConnected!=t&&(this.lowPassConnected=t,this.masterGain.disconnect(),this.lowpassFilter.disconnect(),t?(this.masterGain.connect(this.lowpassFilter),this.lowpassFilter.connect(this.masterDest)):this.masterGain.connect(this.masterDest))}set lowpass(t){this._lowpass=Object(y.d)(t),this.setLowPassActve(t>0);const e=Math.pow(this._lowpass,.2);this.lowpassFilter.frequency.value=this.lowpassMaxFreq*(1-.96*e),this.masterGain.gain.value=1-.6*this._lowpass}get lowpass(){return this._lowpass}async playShootTrack(t=0){await _(t),null==this.shootTrack&&(this.shootTrack=this.group.get(p.FIRE_LOOP).play(1,!0)),this.fade(this.shootTrack,.01,1)}pauseShootTrack(){this.shootTrack&&this.fade(this.shootTrack,.5,0)}play(t,e=1){return this.group.get(t).play(e,!1)}async playSFX(t,e=1){this.play(t,e),await this.fade(this.shootTrack,.2,0),await _(.5),await this.fade(this.shootTrack,.2,.8)}fade(t,e=1,i=0){return x.a.killTweensOf(t.gain.gain),x.a.to(t.gain.gain,{duration:e,value:i}).then()}dispose(){var t,e;null===(t=this.soundtrack)||void 0===t||t.dispose(),null===(e=this.shootTrack)||void 0===e||e.dispose(),this.masterGain.disconnect(),this.lowpassFilter.disconnect()}}const T=g.vec3.fromValues(0,0,1);var C=class{constructor(t=null,e=null){this.onRecomputePositions=t,this.onUpdateSize=e,this.anchor=g.vec3.fromValues(.5,.5,0),this.size=g.vec2.fromValues(1,1),this.position=g.vec3.create(),this.position2=g.vec2.create(),this.rotation=g.quat.create(),this.scale=g.vec3.fromValues(1,1,1),this.localOrigin=g.vec3.create(),this.worldOrigin=g.vec2.create(),this._matrix=g.mat4.create(),this._wmatrix=g.mat4.create(),this._parent=null,this._children=[],this._invalidM=!0,this._invalidW=!0}updateOrigin(){this.localOrigin[0]=this.size[0]*this.anchor[0],this.localOrigin[1]=this.size[1]*this.anchor[1],this.updateWorldOrigin()}updateWorldOrigin(){this.worldOrigin[0]=this.position[0]+this.localOrigin[0],this.worldOrigin[1]=this.position[1]+this.localOrigin[1]}rotate(t){g.quat.rotateZ(this.rotation,this.rotation,t),this.invalidate()}setRotation(t){g.quat.setAxisAngle(this.rotation,T,t),this.invalidate()}set x(t){this.position[0]=t,this.position2[0]=t,this.updateWorldOrigin(),this.invalidate()}set y(t){this.position[1]=t,this.position2[1]=t,this.updateWorldOrigin(),this.invalidate()}get x(){return this.position[0]}get y(){return this.position[1]}set width(t){this.size[0]=t,this.updateOrigin(),this.onUpdateSize&&this.onUpdateSize(),this.invalidate()}set height(t){this.size[1]=t,this.updateOrigin(),this.onUpdateSize&&this.onUpdateSize(),this.invalidate()}get width(){return this.size[0]}get height(){return this.size[1]}set scaleX(t){this.scale[0]=t,this.invalidate()}set scaleY(t){this.scale[1]=t,this.invalidate()}get scaleX(){return this.scale[0]}get scaleY(){return this.scale[1]}setSize(t,e){this.size[0]=t,this.size[1]=e,this.onUpdateSize&&this.onUpdateSize(),this.updateOrigin(),this.invalidate()}setScale(t){this.scale[0]=this.scale[1]=this.scale[2]=t,this.invalidate()}add(t){-1===this._children.indexOf(t)&&(null!==t._parent&&t._parent.remove(t),this._children.push(t),t._parent=this)}remove(t){const e=this._children.indexOf(t);e>-1&&(this._children.splice(e,1),t._parent=null)}invalidate(){this._invalidM=!0,this._invalidW=!0}updateMatrix(){this._invalidM&&(g.mat4.fromRotationTranslationScaleOrigin(this._matrix,this.rotation,this.position,this.scale,this.localOrigin),this._invalidM=!1)}updateWorldMatrix(t=!1){this.updateMatrix();const e=this._hasInvalidWorldMatrix(t);e&&this._computeWorldMatrix(t);for(var i=0;i<this._children.length;i++){var s=this._children[i];s._invalidW=s._invalidW||e,s.updateWorldMatrix(!0)}}_computeWorldMatrix(t){const e=this._parent;null!==e?(!t&&e._hasInvalidWorldMatrix(!1)&&(e.updateMatrix(),e._computeWorldMatrix(!1)),g.mat4.multiply(this._wmatrix,e._wmatrix,this._matrix)):g.mat4.copy(this._wmatrix,this._matrix),this.onRecomputePositions&&this.onRecomputePositions(),this._invalidW=!1}_hasInvalidWorldMatrix(t){return this._invalidW||!t&&null!==this._parent&&this._parent._hasInvalidWorldMatrix(!1)}};class P{constructor(t,e){this.rgbTexture=t,this.alphaTexture=e,t.bind(),t.setFilter(!1),e&&(e.bind(),e.setFilter(!1))}static createFromResource(t,e){return new P(e.get(""+t),e.get(t+"-alpha"))}}class A{constructor(t,e,i,s){this.textures=t,this.srcWidth=i,this.srcHeight=s,this.matrix=g.mat4.create(),this.width=e.w,this.height=e.h,this.x=e.x,this.y=e.y,g.mat4.fromTranslation(this.matrix,[this.x/this.srcWidth,this.y/this.srcHeight,0]),g.mat4.scale(this.matrix,this.matrix,[this.width/this.srcWidth,this.height/this.srcHeight,1])}}var M=i(78);class E{constructor(t,e=!0,i=25){this.frames=t,this.loop=e,this.fps=i,this.currentTime=0,this.frameStartTime=0,this.currentFrameId=0,this.duration=0,this.frameDuration=1/this.fps,this.nbFrames=t.length,this._ended=new M.a}setSprite(t){t.root.x+=.5*t.root.width,t.root.y+=.5*t.root.height,t.applyFrame(this.frames[0]),t.root.x-=.5*t.root.width,t.root.y-=.5*t.root.height,this.sprite=t}play(){return this.currentFrameId=0,this.frameStartTime=0,new Promise((t,e)=>{this._ended.on(()=>{this._ended.release(),t(this)})})}incrementFrame(){if(this.currentFrameId++,this.frameStartTime=this.currentTime,this.currentFrameId>=this.nbFrames-1){if(!this.loop)return void this._ended.emit();this.currentFrameId=0}this.applyFrame(this.frames[this.currentFrameId])}applyFrame(t){this.sprite&&(this.sprite.uvmatrix=t.matrix,this.sprite.computeUvs())}update(t){this.currentTime+=t,this.currentTime-this.frameStartTime>this.frameDuration&&this.incrementFrame()}}class R{constructor(t,e){this.textures=t,this.atlas=e,this.width=this.atlas.meta.size.w,this.height=this.atlas.meta.size.h}getFrame(t,e=!0){return new A(this.textures,this.atlas.frames[e?t+".png":t].frame,this.width,this.height)}getAnimation(t,e=!0,i=25){const s=new RegExp(`^${t}[-_][0-9]+.`),o=Object.keys(this.atlas.frames).filter(t=>s.test(t)).map(t=>this.getFrame(t,!1));return new E(o,e,i)}}var L=i(234),O=i(222),D=i(455),I=i.n(D),F=i(267),k=i.n(F),z=i(456),U=i.n(z),V=i(457),B=i.n(V),N=i(76);class G extends O.b{constructor(){super(),this._code=U()(),this._preCode=B()(),this.glowTexture=null,this.blurSamples=2,this.blurKernelH=new Float32Array(3*(2*this.blurSamples+1)),this.blurKernelV=new Float32Array(3*(2*this.blurSamples+1)),this.intensity=1,this.fboBlurV=null,this.fboBlurH=null,this.prgBlur=null}genFbo(){const t=this.post.gl,e=new b.a(t);e.bind();const i=e.attachColor(t.RGBA).target;return i.bind(),i.setFilter(!0,!1,!1),i.clamp(),e}init(t,e){const i=this.post.gl;this.fboBlurH=this.genFbo(),this.fboBlurV=this.genFbo();var s="\n";s+="precision highp float;\n",s+="#define BLUR_SAMPLES "+(2*this.blurSamples+1)+"\n",this.prgBlur=new N.a(i),this.prgBlur.compile(k()(),I()(),s)}release(t,e){this._available&&(this.fboBlurH.dispose(),this.fboBlurV.dispose(),this.glowTexture&&this.glowTexture.dispose(),this.glowTexture=null)}preRender(){const t=this.post,e=t.gl;let i,s;e.viewport(0,0,t.renderWidth/4,t.renderHeight/4),s=this.prgBlur,s.use(),i=this.fboBlurH,e.bindFramebuffer(e.FRAMEBUFFER,i.fbo),i.clear(),s.tInput(this.glowTexture),s.uKernel(this.blurKernelH),t.fillScreen(s),i=this.fboBlurV,e.bindFramebuffer(e.FRAMEBUFFER,i.fbo),i.clear(),s.tInput(this.fboBlurH.getColor(0)),s.uKernel(this.blurKernelV),t.fillScreen(s)}genCode(t,e){t.push(this._preCode),e.push(this._code)}setupProgram(t){t.uGlowTexture(this.fboBlurV.getColor(0)),t.uGlowIntensity(this.intensity)}resize(){const t=this.post.bufferWidth/4,e=this.post.bufferHeight/4;t>1&&e>1&&(this.fboBlurH.resize(t,e),this.fboBlurV.resize(t,e)),this.computeKernel(!0,this.blurKernelH),this.computeKernel(!1,this.blurKernelV)}computeKernel(t,e){const i=this.post.bufferWidth/4,s=this.post.bufferHeight/4,o=2*this.blurSamples+1,r=t?i:s,a=t?s:i,n=.5/r,h=t?0:1,l=t?1:0;for(var c=0,u=0;u<o;++u){var d=3*u,p=2*u/(o-1)-1,g=3*p;c+=g=Math.exp(-g*g/2),e[d+h]=n+2*this.blurSamples*p/r,e[d+l]=(c%2==0?.5:-.5)/a,e[d+2]=g}for(u=0;u<o;++u)e[3*u+2]/=c}}var W=i(458),X=i.n(W),j=i(459),H=i.n(j);class Y extends O.b{constructor(){super(),this._flags|=O.b.NEED_LINEAR,this._code=X()(),this._preCode=H()(),this.colorTop=g.vec3.fromValues(1,0,0),this.colorBottom=g.vec3.fromValues(0,0,1),this.opacity=1}init(t,e){}release(t,e){}preRender(){}genCode(t,e){t.push(this._preCode),e.push(this._code)}setupProgram(t){t.uGradientTop(this.colorTop),t.uGradientBottom(this.colorBottom),t.uColorLayerOpacity(this.opacity)}resize(){}}var K=Y,q=i(460),Z=i.n(q),$=i(461),Q=i.n($);class J extends O.b{constructor(){super(),this.amount=0,this._code=Z()(),this._preCode=Q()()}init(){}release(){}preRender(){}genCode(t,e){t.push(this._preCode),e.push(this._code)}setupProgram(t){t.uGrayscaleAmount(this.amount)}resize(t,e){}}class tt extends L.a{constructor(t,e="postprocess"){super(t,e),this.glow=new G,this.addEffect(this.glow),this.grayScale=new J,this.addEffect(this.grayScale)}dispose(){this.post.dispose(),this.glow.release(),this.grayScale.release()}}class et extends L.a{constructor(t,e="postprocess"){super(t,e),this.colorLayer=new K,this.addEffect(this.colorLayer)}dispose(){this.post.dispose()}}var it=i(462),st=i.n(it),ot=i(463),rt=i.n(ot),at=i(464),nt=i.n(at),ht=i(465),lt=i.n(ht),ct=i(466),ut=i.n(ct),dt=i(467),pt=i.n(dt),gt=i(468),mt=i.n(gt),vt=i(469),ft=i.n(vt),bt=i(470),wt=i.n(bt),xt=i(471),yt=i.n(xt),_t=i(472),St=i.n(_t),Tt=i(473),Ct=i.n(Tt),Pt=i(474),At=i.n(Pt);N.a.debug=!1;class Mt{constructor(t){const e=t.gl;this.hasHighp=function(t){const e=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT);return t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0&&e.precision>0}(e),this.programs=[this.default=new N.a(e),this.sprite=new N.a(e),this.radialRamp=new N.a(e),this.linearRamp=new N.a(e),this.screen=new N.a(e),this.particle=new N.a(e),this.texturedParticle=new N.a(e),this.planet=new N.a(e)],this.compile()}precision(){return this.hasHighp?"highp":"mediump"}compile(){var t="\n";t+="precision "+this.precision()+" float;\n",this.default.compile(st()(),nt()(),t),this.sprite.compile(st()(),rt()(),t+"#define HAS_vertexColor 1\n"),this.radialRamp.compile(st()(),pt()(),t),this.linearRamp.compile(st()(),mt()(),t),this.screen.compile(lt()(),ut()(),t),this.particle.compile(yt()(),St()(),t),this.texturedParticle.compile(Ct()(),At()(),t),this.planet.compile(ft()(),wt()(),t),this.process()}process(){for(var t of this.programs)t.use()}dispose(){for(var t of this.programs)t.dispose();this.programs=null}}var Et=i(41),Rt=i(46),Lt=i(85);class Ot{constructor(t,e=100){this._dirty=!0,this.idx=0,this.gl=t,this.size=e,this.totalFloats=32*e,this.vertices=new Float32Array(this.totalFloats);const i=6*e,s=new Uint16Array(i);for(let t=0,e=0;t<i;t+=6,e+=4)s[t+0]=e+0,s[t+1]=e+1,s[t+2]=e+2,s[t+3]=e+0,s[t+4]=e+2,s[t+5]=e+3;this.indices=s,this._vaoMap=new Map;const o=new Et.a(t,this.vertices);o.attrib("aPosition",2,t.FLOAT),o.attrib("aTextureCoord",2,t.FLOAT),o.attrib("aColor",4,t.FLOAT),this.buffers=[o],this.ibuffer=new Rt.a(t,t.UNSIGNED_SHORT,this.indices,t.DYNAMIC_DRAW)}getVao(t){const e=t._cuid.toString();if(!this._vaoMap.has(e)){const i=new Lt.a(this.gl);i.setup(t,this.buffers,this.ibuffer),this._vaoMap.set(e,i)}return this._vaoMap.get(e)}push(t){const e=this.vertices;let i=this.idx;for(let s=0,o=t.positions.length;s<o;s++){const o=t.positions[s],r=t.uvs[s],a=t.color;e[i++]=o[0],e[i++]=o[1],e[i++]=r[0],e[i++]=r[1],e[i++]=a[0],e[i++]=a[1],e[i++]=a[2],e[i++]=a[3]}this.idx=i,this._dirty=!0,this.idx/32>=this.size&&this.flush()}clear(){this.idx=0}flush(){this.render(),this.clear()}bind(t){t.use(),this.program=t,this._currentVao=this.getVao(t),this._currentVao.bind()}useTextures(t){this.program.uTexture(t.rgbTexture),this.program.uAlphaTexture&&t.alphaTexture&&this.program.uAlphaTexture(t.alphaTexture)}render(){const t=this.idx/32;this._dirty&&(this.buffers[0].subData(this.vertices.subarray(0,this.idx),0),this._dirty=!1),t>0&&this.ibuffer.drawTriangles(6*t)}unbind(){this._currentVao.unbind()}dispose(){var t,e;this._vaoMap.forEach(t=>t.dispose()),null===(t=this.ibuffer)||void 0===t||t.dispose(),null===(e=this.buffers[0])||void 0===e||e.dispose()}}const Dt=[g.vec2.fromValues(0,0),g.vec2.fromValues(1,0),g.vec2.fromValues(1,1),g.vec2.fromValues(0,1)];let It=0;class Ft{constructor(){this.uvmatrix=g.mat4.create(),this.color=g.vec4.fromValues(1,1,1,1),this.uvs=[],this.positions=[],this.sizes=[],this.enabled=!0,this.id=It++;for(let t=0;t<4;t++)this.uvs.push(g.vec2.clone(Dt[t])),this.positions.push(g.vec2.clone(Dt[t])),this.sizes.push(g.vec2.clone(Dt[t]));this.root=new C(()=>{this.onMatrixUpdate()},()=>{this.onUpdateSize()})}applyTransform(t,e,i=0,s=1){this.root.x=t,this.root.y=e,this.root.rotate(i),this.root.setScale(s)}applyFrame(t){this.root.setSize(t.width,t.height),this.uvmatrix=t.matrix,this.computeUvs()}get alpha(){return this.color[3]}set alpha(t){this.color[3]=t}computeUvs(){g.vec2.transformMat4(this.uvs[0],Dt[0],this.uvmatrix),g.vec2.transformMat4(this.uvs[1],Dt[1],this.uvmatrix),g.vec2.transformMat4(this.uvs[2],Dt[2],this.uvmatrix),g.vec2.transformMat4(this.uvs[3],Dt[3],this.uvmatrix)}onUpdateSize(){g.vec2.mul(this.sizes[0],Dt[0],this.root.size),g.vec2.mul(this.sizes[1],Dt[1],this.root.size),g.vec2.mul(this.sizes[2],Dt[2],this.root.size),g.vec2.mul(this.sizes[3],Dt[3],this.root.size)}onMatrixUpdate(){this.computePositions()}computePositions(){const t=this.sizes,e=this.root._wmatrix;g.vec2.transformMat4(this.positions[0],t[0],e),g.vec2.transformMat4(this.positions[1],t[1],e),g.vec2.transformMat4(this.positions[2],t[2],e),g.vec2.transformMat4(this.positions[3],t[3],e)}dispose(){}}class kt{constructor(t,e){this.pos=t,this.radius=e}updatePosition(t){g.vec2.copy(this.pos,t)}get x(){return this.pos[0]}get y(){return this.pos[1]}}class zt{constructor(t,e){this.pos=t,this.size=e}updatePosition(t){g.vec2.copy(this.pos,t)}get x(){return this.pos[0]}get y(){return this.pos[1]}get width(){return this.size[0]}get height(){return this.size[1]}}function Ut(t,e){return g.vec2.distance(t.pos,e.pos)<t.radius+e.radius}function Vt(t,e){const i=e.width/2,s=e.height/2,o=Math.abs(t.x-e.x-i),r=Math.abs(t.y-e.y-s),a=t.radius;if(o>i+a)return!1;if(r>s+a)return!1;if(o<=i)return!0;if(r<=s)return!0;const n=o-i,h=r-s;return n*n+h*h<=a*a}class Bt extends Ft{constructor(t,e,i){super(),this.isPlaying=!1,this.animation=t.getAnimation(i,!1,25),this.startFrame=this.animation.frames[0],this.applyFrame(this.startFrame),e.add(this.root),this.animation.setSprite(this),this.root.setScale(2),this.root.x=.5*e.width*e.scaleX-.5*this.root.width*e.scaleX,this.root.y=.5*e.height*e.scaleY-.5*this.root.height*e.scaleY}async play(){this.isPlaying||(this.isPlaying=!0,await this.animation.play(),this.stop())}stop(){this.isPlaying=!1}resize(t,e,i){}dispose(){}update(t,e){this.isPlaying&&this.animation.update(e)}}class Nt extends Ft{constructor(t,e){super(),this.dest=g.vec2.create(),this.speed=g.vec2.create(),this.shootingDirection=g.vec2.fromValues(0,-1),this.tailPosition=g.vec2.create(),this.headPosition=g.vec2.create(),this.bodyCenterPosition=g.vec2.create(),this.isActive=!1,this.isInvincible=!1,this.tailOrigin=g.vec2.create(),this.headOrigin=g.vec2.create(),this.bodyCenterOrigin=g.vec2.create(),this.idleAnimation=t.getAnimation("bottle",!0,25),this.startFrame=this.idleAnimation.frames[0],this.applyFrame(this.startFrame),this.rotation=0,this.collisionFX=new Bt(t,this.root,"collision"),this.bonusFX=new Bt(t,this.root,"bonusfx"),this.collisionBox=new zt(this.root.position2,this.root.size),e.add(this.root),this.setCurrentAnimation(this.idleAnimation)}setCurrentAnimation(t){return this.currentAnimation=t,this.currentAnimation.setSprite(this),this.currentAnimation}start(t,e){const i=.5*t-.5*this.root.width,s=e-this.root.height-.15*e;this.rotation=0,this.collisionFX.stop(),this.bonusFX.stop(),this.root.x=i,this.root.y=s,g.vec2.set(this.dest,i,s),this.isActive=!0}resize(t,e,i){this.root.setScale(i),g.vec2.set(this.tailOrigin,.5*this.root.size[0],this.root.size[1]),g.vec2.set(this.headOrigin,.41*this.root.size[0],-.1*this.root.size[1]),g.vec2.set(this.bodyCenterOrigin,.41*this.root.size[0],.5*this.root.size[1])}clampDest(t){const e=t[2]-t[0]-this.root.width*this.root.scaleX*.5,i=t[3]-t[1]-this.root.height*this.root.scaleY*.5;this.dest[0]<0&&(this.dest[0]=0),this.dest[0]>e&&(this.dest[0]=e),this.dest[1]<this.root.height*this.root.scaleY*.5&&(this.dest[1]=this.root.height*this.root.scaleY*.5),this.dest[1]>i&&(this.dest[1]=i)}setDest(t,e,i){const s=i[2]-i[0],o=i[3]-i[1];g.vec2.set(this.dest,t*s-.5*this.root.width,e*o-.5*this.root.height-this.root.height*this.root.scaleY*.5),this.clampDest(i)}addToDest(t=0,e=0,i){this.dest[0]+=t,this.dest[1]+=e,this.clampDest(i)}testEnemiesCollision(t,e){const{position2:i,size:s}=this.root,o=e.retrieve(i,s);for(let e=0,i=o.length;e<i;e++){const i=t[o[e].id];if(i.alive&&Vt(i.collisionCircle,this.collisionBox))return i.hit(),this.collisionFX.play(),!0}return!1}testCollectiblesCollision(t){for(let e=0,i=t.length;e<i;e++){const i=t[e];if(i.alive&&Vt(i.collisionCircle,this.collisionBox))return i.hit(1,this.root),this.bonusFX.play(),!0}return!1}setInvincible(t=1){this.isInvincible=!0,clearTimeout(this.invicibleTimeout),this.invicibleTimeout=setTimeout(()=>{this.isInvincible=!1},1e3*t)}dispose(){clearTimeout(this.invicibleTimeout),this.bonusFX.dispose(),this.collisionFX.dispose(),super.dispose()}die(){this.isActive=!1}update(t,e){if(g.vec2.subtract(this.speed,this.dest,this.root.position2),this.currentAnimation&&this.currentAnimation.update(e),this.collisionFX.update(t,e),this.bonusFX.update(t,e),this.shootingDirection[0]=.01*this.speed[0],this.isActive){this.root.x+=.2*this.speed[0],this.root.y+=.2*this.speed[1];const t=.006*Object(y.c)(this.speed[0],-200,200);this.rotation+=.2*(t-this.rotation)}this.root.setRotation(this.rotation),g.vec2.transformMat4(this.tailPosition,this.tailOrigin,this.root._matrix),g.vec2.transformMat4(this.headPosition,this.headOrigin,this.root._matrix),g.vec2.transformMat4(this.bodyCenterPosition,this.bodyCenterOrigin,this.root._matrix),g.vec2.subtract(this.shootingDirection,this.headPosition,this.bodyCenterPosition),g.vec2.normalize(this.shootingDirection,this.shootingDirection),this.collisionBox.updatePosition(this.root.position2)}}var Gt=i(65),Wt=i.n(Gt);class Xt{constructor(t=1){this.speed=t}init(t,e=0){this.speed=1+10*e*Math.random(),this.initialVelocityX=.5+.5*Math.random()}update(t,e,i){t.velocity[0]=Math.cos(e*this.speed)*this.initialVelocityX}}class jt{constructor(){this.dir=g.vec2.create()}init(t){}update(t,e,i,s){}}const Ht=[{id:"bl",idle:"blue-light",destruction:"blue-light-destruction",radius:20,scale:1,audio:p.EXPLOSION_BLUELIGHT,comportement:Xt},{id:"ir",idle:"ir",destruction:"ird",radius:30,scale:.85,audio:p.EXPLOSION_INFRARED,comportement:Xt},{id:"uv",idle:"uv",destruction:"uvd",radius:20,scale:.8,audio:p.EXPLOSION_ULTRAVIOLET,comportement:class{constructor(){this.dir=g.vec2.create()}init(t){}update(t,e,i,s){g.vec2.sub(this.dir,s,t.root.position2),g.vec2.normalize(this.dir,this.dir),t.velocity[0]=this.dir[0]}}},{id:"pl",idle:"pl",destruction:"pld",radius:30,scale:.8,audio:p.EXPLOSION_POLLUTION,comportement:jt},{id:"eye",idle:"eye",destruction:"eyed",radius:30,scale:1,audio:p.EXPLOSION_TRAVEL,comportement:jt}];class Yt extends Ft{constructor(t){super(),this.spritesheet=t,this.isZigZag=!1,this.bounds=g.vec4.create(),this.localScale=1,this.hit=(t=1)=>{this.health-=t},this.velocity=g.vec2.create(),this.heroPosition=g.vec2.create(),this.collisionCircle=new kt(this.root.worldOrigin,Math.max(.5*this.root.width,.5*this.root.height))}setCurrentAnimation(t=null){return this.currentAnimation=t,this.currentAnimation.setSprite(this),this.currentAnimation}setCurrentInfos(t){this.infos=t?(t=>{const e=Ht.filter(e=>e.id===t);return e.length?e[0]:null})(t):Ht[Math.floor(Math.random()*Ht.length)],this.localScale=this.infos.scale}spawn(t){this.comportement=new this.infos.comportement,this.idleAnimation=this.spritesheet.getAnimation(this.infos.idle),this.explosionAnimation=this.spritesheet.getAnimation(this.infos.destruction,!1),this.startFrame=this.idleAnimation.frames[0],this.setCurrentAnimation(this.idleAnimation),this.applyFrame(this.startFrame),this.root.x=t[0],this.root.y=t[1],this.root.setRotation(0),this.alive=!0,this.health=1,this.speed=200,this.root.updateWorldMatrix(),g.vec2.set(this.velocity,this.isZigZag?Math.random()<.5?-1:1:0,1)}afterSpawn(t){this.comportement.init(this,t)}resize(t,e){}die(){this.alive=!1}explode(){return this.setCurrentAnimation(this.explosionAnimation).play()}testBulletCollision(t,e){const{position2:i,size:s}=this.root,o=e.retrieve(i,s);for(let e=0,i=o.length;e<i;e++){const i=t[o[e].id];if(Ut(this.collisionCircle,i.collisionCircle))return this.hit(),i.hit(),!0}return!1}update(t,e){const i=this.root;this.currentAnimation&&this.currentAnimation.update(e),this.alive&&(i.x+=this.velocity[0]*this.speed*e*i.scaleX,i.y+=this.velocity[1]*this.speed*e*i.scaleY,this.comportement.update(this,t,e,this.heroPosition),i.rotate(e),this.collisionCircle.updatePosition(i.worldOrigin))}}class Kt{constructor(t,e){this.capacity=t,this.factory=e,this.items=[],this.available=[]}get(){let t;return this.available.length?(t=this.available.pop(),this.factory.reset(t)):this.items.length<this.capacity?t=this.factory.create():(t=this.items.shift(),this.factory.reset(t)),this.items.push(t),t}makeAvailable(t){this.available.push(t)}invalidate(){for(let t=0,e=this.available.length;t<e;t++){const e=this.items.indexOf(this.available[t]);e>=0&&this.items.splice(e,1)}}dispose(){for(let t=0,e=this.items.length;t<e;t++)this.factory.destroy(this.items[t]);for(let t=0,e=this.available.length;t<e;t++)this.factory.destroy(this.available[t])}}class qt{constructor(t,e,i,s,o=100){this.spritesheet=t,this.bounds=e,this.parent=i,this.timeUntilNextSpawn=1,this.spawnPosition=g.vec2.create(),this.spawnVelocity=g.vec2.create(),this.pixelRatio=1,this.isActive=!1,this.pool=new Kt(o,s)}setTimeUntilNextSpawn(){this.timeUntilNextSpawn=1}spawnOne(){this.setTimeUntilNextSpawn();const t=this.pool.get();this.parent.add(t.root),this.onBeforeSpawn(t),t.spawn(this.spawnPosition),this.onAfterSpawn(t)}resize(t,e){g.vec4.copy(this.bounds,t),this.pixelRatio=e,this.pool.items.forEach(t=>{t.root.setScale(e*t.localScale)})}clear(){this.pool.items.forEach(t=>this.pool.makeAvailable(t)),this.pool.invalidate()}onBeforeSpawn(t){}onAfterSpawn(t){t.root.setScale(this.pixelRatio*t.localScale)}async killItem(t,e=!1){t.die(),e&&await t.explode(),this.parent.remove(t.root),this.pool.makeAvailable(t)}isItemOutOfBounds(t){const e=this.bounds[1]+this.bounds[3];return t.root.y>e+t.root.height}start(){this.isActive=!0}stop(){this.isActive=!1}spawnUpdate(t,e){this.isActive&&(this.timeUntilNextSpawn-=e,this.timeUntilNextSpawn<=0&&this.spawnOne())}update(t,e){const i=this.pool.items;for(let s=0,o=i.length;s<o;s++){const o=i[s];if(o.health<=0&&o.alive){this.killItem(o,!0);break}o.update(t,e),this.isItemOutOfBounds(o)&&this.killItem(o)}this.pool.invalidate(),this.spawnUpdate(t,e)}dispose(){this.pool.dispose()}}class Zt{constructor(t=1,e=1){this.duration=t,this.amount=e,this.triggers=[],this.hasStarted=!1,this.hasEndedTriggers=!1,this.hasEndedDuration=!1,this._onCompleteDurationSignal=new M.a,this._onCompleteTriggersSignal=new M.a,this.onCompleteDuration=new Promise(t=>{this._onCompleteDurationSignal.on(()=>{t(this)})}),this.onCompleteTriggers=new Promise(t=>{this._onCompleteTriggersSignal.on(()=>{t(this)})})}start(t){this.hasStarted=!0,this.startTime=t,this.countdown=this.triggers.length}update(t){if(this._currentTriggers=[],this.hasEndedTriggers)return this._currentTriggers;const e=t-this.startTime;for(let t=0,i=this.triggers.length;t<i;t++){const i=this.triggers[t];!i.triggered&&e>=i.t&&(i.triggered=!0,this.countdown--,this._currentTriggers.push(i))}return this.countdown<=0&&this.hasEndedDuration&&(this.hasEndedTriggers=!0,this._onCompleteTriggersSignal.emit(),this._onCompleteTriggersSignal.release()),e>this.duration&&(this.hasEndedDuration||(this.hasEndedDuration=!0,this._onCompleteDurationSignal.emit(),this._onCompleteDurationSignal.release())),this._currentTriggers}}class $t extends Zt{constructor(t=1,e=1,i=[]){super(t,e),this.type="random";for(let t=0;t<e;t++){const t=this._createTrigger();i.length&&(t.type=i[Math.floor(Math.random()*i.length)]),this.triggers.push(t)}}_createTrigger(){return{t:Math.random()*this.duration,position:g.vec2.fromValues(Math.random(),0),velocity:g.vec2.fromValues(2*Math.random()-1,1),speed:Math.random(),triggered:!1}}}class Qt extends Zt{constructor(t=1,e=1,i=0,s=[]){super(t,e),this.type="row",this.duration=Math.max(this.duration,i*e);const o=1/e;for(let t=0;t<e;t++){const e=t*o,r=t*i,a=this._createTrigger(e,r);s.length&&(a.type=s[Math.floor(Math.random()*s.length)]),this.triggers.push(a)}}_createTrigger(t,e=0){return{t:e,position:g.vec2.fromValues(t,0),velocity:g.vec2.fromValues(0,1),speed:1,triggered:!1}}}class Jt extends Zt{constructor(t=1,e=1,i=0,s=[]){super(t,e),this.type="row";const o=1/e;for(let t=0;t<e;t++){const r=t*o+.25*o,a=t>e/2?t*i:(e-1-t)*i,n=this._createTrigger(r,a);s.length&&(n.type=s[Math.floor(Math.random()*s.length)]),this.triggers.push(n)}}_createTrigger(t,e=0){return{t:e,position:g.vec2.fromValues(t,0),velocity:g.vec2.fromValues(0,1),speed:1,triggered:!1}}}class te extends Zt{constructor(t=1,e=1,i=g.vec2.fromValues(Math.random(),0),s=[]){super(t,e),this.type="column";const o=t/e;for(let t=0;t<e;t++){const e=t*o,r=this._createTrigger(i[0],e,0);s.length&&(r.type=s[Math.floor(Math.random()*s.length)]),this.triggers.push(r)}}_createTrigger(t,e=0,i=0){return{t:e,position:g.vec2.fromValues(t,0),velocity:g.vec2.fromValues(i,1),speed:1,triggered:!1}}}class ee{constructor(t){this.salves=t,this.triggers=[],this.length=t.length,this.onCompleteDuration=Promise.all(t.map(t=>t.onCompleteDuration)),this.onCompleteTriggers=Promise.all(t.map(t=>t.onCompleteTriggers))}start(t){this.salves.forEach(e=>e.start(t))}update(t){this.triggers=[];for(let e=0,i=this.length;e<i;e++)this.triggers=this.triggers.concat(this.salves[e].update(t));return this.triggers}getTypes(){return this.salves.map(t=>t.type).join(" | ")}}const ie=[()=>[new ee([new Jt(.25,9,.01,["pl"])]),new ee([new Jt(.25,9,.01,["pl"])]),new ee([new Jt(3,9,.01,["pl"])])],()=>[new ee([new te(3,8,g.vec2.fromValues(.25,0),["ir"]),new te(3,10,g.vec2.fromValues(.5,0),["eye"]),new te(3,8,g.vec2.fromValues(.75,0),["ir"])])],()=>[new ee([new te(1,4,g.vec2.fromValues(.2,0),["uv"]),new te(1,4,g.vec2.fromValues(.4,0),["uv"]),new te(1,4,g.vec2.fromValues(.6,0),["uv"]),new te(1,4,g.vec2.fromValues(.8,0),["uv"])])],()=>[new ee([new Jt(.25,9,.02,["ir"])]),new ee([new Jt(.25,9,.02,["ir"])]),new ee([new Jt(.25,9,.02,["ir"])]),new ee([new Qt(3,9,.03,["bl"])])],()=>[new ee([new Jt(.25,9,.1,["pl","eye"])]),new ee([new Jt(.25,9,.1,["pl","eye"])]),new ee([new Jt(4,9,.1,["pl","eye"])])]];class se extends qt{constructor(t,e,i){super(t,e,i,{create:()=>new Yt(t),reset:t=>t,destroy:t=>t.dispose()}),this.nextSalve=this.nextSalve.bind(this),this.heroPosition=g.vec2.create(),this.initSalves(),this.difficulty=0}initSalves(){this.salveQueue=[new ee([new $t(10,4,["pl"])]),new ee([new Jt(10,9,.5,["pl"])]),new ee([new te(3,6,g.vec2.fromValues(.25,0),["ir"]),new te(3,6,g.vec2.fromValues(.5,0),["pl"]),new te(3,6,g.vec2.fromValues(.75,0),["ir"])]),new ee([new $t(10,10,["ir"])]),new ee([new Jt(.5,9,.12,["ir"])]),new ee([new Qt(4,9,.13,["bl"])]),new ee([new $t(4,10,["ir","bl","eye","pl"])]),new ee([new Jt(.5,9,.1,["pl"])]),new ee([new Jt(.5,9,.1,["pl"])]),new ee([new Jt(4,9,.1,["pl"])]),new ee([new Qt(.5,5,.2,["eye"])]),new ee([new Qt(3,5,.2,["uv"])]),new ee([new te(1,8,g.vec2.fromValues(.25,0),["ir"]),new te(1,8,g.vec2.fromValues(.5,0),["ir"]),new te(1,8,g.vec2.fromValues(.75,0),["ir"])]),new ee([new $t(4,4,["pl","ir","uv"])]),new ee([new Qt(.25,9,.025,["eye"])]),new ee([new Qt(.25,9,.03,["pl"])]),new ee([new Qt(.25,9,.035,["eye"])]),new ee([new Qt(3,9,.04,["pl"])]),new ee([new te(3,4,g.vec2.fromValues(.2,0),["uv"]),new te(3,4,g.vec2.fromValues(.4,0),["uv"]),new te(3,4,g.vec2.fromValues(.6,0),["uv"]),new te(3,4,g.vec2.fromValues(.8,0),["uv"])]),new ee([new Jt(.5,9,.4,["ir"])]),new ee([new Jt(4,9,0,["bl"])]),new ee([new te(3,6,g.vec2.fromValues(.1,0),["ir"]),new te(3,8,g.vec2.fromValues(.3,0),["bl"]),new te(3,8,g.vec2.fromValues(.7,0),["bl"]),new te(3,6,g.vec2.fromValues(.9,0),["ir"])]),new ee([new Jt(.25,9,.1,["pl"])]),new ee([new Jt(.25,9,.1,["pl"])]),new ee([new Jt(4,9,.1,["pl"])])],this.currentSalves=[]}clear(){this.initSalves(),super.clear()}fillSalveQueueRandomly(){ie[Math.floor(Math.random()*ie.length)]().forEach(t=>this.salveQueue.push(t))}nextSalve(){this.salveQueue.length||this.fillSalveQueueRandomly();const t=this.salveQueue.shift();this.currentSalves.push(t),t.start(this.time),t.onCompleteDuration.then(this.nextSalve),t.onCompleteTriggers.then(()=>{const e=this.currentSalves.indexOf(t);e>-1&&this.currentSalves.splice(e,1)})}stop(){var t;super.stop(),null===(t=this.tl)||void 0===t||t.kill(),this.tl=x.a.timeline(),this.pool.items.forEach((t,e)=>{this.tl.call(t.hit,[],.1*e)})}spawnForTrigger(t){const e=this.pool.get();this.parent.add(e.root);const i=this.bounds[2]-this.bounds[0];g.vec2.set(this.spawnPosition,t.position[0]*i*.8+.1*i,-100),g.vec4.copy(e.bounds,this.bounds),e.isZigZag=Math.random()<.5,e.setCurrentInfos(t.type),e.spawn(this.spawnPosition),e.root.setScale(this.pixelRatio*e.localScale),e.root.x-=e.root.width*this.pixelRatio*e.localScale*.25,e.collisionCircle.radius=e.infos.radius*e.root.scaleX,e.speed=500*Object(y.c)(this.difficulty+.2,.2,2),g.vec2.copy(e.velocity,t.velocity),e.afterSpawn(this.difficulty)}update(t,e){const i=this.pool.items;for(let t=0,e=i.length;t<e;t++){const e=i[t];g.vec2.copy(e.heroPosition,this.heroPosition)}super.update(t,e)}spawnUpdate(t,e){if(this.isActive){this.time=t,this.currentSalves.length||this.nextSalve();for(let e=0,i=this.currentSalves.length;e<i;e++){const i=this.currentSalves[e].update(t);for(let t=0,e=i.length;t<e;t++)this.spawnForTrigger(i[t])}}}dispose(){var t;null===(t=this.tl)||void 0===t||t.kill(),super.dispose()}}function oe(t,e){const i=!(t[0]>e[0]+e[2]/2),s=!(t[1]>e[1]+e[3]/2);let o=0;return i?s||(o=2):o=s?1:3,o}function re(t,e=!1){var i=t.depth+1,s=t.bounds[0],o=t.bounds[1],r=t.bounds[2]/2,a=t.bounds[3]/2,n=s+r,h=o+a;const l=e?ne:ae;t.nodes[0]=new l(g.vec4.fromValues(s,o,r,a),i,t.maxDepth,t.maxChildren),t.nodes[1]=new l(g.vec4.fromValues(n,o,r,a),i,t.maxDepth,t.maxChildren),t.nodes[2]=new l(g.vec4.fromValues(s,h,r,a),i,t.maxDepth,t.maxChildren),t.nodes[3]=new l(g.vec4.fromValues(n,h,r,a),i,t.maxDepth,t.maxChildren)}class ae{constructor(t,e=0,i=4,s=4){this.bounds=t,this.depth=e,this.maxDepth=i,this.maxChildren=s,this.children=[],this.nodes=[]}insert(t){if(this.nodes.length)return void this.nodes[oe(t.pos,this.bounds)].insert(t);this.children.push(t);const e=this.children.length;if(!(this.depth>=this.maxDepth)&&e>this.maxChildren){re(this,!1);for(let t=0;t<e;t++)this.insert(this.children[t]);this.children.length=0}}retrieve(t){return this.nodes.length?this.nodes[oe(t,this.bounds)].retrieve(t):this.children}clear(){this.children.length=0;for(let t=0,e=this.nodes.length;t<e;t++)this.nodes[t].clear();this.nodes.length=0}}class ne{constructor(t,e=0,i=4,s=4){this.bounds=t,this.depth=e,this.maxDepth=i,this.maxChildren=s,this.children=[],this.nodes=[],this.stuckChildren=[],this.out=[]}insert(t){if(this.nodes.length){const e=oe(t.pos,this.bounds),i=this.nodes[e];return void(t.pos[0]>=i.bounds[0]&&t.pos[0]+t.size[0]<=i.bounds[0]+i.bounds[2]&&t.pos[1]>=i.bounds[1]&&t.pos[1]+t.size[1]<=i.bounds[1]+i.bounds[3]?this.nodes[e].insert(t):this.stuckChildren.push(t))}this.children.push(t);const e=this.children.length;if(!(this.depth>=this.maxDepth)&&e>this.maxChildren){re(this,!0);for(let t=0;t<e;t++)this.insert(this.children[t]);this.children.length=0}}getChildren(){return this.children.concat(this.stuckChildren)}retrieve(t,e){const i=this.out;if(i.length=0,this.nodes.length){const s=oe(t,this.bounds),o=this.nodes[s];t[0]>=o.bounds[0]&&t[0]+e[0]<=o.bounds[0]+o.bounds[2]&&t[1]>=o.bounds[1]&&t[1]+e[1]<=o.bounds[1]+o.bounds[3]?i.push.apply(i,this.nodes[s].retrieve(t,e)):(t[0]<=this.nodes[1].bounds[0]&&(t[1]<=this.nodes[2].bounds[1]&&i.push.apply(i,this.nodes[0].getAllContent()),t[1]+e[1]>this.nodes[2].bounds[1]&&i.push.apply(i,this.nodes[2].getAllContent())),t[0]+e[0]>this.nodes[1].bounds[0]&&(t[1]<=this.nodes[3].bounds[1]&&i.push.apply(i,this.nodes[1].getAllContent()),t[1]+e[1]>this.nodes[3].bounds[1]&&i.push.apply(i,this.nodes[3].getAllContent())))}return i.push.apply(i,this.stuckChildren),i.push.apply(i,this.children),i}getAllContent(){const t=this.out;if(this.nodes.length)for(let t=0;t<this.nodes.length;t++)this.nodes[t].getAllContent();return t.push.apply(t,this.stuckChildren),t.push.apply(t,this.children),t}clear(){this.stuckChildren.length=0,this.children.length=0;const t=this.nodes.length;if(t){for(let e=0;e<t;e++)this.nodes[e].clear();this.nodes.length=0}}}class he{constructor(t,e=4,i=4,s=!1){this.useRect=s,this.root=s?new ne(t,0,e,i):new ae(t,0,e,i)}insert(t,e,i=null){this.root.insert({id:t,pos:e,size:i})}retrieve(t,e){return this.root.retrieve(t,e)}clear(){this.root.clear()}}class le extends Ft{constructor(t){super(),this.localScale=1;const e=t.getFrame("drop");this.velocity=g.vec2.create(),this.applyFrame(e),this.collisionCircle=new kt(this.root.worldOrigin,Math.max(.5*this.root.width,.5*this.root.height))}spawn(t){this.root.x=t[0],this.root.y=t[1],this.root.setRotation(Math.PI),this.alive=!0,this.health=1,this.speed=500,this.root.updateWorldMatrix()}resize(t,e){}hit(t=1){this.health-=t}die(){this.alive=!1}explode(){return new Promise((t,e)=>{t(null)})}update(t,e){this.root.x+=this.velocity[0]*this.speed*e*this.root.scaleX,this.root.y+=this.velocity[1]*this.speed*e*this.root.scaleY,this.collisionCircle.updatePosition(this.root.worldOrigin),this.collisionCircle.radius=Math.min(.5*this.root.width*this.root.scaleX,.5*this.root.height*this.root.scaleY)}}class ce extends qt{constructor(t,e,i){super(t,e,i,{create:()=>new le(t),reset:t=>t,destroy:t=>t.dispose()}),this.timeUntilNextSpawn=1}setTimeUntilNextSpawn(){this.timeUntilNextSpawn=.1}onAfterSpawn(t){g.vec2.copy(t.velocity,this.spawnVelocity),t.root.rotate(t.velocity[0]),super.onAfterSpawn(t)}isItemOutOfBounds(t){const e=this.bounds[1];return t.root.y<e-t.root.height}}class ue extends Ft{constructor(t){super(),this.localScale=1,this.velocity=g.vec2.fromValues(0,1),this.idleAnimation=t.getAnimation("bonus"),this.startFrame=this.idleAnimation.frames[0],this.collisionCircle=new kt(this.root.worldOrigin,1)}setCurrentAnimation(t){return this.currentAnimation=t,this.currentAnimation.setSprite(this),this.currentAnimation}spawn(t){this.setCurrentAnimation(this.idleAnimation),this.applyFrame(this.startFrame),this.root.x=t[0],this.root.y=t[1],this.root.setRotation(0),this.alive=!0,this.health=1,this.speed=200,this.root.updateWorldMatrix()}resize(t,e){}die(){this.alive=!1}hit(t=1,e=null){this.health-=t;const i=this.root.x,s=this.root.y;this.root._parent.remove(this.root),e.add(this.root),this.root.x=i-e.x,this.root.y=s-e.y,this.root.setScale(1),this.root.x*=.5,this.root.y*=.5,this.hitLocation=e}explode(){var t;if(null===(t=this.tl)||void 0===t||t.kill(),this.tl=x.a.timeline(),this.tl.to(this.root,{scaleX:.1,scaleY:.1,duration:1,ease:"expo.out"},0),this.hitLocation){const t=.5*this.hitLocation.width-.5*this.root.width,e=.5*this.hitLocation.height-.5*this.root.height;this.tl.to(this.root,{x:t,y:e,duration:1,ease:"expo.out"},0)}return this.tl.then()}update(t,e){this.currentAnimation&&this.currentAnimation.update(e),this.alive&&(this.root.x+=this.velocity[0]*this.speed*e*this.root.scaleX,this.root.y+=this.velocity[1]*this.speed*e*this.root.scaleY,this.collisionCircle.updatePosition(this.root.worldOrigin))}dispose(){var t;null===(t=this.tl)||void 0===t||t.kill(),super.dispose()}}class de extends qt{constructor(t,e,i){super(t,e,i,{create:()=>new ue(t),reset:t=>t,destroy:t=>t.dispose()}),this.timeUntilNextSpawn=4}setTimeUntilNextSpawn(){this.timeUntilNextSpawn=8*Math.random()+8*this.difficulty+4}onBeforeSpawn(t){const e=this.bounds[2]-this.bounds[0];g.vec2.set(this.spawnPosition,Math.random()*e*.8+.1*e-.5*t.root.width,-100)}onAfterSpawn(t){super.onAfterSpawn(t),t.collisionCircle.radius=25*t.root.scaleX}}class pe extends Ft{constructor(t){super();const e=t.getFrame("smudge");this.velocity=g.vec2.fromValues(0,1),this.applyFrame(e)}spawn(t){this.root.x=t[0],this.root.y=t[1],this.alpha=.15*Math.random()+.01,this.alive=!0,this.root.updateWorldMatrix()}resize(t,e){}die(){this.alive=!1}update(t,e){this.root.x+=this.velocity[0]*this.speed*e,this.root.y+=this.velocity[1]*this.speed*e}}class ge{constructor(t,e,i,s=100){this.spritesheet=t,this.bounds=e,this.parent=i,this.timeUntilNextSpawn=1,this.spawnPosition=g.vec2.create(),this.pixelRatio=1;const o={create:()=>new pe(t),reset:t=>t,destroy:t=>t.dispose()};this.pool=new Kt(s,o)}setTimeUntilNextSpawn(){this.timeUntilNextSpawn=.2}spawnOne(){this.setTimeUntilNextSpawn();const t=this.pool.get();this.parent.add(t.root),this.onBeforeSpawn(t),t.spawn(this.spawnPosition),this.onAfterSpawn(t)}onBeforeSpawn(t){const e=this.bounds[2]-this.bounds[0];g.vec2.set(this.spawnPosition,Math.random()*e*.8+.1*e-.5*t.root.width,-t.root.height)}onAfterSpawn(t){t.root.scaleX=(4*Math.random()+2)*this.pixelRatio,t.root.scaleY=(2*Math.random()+2)*this.pixelRatio,t.speed=(1e3*Math.random()+1500)*this.pixelRatio}async killItem(t,e=!1){t.die(),this.parent.remove(t.root),this.pool.makeAvailable(t)}isItemOutOfBounds(t){const e=this.bounds[1]+this.bounds[3];return t.root.y>e+t.root.height}resize(t,e){g.vec4.copy(this.bounds,t),this.pixelRatio=e,this.pool.items.forEach(t=>{t.root.setScale(2*e)})}update(t,e){const i=this.pool.items;for(let s=0,o=i.length;s<o;s++){const o=i[s];o.update(t,e),this.isItemOutOfBounds(o)&&this.killItem(o)}this.pool.invalidate(),this.timeUntilNextSpawn-=e,this.timeUntilNextSpawn<=0&&this.spawnOne()}dispose(){this.pool.dispose()}}class me{constructor(t,e,i,s=null){this.gl=t,this.program=e,this.nbParticles=i,this.textures=s,this.enabled=!0;const o=null!=s,r=o?11:7;this.vertices=new Float32Array(r*i);const a=new Et.a(t,this.vertices);a.attrib("aPosition",2,t.FLOAT),a.attrib("aColor",4,t.FLOAT),a.attrib("aSize",1,t.FLOAT),o&&(a.attrib("aTextureCoord",2,t.FLOAT),a.attrib("aTextureSize",2,t.FLOAT)),this.buffers=[a],this.buffer=a,this.vao=new Lt.a(t),this.vao.setup(this.program,this.buffers,void 0)}resize(t,e,i){this.width=t,this.height=e,this.pixelRatio=i}render(t,e,i){if(!this.enabled)return;const s=this.program;s.use(),s.uProjection(i),this.textures&&(s.uTexture(this.textures.rgbTexture),s.uAlphaTexture(this.textures.alphaTexture)),this.vao.bind(),this.buffer.drawPoints(),this.vao.unbind()}dispose(){var t,e;null===(t=this.vao)||void 0===t||t.dispose(),null===(e=this.buffers[0])||void 0===e||e.dispose()}}var ve=new class{};class fe extends me{constructor(t){super(t,ve.programs.particle,25),this.velocities=new Float32Array(this.nbParticles),this.alphas=new Float32Array(this.nbParticles)}initData(){const t=this.vertices;let e=0;for(let i=0,s=this.nbParticles;i<s;i++)this.velocities[i]=(30*Math.random()+20)*this.pixelRatio,this.alphas[i]=Math.random(),t[e++]=Math.random()*this.width,t[e++]=Math.random()*this.height,t[e++]=1,t[e++]=1,t[e++]=1,t[e++]=Math.random(),t[e++]=Math.round(3*Math.random())*this.pixelRatio;this.buffer.data(t)}resize(t,e,i){super.resize(t,e,i),this.initData()}updateData(t,e){const i=this.vertices;for(let t=0,s=this.nbParticles;t<s;t++){const s=7*t,o=i[s+1]+this.velocities[t]*e*100;i[s+1]=o,o>this.height&&(i[s+0]=Math.random()*this.width,i[s+1]=0)}this.buffer.data(i)}update(t,e){this.updateData(t,e)}}class be extends me{constructor(t,e,i){super(t,ve.programs.texturedParticle,500,e.textures),this.frames=[],this.spawnPosition=g.vec2.create(),this.spawnVelocity=g.vec2.create(),this.isActive=!1,this.frames.push(e.getFrame("bonusfx_07")),this.velocities=new Float32Array(2*this.nbParticles),this.initialVelocities=new Float32Array(2*this.nbParticles),this.alphas=new Float32Array(this.nbParticles),this.life=new Float32Array(this.nbParticles);for(let t=0;t<this.nbParticles;t++){const e=2*t;this.initialVelocities[e+0]=8*Math.random()-4,this.initialVelocities[e+1]=2*Math.random()+1,this.velocities[e+0]=0,this.velocities[e+1]=this.initialVelocities[e+1],this.alphas[t]=Math.random(),this.life[t]=Math.random()+.5}this.initData(),this.root=new C,i.add(this.root)}initData(){const t=this.vertices;let e=0;const i=this.frames[0],s=i.x/i.srcWidth,o=i.y/i.srcHeight,r=i.width/i.srcWidth,a=i.height/i.srcHeight;for(let i=0,n=this.nbParticles;i<n;i++)t[e++]=0,t[e++]=4*this.height,t[e++]=5*Math.random()+1,t[e++]=8*Math.random()+1,t[e++]=8*Math.random()+1,t[e++]=0,t[e++]=0,t[e++]=s,t[e++]=o,t[e++]=r,t[e++]=a;this.buffer.data(t)}start(){setTimeout(()=>{this.isActive=!0},200)}stop(){this.isActive=!1}updateData(t,e){const i=this.vertices,s=this.root.x,o=this.root.y,r=this.initialVelocities,a=this.spawnVelocity,n=this.pixelRatio;for(let t=0,h=this.nbParticles;t<h;t++){const h=11*t,l=2*t;i[h+0]+=this.velocities[l+0]*e*100,i[h+1]+=this.velocities[l+1]*e*100,i[h+6]=Math.max(.01,i[h+6]-10*e),this.life[t]-=e*n/2,this.velocities[l+0]*=.99*e,this.life[t]<0&&(r[l+0]=2*Math.random()-1,r[l+1]=(2*Math.random()+1)*n,this.velocities[l+0]=r[l+0]+a[0],this.velocities[l+1]=r[l+1]+a[1],this.life[t]=Math.random()+.5,i[h+0]=s+8*(2*Math.random()-1)*n,i[h+1]=o+2*(2*Math.random()-1)*n,i[h+6]=(3+3*Math.random())*(2+n/2),this.isActive?i[h+5]=this.alphas[t]:i[h+5]=0)}this.buffer.data(i)}update(t,e){this.updateData(t,e)}}class we extends Ft{constructor(t,e,i,s=!1){super(),this.gl=t,this.program=e,this.textures=i,this.vertexColor=s,this.invalidMatrix=!1,this.invalidData=!1,this.useVAO=!0,this.autoProgram=!0,this._vaoMap=new Map,this.buffer=this.createMainBuffer(),this.buffers=[this.buffer],this.ibuffer=new Rt.a(t,t.UNSIGNED_SHORT,this.indices,t.STATIC_DRAW),this._currentVao=this.getVao(e)}getVao(t){const e=t._cuid.toString();if(!this._vaoMap.has(e)){const i=new Lt.a(this.gl);i.setup(t,this.buffers,this.ibuffer),this._vaoMap.set(e,i)}return this._vaoMap.get(e)}createMainBuffer(){const t=this.vertexColor?8:4;this.vertices=new Float32Array(4*t),this.indices=new Uint16Array([0,1,2,0,2,3]);const e=this.gl,i=new Et.a(e,this.vertices,e.STATIC_DRAW);return i.attrib("aPosition",2,e.FLOAT),i.attrib("aTextureCoord",2,e.FLOAT),this.vertexColor&&i.attrib("aColor",4,e.FLOAT),i}resize(t,e,i=1){}updateData(){const t=this.vertices;let e=0;for(let i=0,s=this.positions.length;i<s;i++){const s=this.positions[i],o=this.uvs[i];if(t[e++]=s[0],t[e++]=s[1],t[e++]=o[0],t[e++]=o[1],this.vertexColor){const i=this.color;t[e++]=i[0],t[e++]=i[1],t[e++]=i[2],t[e++]=i[3]}}this.buffers[0].data(t)}onMatrixUpdate(){this.invalidMatrix=!0}onUpdateSize(){super.onUpdateSize(),this.invalidData=!0}computePositions(){super.computePositions(),this.invalidData=!0}computeUvs(){super.computeUvs(),this.invalidData=!0}render(){const t=this.program;this.enabled&&(this.autoProgram&&t.use(),this.textures&&(t.uTexture(this.textures.rgbTexture),t.uAlphaTexture(this.textures.alphaTexture)),this.invalidMatrix&&(this.invalidMatrix=!1,this.computePositions()),this.invalidData&&(this.invalidData=!1,this.updateData()),this._currentVao.bind(),this.ibuffer.drawTriangles(),this._currentVao.unbind())}dispose(){var t,e,i;null===(t=this._currentVao)||void 0===t||t.dispose(),null===(e=this.ibuffer)||void 0===e||e.dispose(),null===(i=this.buffers[0])||void 0===i||i.dispose()}}var xe=i(223);class ye extends we{constructor(t,e,i,s=1,o=1,r=1,a=1){super(t,e,null,!1),this.texture=i,this.repeat=g.vec3.fromValues(1,1,1),this.offset=g.vec3.fromValues(0,0,0),this.originalSize=g.vec2.create(),this.autoProgram=!1,this.root.setSize(1,1),g.vec2.set(this.originalSize,s,o),this.setRepeat(r,a)}setRepeat(t,e,i=0,s=0){g.vec3.set(this.repeat,t,-e,1),g.vec3.set(this.offset,i,s,0),g.mat4.fromScaling(this.uvmatrix,this.repeat),g.mat4.translate(this.uvmatrix,this.uvmatrix,this.offset),this.computeUvs()}get offsetX(){return this.offset[0]}set offsetX(t){this.offset[0]=t,g.mat4.translate(this.uvmatrix,this.uvmatrix,this.offset),this.computeUvs()}get offsetY(){return this.offset[1]}set offsetY(t){this.offset[1]=t,g.mat4.translate(this.uvmatrix,this.uvmatrix,this.offset),this.computeUvs()}renderWithProjection(t){const e=this.program;e.use(),e.uProjection(t),e.uTexture(this.texture),this.render()}dispose(){var t;null===(t=this.texture)||void 0===t||t.dispose(),super.dispose()}}var _e,Se=i(36);!function(t){t[t.RADIAL=0]="RADIAL",t[t.VERTICAL=1]="VERTICAL",t[t.HORIZONTAL=2]="HORIZONTAL"}(_e||(_e={}));class Te extends we{constructor(t,e,i=_e.RADIAL){super(t,function(t){switch(t){case _e.RADIAL:return ve.programs.radialRamp;default:return ve.programs.linearRamp}}(i),null),this.autoProgram=!1,this.opacity=1;const s=e.map(t=>Object(xe.a)(t.hex,null!=t.alpha?t.alpha:1,g.vec4.create())).map(t=>[t[0],t[1],t[2],t[3]]);this.ramp=function(t,e){const i=new Uint8Array([].concat(...e).map(t=>255*t)),s=new Se.a(t,t.RGBA);return s.fromData(e.length,1,i),s.clamp(),s}(t,s),this._rampWidth=s.length}renderWithProjection(t){const e=this.program;e.use(),e.uProjection(t),e.uRamp(this.ramp),e.uRampWidth(this._rampWidth),e.uOpacity(this.opacity),this.render()}dispose(){var t;null===(t=this.ramp)||void 0===t||t.dispose(),super.dispose()}}var Ce=class extends ye{constructor(t,e){super(t,ve.programs.planet,e,1,1),this.planetColor=264478,this.rimColor=16766321,this.rimShape=g.vec3.fromValues(.5,.078,1.55),this.planetShape=g.vec3.fromValues(.5,.025,1.8),this.resize=(t,e,i)=>{const s=this.root,o=w.a.isDesktop?t/i*.75:280,r=w.a.isDesktop?o/(14/3):60,a=2*i;s.setSize(o,r),s.anchor[0]=0,s.anchor[1]=0,s.updateOrigin(),s.setScale(a),s.x=.5*t-s.width*s.scaleX*.5,this.enabled?s.y=-s.height*s.scaleY:s.y=1.66*r,this.container.y=.75*r,this.radial0&&(this.radial0.root.setSize(1.37*o,3.46*r),this.radial0.root.x=.5*this.root.width-.5*this.radial0.root.width,this.radial0.root.y=.13*-r),this.radial1&&(this.radial1.root.setSize(.93*o,2.41*r),this.radial1.root.x=.5*this.root.width-.5*this.radial1.root.width,this.radial1.root.y=.333*-r),this.radial2&&(this.radial2.root.setSize(.53*o,.83*r),this.radial2.root.x=.5*this.root.width-.5*this.radial2.root.width,this.radial2.root.y=0),this.radial3&&(this.radial3.root.setSize(.83*r,.83*r),this.radial3.root.x=.5*this.root.width-.5*this.radial3.root.width,this.radial3.root.y=.06*-r)},this.updateUniforms=()=>{const t=this.program;t.use(),t.uPlanetColor(Object(xe.b)(this.planetColor,g.vec3.create())),t.uRimColor(Object(xe.b)(this.rimColor,g.vec3.create())),t.uRimShape(this.rimShape),t.uPlanetShape(this.planetShape)},this.container=new C,this.container.add(this.root),this.radial0=new Te(t,[{hex:16777215,alpha:1},{hex:16777215,alpha:1},{hex:16777215,alpha:1},{hex:16777215,alpha:1},{hex:16777215,alpha:1},{hex:16777215,alpha:.2},{hex:16777215,alpha:0}],_e.RADIAL),this.radial0.opacity=1,this.root.add(this.radial0.root),this.radial1=new Te(t,[{hex:16032825,alpha:1},{hex:16032825,alpha:1},{hex:16032825,alpha:.5},{hex:16032825,alpha:.18},{hex:16032825,alpha:0}],_e.RADIAL),this.radial1.opacity=1,this.root.add(this.radial1.root),this.radial2=new Te(t,[{hex:15836495,alpha:1},{hex:15836495,alpha:.75},{hex:15836495,alpha:.5},{hex:15836495,alpha:.18},{hex:15836495,alpha:0}],_e.RADIAL),this.radial2.opacity=1,this.root.add(this.radial2.root),this.radial3=new Te(t,[{hex:16777215,alpha:.8},{hex:16777215,alpha:.18},{hex:16777215,alpha:0}],_e.RADIAL),this.radial3.opacity=1,this.root.add(this.radial3.root),this.updateUniforms()}createMainBuffer(){this.vertices=new Float32Array(24),this.indices=new Uint16Array([0,1,2,0,2,3]);const t=this.gl,e=new Et.a(t,this.vertices,t.STATIC_DRAW);return e.attrib("aPosition",2,t.FLOAT),e.attrib("aTextureCoord",2,t.FLOAT),e.attrib("aTextureCoord2",2,t.FLOAT),this.uvs2=[g.vec2.fromValues(0,1),g.vec2.fromValues(1,1),g.vec2.fromValues(1,0),g.vec2.fromValues(0,0)],e}updateData(){const t=this.vertices;let e=0;for(let i=0,s=this.positions.length;i<s;i++){const s=this.positions[i],o=this.uvs[i],r=this.uvs2[i];t[e++]=s[0],t[e++]=s[1],t[e++]=o[0],t[e++]=o[1],t[e++]=r[0],t[e++]=r[1]}this.buffers[0].data(t)}renderWithProjection(t){this.radial0.renderWithProjection(t),this.radial1.renderWithProjection(t);const e=this.program;e.use(),e.uTextureMap(this.texture),e.uProjection(t),this.render(),this.radial2.renderWithProjection(t),this.radial3.renderWithProjection(t)}start(){const t=this.root.height;this.root.y=1.66*t,this.enabled=!1,this.radial0.enabled=!1,this.radial1.enabled=!1,this.radial2.enabled=!1,this.radial3.enabled=!1}show(){var t;this.enabled=!0,this.radial0.enabled=!0,this.radial1.enabled=!0,this.radial2.enabled=!0,this.radial3.enabled=!0,null===(t=this.tl)||void 0===t||t.kill(),this.tl=x.a.timeline(),this.tl.fromTo(this.root,{y:this.root.y},{y:-this.root.height*this.root.scaleY,duration:3})}lose(){var t;null===(t=this.tl)||void 0===t||t.kill()}dispose(){var t;null===(t=this.tl)||void 0===t||t.kill(),this.radial0.dispose(),this.radial1.dispose(),this.radial2.dispose(),this.radial3.dispose(),super.dispose()}};function Pe(t){for(var e=1;e<t;)e<<=1;return e>4096&&(e=4096),e}function Ae(t,e,i){const s=Pe(e.width),o=Pe(e.height),r=new b.a(t);r.resize(s,o),r.attachColor(t.RGBA,t.UNSIGNED_BYTE),r.defaultViewport();const a=new we(t,i,e.textures,!0);a.applyFrame(e),a.root.invalidate(),a.root._computeWorldMatrix(!1),r.bind(),t.clear(t.COLOR_BUFFER_BIT),i.use(),i.uProjection(g.mat4.ortho(g.mat4.create(),0,e.width,e.height,0,0,1)),a.render(),t.bindFramebuffer(t.FRAMEBUFFER,null);const n=r.getColorTexture();return n.bind(),n.repeat(),n.setFilter(!1),n}class Me extends me{constructor(t,e){super(t,ve.programs.texturedParticle,w.a.isDesktop?100:50,e.textures),this.alpha=0,this.frame=e.getFrame("star"),this.velocities=new Float32Array(this.nbParticles),this.alphas=new Float32Array(this.nbParticles);for(let t=0;t<this.nbParticles;t++)this.velocities[t]=Math.random()+.5,this.alphas[t]=1;this.initData()}initData(){const t=this.vertices,e=this.frame,i=e.x/e.srcWidth,s=e.y/e.srcHeight,o=e.width/e.srcWidth,r=e.height/e.srcHeight;let a=0;for(let e=0,n=this.nbParticles;e<n;e++)t[a++]=Math.random()*this.width,t[a++]=Math.random()*this.height,t[a++]=1,t[a++]=1,t[a++]=1,t[a++]=this.alphas[e],t[a++]=(10*Math.random()+2)*this.pixelRatio,t[a++]=i,t[a++]=s,t[a++]=o,t[a++]=r;this.buffer.data(t)}resize(t,e,i){super.resize(t,e,i),this.initData()}start(){this.enabled=!1}show(){var t;this.enabled=!0,null===(t=this.tl)||void 0===t||t.kill(),this.tl=x.a.timeline(),this.tl.to(this,{alpha:1,duration:5})}lose(){var t;null===(t=this.tl)||void 0===t||t.kill()}updateData(t,e){const i=this.vertices;for(let e=0,s=this.nbParticles;e<s;e++){const s=11*e,o=i[s+1]+this.velocities[e];i[s+1]=o>this.height?0:o,i[s+5]=.5*(Math.cos(300*e+4*t)+1)*this.alpha}this.buffer.data(i)}dispose(){var t;null===(t=this.tl)||void 0===t||t.kill(),super.dispose()}}const Ee=[100,50,1],Re=[14000997,1653870,7105662],Le=[.5,.7],Oe=[.2,.7],De=[2301743,14725510,1194899];function Ie(t,e,i,s){t.setSize(e,i),Fe(t,s)}function Fe(t,e){t.anchor[0]=0,t.anchor[1]=0,t.updateOrigin(),t.setScale(e)}function ke(t,e){t.x=.5*e-t.width*t.scaleX*.5}function ze(t,e,i,s,o){return s+(o-s)*Object(y.d)(Math.max(t-e)/i)}function Ue(t,e,i,s,o){return t<i?ze(t,e,i,0,1):ze(t,s,o,1,0)}class Ve{constructor(t,e,i,s){this.spritesheets=e,this.programs=s,this.buildings=[],this.skies=[],this.mainBatchables=[],this.clouds=[],this.gradients=[],this.lights=[],this.repeateds=[],this.repeatedSkies=[],this.projection=g.mat4.create(),this.buildingsSpeed=1,this.cloudSpeed=6,this.buildingsOffset=5,this.skySpeed=5,this.sunSpeed=8,this.globalSpeed=4,this.timeScale=0,this.velocity=g.vec2.create(),this.progress=0,this.startVoieLacteeY=0,this.colorTop=g.vec3.create(),this.colorBottom=g.vec3.create();const o=e.get("bg"),r=e.get("main"),a=e.get("planet");this.root=new C,i.add(this.root);const n=s.default,h=s.sprite,l=o.getFrame("building1"),c=Ae(t,l,h),u=new ye(t,n,c,l.width,l.height);this.root.add(u.root);const d=o.getFrame("building2"),p=Ae(t,d,h),m=new ye(t,n,p,d.width,d.height);this.root.add(m.root);const v=o.getFrame("building3"),f=Ae(t,v,h),b=new ye(t,n,f,v.width,v.height);this.root.add(b.root);const x=o.getFrame("building4"),y=Ae(t,x,h),_=new ye(t,n,y,x.width,x.height);this.root.add(_.root);const S=o.getFrame("building5"),T=Ae(t,S,h),P=new ye(t,n,T,S.width,S.height);this.root.add(P.root);const A=o.getFrame("building6"),M=Ae(t,A,h),E=new ye(t,n,M,A.width,A.height);this.root.add(E.root);const R=o.getFrame("bg1"),L=Ae(t,R,h),O=new ye(t,n,L,R.width,R.height);this.root.add(O.root);const D=o.getFrame("bg2"),I=Ae(t,D,h),F=new ye(t,n,I,D.width,D.height);this.root.add(F.root);const k=new Te(t,[{hex:4621215},{hex:16424495}],_e.VERTICAL);this.root.add(k.root);const z=new Te(t,[{hex:1318976},{hex:1385028}],_e.VERTICAL);this.root.add(z.root),this.gradientVoieLactee=new Te(t,[{hex:328722},{hex:1318976}],_e.VERTICAL),this.root.add(this.gradientVoieLactee.root),this.background=new Te(t,[{hex:328722},{hex:328722}],_e.VERTICAL),this.root.add(this.background.root);const U=[r.getFrame("cloud1"),r.getFrame("cloud2"),r.getFrame("cloud3")],V=w.a.isDesktop?20:10;for(let t=0;t<V;t++){const e=new Ft;e.applyFrame(U[t%U.length]),this.root.add(e.root),this.mainBatchables.push(e),this.clouds.push(e)}const B=o.getFrame("bg3");this.voieLactee=new we(t,h,B.textures,!0),this.voieLactee.applyFrame(B),this.root.add(this.voieLactee.root);const N=o.getFrame("sun_00");this.sun=new we(t,h,N.textures,!0),this.sun.applyFrame(N),this.root.add(this.sun.root);const G=new Te(t,[{hex:1513533,alpha:.6},{hex:1513533,alpha:0}],_e.RADIAL);this.root.add(G.root);const W=new Te(t,[{hex:16773848,alpha:.3},{hex:16773848,alpha:0}],_e.RADIAL);this.root.add(W.root);const X=new Te(t,[{hex:16773848,alpha:.3},{hex:16773848,alpha:0}],_e.RADIAL);X.opacity=0,this.root.add(X.root);const j=new Te(t,[{hex:410274,alpha:.3},{hex:410274,alpha:0}],_e.RADIAL);j.opacity=0,this.root.add(j.root),this.lights.push(G,W,X,j);const H=Ae(t,a.getFrame("map"),h);this.planetContainer=new C,this.root.add(this.planetContainer),this.planet=new Ce(t,H),this.planetContainer.add(this.planet.container),this.planet.enabled=!1,this.stars=new Me(t,o),this.stars.enabled=!1,this.repeateds.push(O,F,E,P,_,b,m,u),this.repeatedSkies.push(O,F),this.skies.push(O,k,F,z,this.gradientVoieLactee),this.gradients.push(k,z,this.gradientVoieLactee),this.buildings.push(E,P,_,b,m,u)}onZoom(t,e,i){this.planetContainer.y=.5*t.top}start(t,e,i=1){this.buildings.forEach(t=>{t.root.y=-t.root.height*t.root.scaleY}),this.skies.forEach((t,e)=>{if(e>0){const i=this.skies[e-1];t.root.y=i.root.y-t.root.height*t.root.scaleY+4}else t.root.y=-t.root.height*t.root.scaleY-0*this.scale}),this.voieLactee.root.y=this.gradientVoieLactee.root.y,this.startVoieLacteeY=this.voieLactee.root.y,this.sun.root.y=this.buildings[5].root.y,this.clouds.forEach((e,i)=>{const s=this.skies[1].root,o=this.skies[1].root,r=e.root;r.x=Math.random()*t-.5*r.width*r.scaleX,r.y=s.y+Math.random()*o.height*o.scaleY+r.height*r.scaleY*1.4});const s=this.lights[0].root,o=this.lights[1].root;s.y=-s.height*s.scaleY*.5,o.y=s.y-300*s.scaleY,this.stars.start(),this.planet.start()}lose(){this.planet.lose(),this.stars.lose()}resize(t,e,i=1){this.stars.resize(t,e,i),this.scale=3*i;const s=this.scale;Fe(this.voieLactee.root,s),Fe(this.sun.root,s/2),ke(this.voieLactee.root,t),ke(this.sun.root,t),this.planet.resize(t,e,i),Ee[2]=this.voieLactee.root.height,this.gradients.forEach((e,i)=>{const o=1.5*t;Ie(e.root,o,Ee[i],s),ke(e.root,t)}),this.repeateds.forEach(e=>{const i=1.5*t,o=i/e.originalSize[0];e.setRepeat(o,1),Ie(e.root,i,e.texture.height,s),ke(e.root,t)}),this.repeateds[this.repeateds.length-1].offsetX=.03,this.lights.forEach(e=>{const i=Math.min(t,250);Ie(e.root,i,i,s),ke(e.root,t)});const o=this.lights[2].root,r=Math.min(.35*e,150);Ie(o,r,r,s),o.x=t-o.width*o.scaleX,o.y=-o.height*o.scaleY;const a=this.lights[3].root,n=Math.min(.5*e,250);Ie(a,n,n,s),ke(a,t),a.x=t-a.width*a.scaleX,a.y=-e-a.height*a.scaleY*.5,this.clouds.forEach((t,e)=>{const i=t.root,o=e/this.clouds.length,r=.75*s+o*s*.75;i.setScale(.32*r)}),this.background.root.setSize(1.5*t,1.5*e),this.background.root.y=-e,this.root.y=e}checkInViewport(t){const e=function(t,e){const i=t.y-e;return i<1.5*-e&&i+t.height*t.scaleY>.5*e}(t.root,-this.root.y);!t.enabled&&e?t.enabled=!0:t.enabled&&!e&&(t.enabled=!1)}moveItem(t,e,i){t.root.y+=e*t.root.scaleY*i*this.globalSpeed*this.timeScale,this.checkInViewport(t)}showPlanet(){this.planet.show(),this.stars.show()}followItem(t,e,i=0,s=!1){t.root.y=e.root.y+i,s&&(t.root.y-=e.root.height*e.root.scaleY),this.checkInViewport(t)}update(t,e){const i=this.buildingsSpeed,s=this.skySpeed,o=this.cloudSpeed,r=this.sunSpeed;let a,n,h;for(this.stars.updateData(t,e),a=0,n=this.buildings.length;a<n;a++){const t=this.buildings[a],s=a+this.buildingsOffset;this.moveItem(t,e,s*i)}for(a=0,n=this.skies.length;a<n;a++){const t=this.skies[a];this.moveItem(t,e,s)}for(a=0,n=this.clouds.length,h=n/2;a<n;a++){const t=this.clouds[a],i=2+.001*(a+this.buildingsOffset);this.moveItem(t,e,i*o),t.enabled&&(t.root.x+=(.1+e*a)*(a%2==0?1:-1))}this.moveItem(this.lights[0],e,s),this.moveItem(this.sun,e,r),this.followItem(this.lights[1],this.sun,0,!0),this.followItem(this.voieLactee,this.gradientVoieLactee),this.planet.enabled&&(this.planet.offsetY=.4*-e),this.startVoieLacteeY?this.progress=1-this.voieLactee.root.y/this.startVoieLacteeY:this.progress=0;const l=this.lights[2],c=this.lights[3];l.opacity=Ue(this.progress,.1,.12,.2,.22),c.opacity=Ue(this.progress,.3,.35,.4,.5),this.progress>.5&&!this.planet.enabled&&this.showPlanet(),this.computeColor(this.colorTop,Re,Le),this.computeColor(this.colorBottom,De,Oe)}computeColor(t,e,i){const s=i[0],o=i[1];if(this.progress<i[0]){const i=Object(y.d)(this.progress/s);Object(xe.b)(Object(xe.c)(e[0],e[1],i),t)}else{const i=Object(y.d)((this.progress-s)/(o-s));Object(xe.b)(Object(xe.c)(e[1],e[2],i),t)}}render(t){let e,i;for(this.background.renderWithProjection(t),e=0,i=this.gradients.length;e<i;e++){this.gradients[e].renderWithProjection(t)}for(e=0,i=this.repeatedSkies.length;e<i;e++){this.repeatedSkies[e].renderWithProjection(t)}for(this.sun.render(),e=0,i=this.buildings.length;e<i;e++){this.buildings[e].renderWithProjection(t)}this.voieLactee.render(),this.stars.render(0,0,t)}renderPlanet(t){this.planet.renderWithProjection(t)}renderLights(t){for(let e=0;e<this.lights.length;e++){this.lights[e].renderWithProjection(t)}}dispose(){this.mainBatchables.forEach(t=>t.dispose()),this.lights.forEach(t=>t.dispose()),this.buildings.forEach(t=>t.dispose()),this.skies.forEach(t=>t.dispose()),this.clouds.forEach(t=>t.dispose()),this.background.dispose(),this.sun.dispose(),this.stars.dispose(),this.planet.dispose(),this.voieLactee.dispose()}}class Be{constructor(){this.projection=g.mat4.create(),this._zoom=1,this._position=g.vec2.create(),this._size=g.vec2.create(),this.updateMatrix=()=>{const t=this._zoom,e=this._size[0],i=this._size[1],s=.5*e+this._position[0],o=.5*i+this._position[1];this.left=s-.5*e/t,this.top=o-.5*i/t,this.right=s+.5*e/t,this.bottom=o+.5*i/t,g.mat4.ortho(this.projection,this.left,this.right,this.bottom,this.top,0,1)}}get x(){return this._position[0]}set x(t){this._position[0]=t,this.updateMatrix()}get y(){return this._position[1]}set y(t){this._position[1]=t,this.updateMatrix()}get width(){return this._size[0]}set width(t){this._size[0]=t,this.updateMatrix()}get height(){return this._size[1]}set height(t){this._size[1]=t,this.updateMatrix()}get zoom(){return this._zoom}set zoom(t){this._zoom=t,this.updateMatrix()}resize(t,e){g.vec2.set(this._size,t,e),this.width=t,this.height=e,this.updateMatrix()}}class Ne{constructor(t,e){this.spriteSheets=e,this.root=new C,this.worldWidth=1,this.bounds=g.vec4.create(),this.projection=g.mat4.create(),this.time=0,this.dt=0,this.previousTime=0,this.shootAudioDelay=1,this.isPlaying=!1,this.isKeyboardMode=!1,this.onFirstMouseMoveDesktop=()=>{window.removeEventListener("mousemove",this.onFirstMouseMoveDesktop),this.isTouching=!0},this.onTouchUpdate=()=>{this.isTouching=!!this.inputs.touches.length},this.onExitKeyBoardMode=()=>{this.isKeyboardMode=!1},this.onKeyDown=()=>{this.isKeyboardMode||this.inputs.keyPressed&&(this.isKeyboardMode=!0)},this.onIntroComplete=()=>{this.isPlaying=!0,this.audio.playShootTrack(this.shootAudioDelay),this.bulletManager.start(),this.tail.start(),this.collectibleManager.start(),this.enemyManager.start()},this.onOutroComplete=()=>{this.data.gameState.ended=!0},this.onPauseStart=()=>{var t;null===(t=this.tlAudio)||void 0===t||t.kill(),this.tlAudio=x.a.timeline(),this.tlAudio.to(this.audio,{lowpass:1,duration:.4},0)},this.onPauseEnd=()=>{var t;null===(t=this.tlAudio)||void 0===t||t.kill(),this.tlAudio=x.a.timeline(),this.tlAudio.to(this.audio,{lowpass:0,duration:.4},0)};const i=e.get("main"),{bounds:s,root:o}=this,{gl:r}=t.glview,{programs:a,inputs:n,data:h,postProcess:l}=t;this.inputs=n,this.data=h,this.postProcess=l,this.audio=t.audio,this.camera=new Be,this.bulletTree=new he(this.bounds,8,8,!0),this.enemyTree=new he(this.bounds,8,4,!0),this.batch=new Ot(r,100),w.a.isDesktop||(this.inputs.onTouchAdded.on(this.onTouchUpdate),this.inputs.onTouchRemoved.on(this.onTouchUpdate)),this.hero=new Nt(i,o),this.enemyManager=new se(i,s,o),this.bulletManager=new ce(i,s,o),this.collectibleManager=new de(i,s,o),this.smudgeManager=new ge(i,s,o),this.background=new Ve(r,e,o,a),this.particles=new fe(r),this.tail=new be(r,i,o)}init(t,e,i){this.background.start(t,e,i),this.background.update(0,0),this.hero.root.y=-2e3,this.hero.root.x=.5*t,this.hero.dest[0]=.5,this.hero.dest[1]=.5}start(t,e,i){var s,o;this.data.gameState.score=0,this.camera.resize(t,e),this.bulletManager.clear(),this.enemyManager.clear(),this.collectibleManager.clear(),w.a.isDesktop&&(window.addEventListener("mousemove",this.onFirstMouseMoveDesktop),window.addEventListener("mousemove",this.onExitKeyBoardMode),window.addEventListener("keydown",this.onKeyDown)),this.time=Wt()()/1e3,this.previousTime=this.time,this.dt=0,this.background.start(t,e,i),this.hero.start(t,e),this.postProcess.grayScale.amount=0,this.audio.playMainTrack(),null===(s=this.tl)||void 0===s||s.kill(),this.tl=x.a.timeline({onComplete:this.onIntroComplete}),this.tl.fromTo(this.background,{timeScale:0},{timeScale:1,duration:2},0),this.tl.fromTo(this.hero.root,{y:this.hero.root.y+1e3},{y:this.hero.root.y,duration:2,onUpdate:()=>{this.hero.dest[0]=this.hero.root.x,this.hero.dest[1]=this.hero.root.y}},0),null===(o=this.tlAudio)||void 0===o||o.kill(),this.tlAudio=x.a.timeline(),this.tlAudio.to(this.audio,{lowpass:0,duration:.4},0),this.tl.add(this.tlAudio,0)}lose(){var t,e;this.isPlaying=!1,this.isTouching=!1,this.background.lose(),this.audio.pauseShootTrack(),this.bulletManager.stop(),this.tail.stop(),this.collectibleManager.stop(),this.enemyManager.stop(),this.hero.die(),null===(t=this.tl)||void 0===t||t.kill(),this.tl=x.a.timeline({onComplete:this.onOutroComplete}),this.tl.to(this.postProcess.grayScale,{duration:2,amount:1},0),null===(e=this.tlAudio)||void 0===e||e.kill(),this.tlAudio=x.a.timeline(),this.tlAudio.to(this.audio,{lowpass:1,duration:.4},0),this.tl.add(this.tlAudio,0)}resize(t,e,i=1){const s=w.a.isDesktop?1.5*i:i,o=w.a.isDesktop?1.2*i:.75*i;this.camera.resize(t,e),this.pixelratio=i,this.root.setSize(t,e),g.mat4.ortho(this.projection,0,t,e,0,0,1),g.vec4.set(this.bounds,0,0,t,e),g.vec4.copy(this.bulletTree.root.bounds,this.bounds),this.enemyManager.resize(this.bounds,o),this.bulletManager.resize(this.bounds,s),this.collectibleManager.resize(this.bounds,s),this.smudgeManager.resize(this.bounds,s),this.hero.resize(t,e,s),this.particles.resize(t,e,s),this.tail.resize(t,e,s),this.background.resize(t,e,i)}checkCollisions(){const t=this.bulletManager.pool.items,e=this.enemyManager.pool.items,i=this.collectibleManager.pool.items,s=this.pixelratio;this.bulletTree.clear(),this.enemyTree.clear();for(let e=0,i=t.length;e<i;e++)this.bulletTree.insert(e,t[e].root.position2,t[e].root.size);for(let t=0,i=e.length;t<i;t++)this.enemyTree.insert(t,e[t].root.position2,e[t].root.size);for(let i=0,o=e.length;i<o;i++){const o=e[i];o.alive&&o.testBulletCollision(t,this.bulletTree)&&(this.data.gameState.popupX=o.root.position2[0]/s,this.data.gameState.popupY=o.root.position2[1]/s,this.data.gameState.score+=10,this.audio.playSFX(o.infos.audio,.8+.1*(2*Math.random()-1)))}this.hero.testEnemiesCollision(e,this.enemyTree)&&(this.hero.isInvincible||(this.data.gameState.health&&(this.data.gameState.health-=1),0===this.data.gameState.health?this.audio.playSFX(p.BOTTLE_DEATH):this.audio.playSFX(p.BOTTLE_HIT),this.cameraShake(),this.hero.setInvincible())),this.hero.testCollectiblesCollision(i)&&(this.data.gameState.health<4&&(this.data.gameState.health+=1),this.data.gameState.popupX=this.hero.root.position2[0]/s,this.data.gameState.popupY=this.hero.root.position2[1]/s,this.data.gameState.score+=25,this.audio.playSFX(p.COLLECT_BOTTLE),this.hero.setInvincible(),this.cameraZoom())}drawBackground(t){const e=this.spriteSheets.get("main").textures,i=this.background.mainBatchables;this.background.render(this.camera.projection),this.batch.clear(),this.batch.bind(t),this.batch.useTextures(e);for(let t=0,e=i.length;t<e;t++)this.batch.push(i[t]);this.batch.render(),this.batch.unbind()}drawScene(t){const e=this.bulletManager.pool.items,i=this.enemyManager.pool.items,s=this.collectibleManager.pool.items,o=this.smudgeManager.pool.items,r=this.spriteSheets.get("main").textures;this.batch.clear(),this.batch.bind(t),this.batch.useTextures(r),t.uProjection(this.camera.projection);for(let t=0,i=e.length;t<i;t++)this.batch.push(e[t]);this.batch.push(this.hero),this.hero.collisionFX.isPlaying&&this.batch.push(this.hero.collisionFX),this.hero.bonusFX.isPlaying&&this.batch.push(this.hero.bonusFX);for(let t=0,e=i.length;t<e;t++)this.batch.push(i[t]);for(let t=0,e=s.length;t<e;t++)this.batch.push(s[t]);for(let t=0,e=o.length;t<e;t++)this.batch.push(o[t]);this.batch.render(),this.batch.unbind()}drawGlow(t){}updateControls(){if(this.isKeyboardMode){if(this.inputs.keyPressed){let t=0,e=0;this.inputs.keyLeft?t=1e3*-this.dt:this.inputs.keyRight&&(t=1e3*this.dt),this.inputs.keyDown?e=1e3*this.dt:this.inputs.keyUp&&(e=1e3*-this.dt),this.hero.addToDest(t,e,this.bounds)}}else if(this.isTouching){let t,e;w.a.isDesktop?(t=this.inputs.mpos[0]/2+.5,e=1-(this.inputs.mpos[1]/2+.5)):(t=this.inputs.touches[0].coords[0]/2+.5,e=1-(this.inputs.touches[0].coords[1]/2+.5)),this.hero.setDest(t,e,this.bounds)}}update(){this.root.updateWorldMatrix(),this.time=Wt()()/1e3,this.dt=this.time-this.previousTime,this.previousTime=this.time,this.enemyManager.difficulty=Math.pow(this.background.progress,2),this.collectibleManager.difficulty=this.enemyManager.difficulty,this.collectibleManager.difficulty>1&&this.collectibleManager.stop(),this.isPlaying&&this.updateControls(),this.hero.update(this.time,this.dt),g.vec2.copy(this.bulletManager.spawnPosition,this.hero.headPosition),g.vec2.copy(this.bulletManager.spawnVelocity,this.hero.shootingDirection),this.background.velocity[0]+=.1*(this.hero.headPosition[0]/this.root.width*2-1-this.background.velocity[0]),g.vec2.copy(this.tail.spawnPosition,this.hero.tailPosition),g.vec2.copy(this.tail.spawnPosition,this.hero.tailPosition),this.tail.root.x=this.hero.tailPosition[0],this.tail.root.y=this.hero.tailPosition[1],g.vec2.copy(this.tail.spawnVelocity,this.hero.shootingDirection),g.vec2.copy(this.enemyManager.heroPosition,this.hero.root.position2),this.bulletManager.update(this.time,this.dt),this.enemyManager.update(this.time,this.dt),this.collectibleManager.update(this.time,this.dt),this.smudgeManager.update(this.time,this.dt),this.background.update(this.time,this.dt),this.tail.update(this.time,this.dt),this.particles.update(this.time,this.dt),this.isPlaying&&(this.checkCollisions(),this.data.gameState.health<=0&&this.lose())}cameraShake(){var t;null===(t=this.tlShake)||void 0===t||t.kill(),this.tlShake=x.a.timeline(),this.tlShake.to(this.camera,{duration:.05,x:10}),this.tlShake.to(this.camera,{duration:.05,x:-10}),this.tlShake.to(this.camera,{duration:.05,x:10}),this.tlShake.to(this.camera,{duration:.05,x:0})}cameraZoom(){var t;null===(t=this.tlZoom)||void 0===t||t.kill(),this.tlZoom=x.a.timeline({onUpdate:()=>{this.background.onZoom(this.camera,this.bounds[2],this.bounds[3])}});const e=this.root,i=this.hero.root;e.anchor[0]=i.worldOrigin[0]/e.size[0],e.anchor[1]=i.worldOrigin[1]/e.size[1],e.updateOrigin();let s=.5*(i.worldOrigin[0]-.5*e.size[0]),o=.5*(i.worldOrigin[1]-.5*e.size[1]);this.tlZoom.to(this.camera,{zoom:1.2,x:s,y:o,duration:.5,ease:"cubic.inOut"},0),this.tlZoom.to(this.camera,{zoom:1,x:0,y:0,duration:1,ease:"cubic.inOut"},.5)}drawAdditiveLayer(t=!1){this.tail.render(this.time,this.dt,this.camera.projection),t||this.particles.render(this.time,this.dt,this.camera.projection)}dispose(){var t,e,i,s;window.removeEventListener("mousemove",this.onFirstMouseMoveDesktop),window.removeEventListener("mousemove",this.onExitKeyBoardMode),window.removeEventListener("keydown",this.onKeyDown),null===(t=this.tl)||void 0===t||t.kill(),null===(e=this.tlAudio)||void 0===e||e.kill(),null===(i=this.tlZoom)||void 0===i||i.kill(),null===(s=this.tlShake)||void 0===s||s.kill(),this.enemyTree.clear(),this.bulletTree.clear(),this.hero.dispose(),this.background.dispose(),this.batch.dispose(),this.enemyManager.dispose(),this.bulletManager.dispose(),this.collectibleManager.dispose(),this.smudgeManager.dispose(),this.particles.dispose(),this.tail.dispose()}}function Ge(t,e,i,s=!1){let a={std:n.a.asset_url(e+i+".png")};s||(a={dxt:n.a.asset_url(e+i+".png.dxt.ktx"),pvr:n.a.asset_url(e+i+".png.pvr.ktx"),etc:n.a.asset_url(e+i+".png.etc.ktx"),std:n.a.asset_url(e+i+".png")});let h=new o.b(a);return new r.b(i,h,t)}function We(t,e,i,s=!1){new d(i+"-atlas",n.a.asset_url("game-3/"+i+"/"+i+".json"),e),function(t,e,i=!1){Ge(t,"game-3/"+e+"/",e,i),Ge(t,"game-3/"+e+"/",e+"-alpha",i)}(t,i,s)}function Xe(t,e,i){const s=e.getResource(i+"-atlas"),o=P.createFromResource(i,t);return new R(o,s.value)}class je{constructor(t){this.data=t,this.dt=0,this.time=0,this.loaded=!1,this.paused=!1,this.root2d=new C}enter(){console.log("[SCENE][Game 3] Enter");const{width:t,height:e,pixelRatio:i}=this.glview;this.world.start(t,e,i)}leave(){this.data.gameState.paused=!0,console.log("[SCENE][Game 3] Leave")}attachResources(t){this.resources=t}attachAudioResources(t){this.audioResources=t}init(t){const{gl:e}=t;this.glview=t,this.gl=e,this.quad=new m.a(e),this.fbo=new b.a(e),this.fbo.resize(4,4),this.fbo.attachColor(e.RGB,e.UNSIGNED_BYTE),this.fbo.getColorTexture().setFilter(!1).clamp(),this.glowFbo=new b.a(e),this.glowFbo.resize(4,4),this.glowFbo.attachColor(e.RGB,e.UNSIGNED_BYTE),this.glowFbo.getColorTexture().setFilter(!1).clamp(),this.inputs=new h.a(this.ilayer),this.postProcess=new tt(this,"game3"),this.postProcess.enabled=!0,this.backgroundPostProcess=new et(this,"game3bg"),this.backgroundPostProcess.enabled=!0,this.initTextures(),this.initAudio(),this.audio=new S(this.audioResources),this.programs=new Mt(this),this.additiveConfig=(new f.c).enableBlend().blendFunc(e.ONE,e.ONE),this.noBlendConfig=(new f.c).enableBlend(!1),this.mainConfig=(new f.c).enableCullface(!1).enableDepthTest(!1).enableBlend().blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.defaultConfig=new f.c,this.defaultConfig.toDefault(),this.glstate=new v.a(e),ve.programs=this.programs,ve.glState=this.glstate,this.inputs.start()}handleResize(){if(this.loaded){const{width:t,height:e,pixelRatio:i}=this.glview;this.fbo.resize(t,e),this.glowFbo.resize(Math.floor(t/2),Math.floor(e/2)),this.world.resize(t,e,i)}}onPauseStart(){this.paused=!0,this.world.onPauseStart()}onPauseEnd(){this.paused=!1,this.world.onPauseEnd()}render(t){if(this.paused&&!this.data.gameState.paused?this.onPauseEnd():!this.paused&&this.data.gameState.paused&&this.onPauseStart(),this.data.gameState.paused)return;if(!this.loaded)return;const{width:e,height:i,gl:s}=this.glview;this.world.update(),g.vec3.copy(this.backgroundPostProcess.colorLayer.colorTop,this.world.background.colorTop),g.vec3.copy(this.backgroundPostProcess.colorLayer.colorBottom,this.world.background.colorBottom),this.backgroundPostProcess.preRender(e,i),this.backgroundPostProcess.bindColor(),this.world.drawBackground(this.programs.sprite),this.backgroundPostProcess.render(this.fbo),this.glowFbo.bind(),s.clear(s.COLOR_BUFFER_BIT),this.glowFbo.defaultViewport(),this.world.drawGlow(this.programs.sprite),this.world.drawAdditiveLayer(!0),this.postProcess.glow.glowTexture=this.glowFbo.getColor(),this.postProcess.preRender(e,i),this.postProcess.bindColor(),this.glstate.now(this.noBlendConfig),this.programs.screen.use(),this.programs.screen.tTex(this.fbo.getColor()),this.quad.attribPointer(this.programs.screen),this.quad.render(),this.glstate.apply(),this.world.background.renderPlanet(this.world.camera.projection),this.world.background.renderLights(this.world.camera.projection),this.world.drawScene(this.programs.sprite),this.glstate.now(this.additiveConfig),this.world.drawAdditiveLayer(!1),this.glstate.apply(),this.postProcess.render()}restart(){const{width:t,height:e,pixelRatio:i}=this.glview;this.world.start(t,e,i)}initTextures(){const t=this.resources,e=this.glview.gl,i=w.a.isDesktop?"bg-dk":"bg",s=w.a.isDesktop?"planet-dk":"planet",o=new a.a("game3",e,t);We(o,t,"main",!1),We(o,t,s,!0),We(o,t,i,!1),this.texResources=o}initAudio(){const t=this.audioResources;Object.keys(p).forEach(e=>{const i=p[e];return new l.a(i,"game-3/G3_"+i,t)})}async load(){}onLoaded(){this.loaded=!0;const t=this.resources,e=this.texResources,i=w.a.isDesktop?"bg-dk":"bg",s=w.a.isDesktop?"planet-dk":"planet",o=new Map;o.set("main",Xe(e,t,"main")),o.set("planet",Xe(e,t,s)),o.set("bg",Xe(e,t,i)),this.glstate.now(this.defaultConfig),this.world=new Ne(this,o),this.glstate.push(this.mainConfig),this.glstate.apply(),this.handleResize();const{width:r,height:a,pixelRatio:n}=this.glview;this.world.init(r,a,n)}async dispose(){var t,e,i,s,o,r,a,n,h;null===(t=this.postProcess)||void 0===t||t.dispose(),null===(e=this.backgroundPostProcess)||void 0===e||e.dispose(),null===(i=this.fbo)||void 0===i||i.dispose(),null===(s=this.glowFbo)||void 0===s||s.dispose(),null===(o=this.audio)||void 0===o||o.dispose(),null===(r=this.programs)||void 0===r||r.dispose(),null===(a=this.world)||void 0===a||a.dispose(),null===(n=this.quad)||void 0===n||n.dispose(),null===(h=this.inputs)||void 0===h||h.release()}}var He=i(83),Ye=i(18),Ke=i(249),qe=i(6);class Ze extends He.a{constructor(){super(),this.name="Game 3",console.log("[MODULE][Game 3] instantiate"),this.data.gameState=Object(Ke.d)(new Ke.e,new Ke.c,new Ke.a,new Ke.b),this.data.gameState.gameId=qe.a.GAME_3,this.data.gameState.health=4,this.data.gameState.popupX=0,this.data.gameState.popupY=0}init(t){super.init(t),this._scene=new je(this.data),this._scene.attachResources(this.resources),this._scene.attachAudioResources(this.audioResources);let e=window.innerWidth>=768?"desktop":"mobile";new Ye.a("game-preview",i(125)("./bg-stars-"+e+".jpg"),this.preloadedResources),new Ye.a("game-logo",i(475),this.preloadedResources),new Ye.a("poster-rule1",i(476),this.preloadedResources),new Ye.a("poster-rule2",i(477),this.preloadedResources),new Ye.a("poster-rule3",i(478),this.preloadedResources),new Ye.a("share-push",i(126),this.resources),new Ye.a("share-product",i(250),this.resources),new Ye.a("share-game",i(479)("./share-challenge-game-3-"+e+".png"),this.resources),new Ye.a("share-game-canvas",i(482),this.resources);for(let t=1;t<34;t++){let e=t.toString().padStart(2,"0");new Ye.a("praise-wow-"+e,"/assets/img/game-3/wow/wow-"+e+".png",this.resources)}for(let t=1;t<39;t++){let e=t.toString().padStart(2,"0");new Ye.a("praise-great-"+e,"/assets/img/game-3/great/great-"+e+".png",this.resources)}for(let t=1;t<39;t++){let e=t.toString().padStart(2,"0");new Ye.a("praise-amazing-"+e,"/assets/img/game-3/amazing/amazing-"+e+".png",this.resources)}new Ye.a("game-thumbnail-1",i(121),this.resources),new Ye.a("game-thumbnail-2",i(122),this.resources),new Ye.a("game-thumbnail-3",i(123),this.resources),new Ye.a("game-thumbnail-4",i(124),this.resources),new l.a("INSIDE_PORTAL_MAIN_LOOP","main/INSIDE_PORTAL_MAIN_LOOP",this.audioResources)}restart(){this.data.gameState.health=4,this.data.gameState.score=0,this._scene.restart()}onLoaded(){this.playIntroGameLoop()}playIntroGameLoop(){this.gameMusicLoop=this.audioResources.get("INSIDE_PORTAL_MAIN_LOOP").play(1,!0),this.gameMusicLoop.node.loopStart=1,this.gameMusicLoop.node.loopEnd=11}stopIntroGameLoop(){x.a.to(this.gameMusicLoop.gain.gain,{duration:1,value:0,onComplete:()=>{var t;null===(t=this.gameMusicLoop)||void 0===t||t.dispose(),this.gameMusicLoop=null}})}getSprites(t){return this.resources.getResources(new RegExp(`^${t}[-_][0-9]+.`),!0)}async leave(){let t=null;return this.gameMusicLoop&&(t=new Promise(t=>{x.a.to(this.gameMusicLoop.gain.gain,{duration:1,value:0,onComplete:()=>{t()}})})),Promise.all([t,super.leave()]).then(()=>{this.dispose()})}dispose(){var t;this.gameMusicLoop&&this.gameMusicLoop.gain&&this.gameMusicLoop.gain.gain&&x.a.killTweensOf(this.gameMusicLoop.gain.gain),null===(t=this.gameMusicLoop)||void 0===t||t.dispose(),this.gameMusicLoop=null}}var $e=i(39),Qe=i(84),Je=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"c-Popups"},this._l(this.scorePopups,(function(t){return e("ScorePopup",{key:t.id,attrs:{x:t.x,y:t.y,value:t.value,alpha:t.alpha}})})),1)};Je._withStripped=!0;var ti=function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"c-ScorePopup",style:this.style},[this._v("\n    +"+this._s(this.value)+"\n")])};ti._withStripped=!0;var ei={props:{value:{type:Number,default:10},x:{type:Number,default:0},y:{type:Number,default:0},alpha:{type:Number,default:1}},computed:{style(){return{opacity:this.alpha,transform:"translate("+this.x+"px, "+this.y+"px)"}}},methods:{}},ii=(i(483),i(5)),si=Object(ii.a)(ei,ti,[],!1,null,"70ee53ee",null);si.options.__file="src/modules/game3/ScorePopup.vue";var oi=si.exports;let ri=0;var ai={props:{score:{type:Number,default:0},popupX:{type:Number,default:0},popupY:{type:Number,default:0}},data:function(){return{scorePopups:[]}},components:{ScorePopup:oi},watch:{scoreValue:async function(t,e){if(0===t){for(;this.scorePopups.length;)this.scorePopups.shift();return}const i=t-e;this.addScorePopup(i)}},computed:{scoreValue:function(){return Math.round(this.score)}},methods:{animatePopup(t,e=0){const i=x.a.timeline();return i.to(t,{duration:2+e,x:t.x,y:t.y-200,ease:"cubic.out"},0),i.to(t,{duration:1,alpha:0},e+1),i.then()},async addScorePopup(t){const e={id:ri++,x:this.popupX,y:this.popupY,alpha:1,value:t};this.scorePopups.push(e),await this.animatePopup(e);const i=this.scorePopups.indexOf(e);i>-1&&this.scorePopups.splice(i,1)}}},ni=(i(485),Object(ii.a)(ai,Je,[],!1,null,"3dad59d4",null));ni.options.__file="src/modules/game3/Popups.vue";var hi=ni.exports,li=i(251),ci=i(252),ui=i(254),di=i(253),pi=i(255);const gi=Object(Qe.a)(Ze);var mi={_module:gi,mixins:[gi,$e.a,li.a],components:{Popups:hi,Scoreboard:ci.a,ScoreUi:ui.a,InstructionsPanel:di.a,PraiseCvs:pi.a},data:()=>({isLoaded:!1,isStarted:!1,instructionActive:!1,finalScore:0,praiseImages:[],praise:{step:300,audioDelay:200}}),watch:{"$data.gameState.ended":"onEnded"},methods:{preparePraise(){const t=this.getModule();this.$refs.praise.addSprites(t.getSprites("praise-wow")),this.$refs.praise.addSprites(t.getSprites("praise-great")),this.$refs.praise.addSprites(t.getSprites("praise-amazing"))},onPraiseRequest(){this.$refs.praise.play()},onPraiseAudioRequest(){this.getModule().getScene().audio.play(p.HYPE_WORDS,.75)}}},vi=Object(ii.a)(mi,s,[],!1,null,null,null);vi.options.__file="src/modules/game3/Game3.vue";e.default=vi.exports}}]);