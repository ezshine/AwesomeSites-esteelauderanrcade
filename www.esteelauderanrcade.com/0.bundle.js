(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{218:function(t,e,s){"use strict";s.d(e,"a",(function(){return o})),s.d(e,"b",(function(){return h})),s.d(e,"d",(function(){return a})),s.d(e,"c",(function(){return d})),s.d(e,"f",(function(){return c})),s.d(e,"e",(function(){return u})),s.d(e,"g",(function(){return f}));var i=s(1);const n=i.mat3.create(),r=(new Float32Array(n.buffer,0,3),new Float32Array(n.buffer,12,3),new Float32Array(n.buffer,24,3),i.vec3.fromValues(0,1,0),2*Math.PI),o=Math.PI/180,h=1/o;function a(t){return Math.min(1,Math.max(0,t))}function d(t,e,s){return Math.min(s,Math.max(e,t))}function c(t,e,s){return t*(1-s)+e*s}function u(t,e,s,i,n){return(t-e)/(s-e)*(n-i)+i}function f(t){for(;t>=r;)t-=r;for(;t<0;)t+=r;return t}},222:function(t,e,s){"use strict";var i;s.d(e,"a",(function(){return i})),s.d(e,"b",(function(){return n})),function(t){t[t.NONE=0]="NONE",t[t.DEPTH=2]="DEPTH",t[t.LINEAR=4]="LINEAR"}(i||(i={}));class n{constructor(){this.post=null,this._flags=0}_init(t){this.post!==t&&(this.post=t,this.init())}}},230:function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));var i=s(41);const n=new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,1,1,1]);class r extends i.a{constructor(t,e=-1,s=-1,i=2,r=2){super(t);const o=n;o[0]=o[4]=e,o[1]=o[9]=s,o[8]=o[12]=e+i,o[5]=o[13]=s+r,this.data(o),this.attrib("aPosition",2,t.FLOAT),this.attrib("aTexCoord",2,t.FLOAT)}render(){this.drawTriangleStrip()}}},232:function(t,e,s){"use strict";s.d(e,"a",(function(){return d}));var i=s(78),n=s(1);const r=n.vec2.create();var o;function h(t,e,s){return s?t|e:t&~e}!function(t){t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down"}(o||(o={}));class a{constructor(t){this.nativeTouch=t,this.id=t.identifier,this.startTime=Date.now(),this.onEnd=new i.a,this.startCoords=n.vec2.create(),this.coords=n.vec2.create(),this.ncoords=n.vec2.create(),this.pcoords=n.vec2.create(),this.update(t),this.startCoords.set(this.coords)}get duration(){return Date.now()-this.startTime}getDelta(t){t[0]=this.coords[0]-this.startCoords[0],t[1]=this.coords[1]-this.startCoords[1]}getDeltaLength(){return this.getDelta(r),n.vec2.length(r)}update(t){const e=t.clientX,s=t.clientY;this.pcoords[0]=e,this.pcoords[1]=s,this.coords[0]=2*e/window.innerWidth-1,this.coords[1]=-(2*s/window.innerHeight-1),this.ncoords[0]=2*e/window.innerWidth-1,this.ncoords[1]=-(2*s/window.innerHeight-1)}end(){this.onEnd.emit(),this.onEnd.release()}}class d{constructor(t){if(this.keyHandler=t=>{if(t.defaultPrevented)return;const e="keydown"==t.type;switch(t.key){case"Left":case"ArrowLeft":this.keyPressedBits=h(this.keyPressedBits,o.Left,e);break;case"Right":case"ArrowRight":this.keyPressedBits=h(this.keyPressedBits,o.Right,e);break;case"Up":case"ArrowUp":this.keyPressedBits=h(this.keyPressedBits,o.Up,e);break;case"Down":case"ArrowDown":this.keyPressedBits=h(this.keyPressedBits,o.Down,e);break;default:return}},this.touchstart=t=>{for(var e=0;e<t.changedTouches.length;e++)this.addTouch(t.changedTouches[e])},this.touchmove=t=>{if(t.touches.length<this.touches.length)for(var e=Array.from(t.touches).map(t=>t.identifier),s=this.touches.length-1;s>-1;s--){var i=this.touches[s];-1===e.indexOf(i.id)&&this.removeTouchId(i.id)}var n=t.changedTouches;for(s=0;s<n.length;s++)this.touchesById[n[s].identifier].update(n[s])},this.touchend=t=>{for(var e=0;e<t.changedTouches.length;e++)this.removeTouch(t.changedTouches[e])},this.mousehandler=t=>{if(this._handleMouse&&(this.mpos[0]=2*t.clientX/window.innerWidth-1,this.mpos[1]=-(2*t.clientY/window.innerHeight-1)),!this._handleMouse)return;0!=(1&function(t){return void 0===t.buttons?1<<t.which:t.buttons}(t))&&(c.clientX=t.clientX,c.clientY=t.clientY,void 0===this.touchesById.mouse0?this.touchstart(u):this.touchmove(u))},this.mouseend=t=>{this._handleMouse&&this.touchend(u)},this.el=t,this.keyPressedBits=0,this.touches=[],this.touchesById={},this.onTouchAdded=new i.a,this.onTouchRemoved=new i.a,this.mpos=n.vec2.create(),this._isDown=!1,this._handleMouse=!0,void 0!==t){const e=s=>{this._handleMouse=!1,t.removeEventListener("touchstart",e)};t.addEventListener("touchstart",e)}}get isDown(){return this._isDown}start(t){if(void 0!==t){this.el=t;const e=s=>{this._handleMouse=!1,t.removeEventListener("touchstart",e)};t.addEventListener("touchstart",e)}const e=document.body,s=window;t=this.el,e.addEventListener("keydown",this.keyHandler),e.addEventListener("keyup",this.keyHandler),s.addEventListener("mousemove",this.mousehandler),t.addEventListener("mousedown",this.mousehandler),e.addEventListener("mouseleave",this.mouseend),e.addEventListener("mouseup",this.mouseend),t.addEventListener("touchmove",this.touchmove),t.addEventListener("touchstart",this.touchstart),e.addEventListener("touchend",this.touchend)}release(){var t=this.el;const e=document.body,s=window;this.removeAllTouch(),e.addEventListener("keydown",this.keyHandler),e.addEventListener("keyup",this.keyHandler),s.removeEventListener("mousemove",this.mousehandler),t.removeEventListener("mousedown",this.mousehandler),e.removeEventListener("mouseleave",this.mouseend),e.removeEventListener("mouseup",this.mouseend),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchend",this.touchend)}addTouch(t){var e=new a(t);this.touches.push(e),this.touchesById[e.id]=e,this.onTouchAdded.emit(e),this._isDown=!0}removeTouch(t){this.removeTouchId(t.identifier)}removeTouchId(t){var e=this.touchesById[t];void 0!==e&&(this.touches.splice(this.touches.indexOf(e),1),delete this.touchesById[e.id],e.end(),this.onTouchRemoved.emit(e)),0==this.touches.length&&(this._isDown=!1)}removeAllTouch(){for(var t=0;t<this.touches.length;t++)this.touches[t].end(),this.onTouchRemoved.emit(this.touches[t]);this.touches=[],this.touchesById={}}get keyPressed(){return 0!=this.keyPressedBits}get keyDown(){return 0!=(this.keyPressedBits&o.Down)}get keyUp(){return 0!=(this.keyPressedBits&o.Up)}get keyLeft(){return 0!=(this.keyPressedBits&o.Left)}get keyRight(){return 0!=(this.keyPressedBits&o.Right)}}var c={identifier:"mouse0",clientX:0,clientY:0},u={changedTouches:[c],touches:[c]}},234:function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var i=s(292),n=s(293),r=s(110);class o{constructor(t,e="default"){this._effectList=[],this.scene=t,this.name=e,this.post=new n.a(t.gl,!1),this.post.enabled=r.a.param("post"),this.fetch=new i.a,this.post.add(this.fetch)}get enabled(){return this.post.enabled}set enabled(t){this.post.enabled=t}addEffect(t){this._effectList.push(t),this.post.add(t)}qualityChange(){this.post.enabled=r.a.param("post")}preRender(t,e){this.post.preRender(t,e)}bindColor(){this.post.bindColor()}render(t,e=this.post.renderWidth,s=this.post.renderHeight){const i=this.post;if(!i.enabled)return;const n=i.gl;i.mainColor.bind(),i.mainColor.setFilter(!0,!1,!1),i.mipmap&&n.generateMipmap(n.TEXTURE_2D);for(var r=0;r<i._effects.length;r++)i._effects[r].preRender();void 0!==t?t.bind():n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,e,s),n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),i._shaderInvalid&&i.buildProgram(),i.prg.use();for(r=0;r<i._effects.length;r++)i._effects[r].setupProgram(i.prg);if(i.prg.tInput(i.mainColor),i._needDepth()){if(!i.hasDepthTexture)throw"no depth texture";i.prg.tDepth(i.mainFbo.getDepth())}i.fillScreen(i.prg)}}},239:function(t,e,s){"use strict";s.d(e,"a",(function(){return h}));var i=s(47);const n=i.b;var r=class{constructor(){this._stack=new Uint16Array(16*(0|n)|0),this._sets=new Uint32Array(16),this._size=16,this._ptr=0,this._headPos=0,this._wcfg=new i.c}initFromGL(t){this._ptr=0,this._wcfg.fromGL(t),this._sets[0]=0,this._stack.set(this._wcfg._dat)}push(t){this._ptr+1===this._size&&this._grow();const e=t._set,s=++this._ptr,r=s*(0|n),o=t._dat,h=this._stack;this._sets[s]=this._sets[s-1]|e;for(var a=0;a<(0|n);a++){var d;d=0!=(e&i.a[a])?o[a]:h[r+a-(0|n)],h[r+a]=d}}pop(){const t=--this._ptr;this._headPos>t&&(this._sets[t]|=this._sets[t+1],this._headPos=t)}flush(){for(;this._ptr>0;)this.pop()}commit(t){const e=this._ptr;this.copyConfig(e,t),this._headPos=e,e>0&&(this._sets[e-1]|=this._sets[e]),this._sets[e]=0}patch(t,e){this.copyConfig(this._ptr,this._wcfg),this._wcfg.patch(t,e)}copyConfig(t,e){const s=e._dat,i=this._stack,r=0|t*(0|n);for(var o=0;o<(0|n);o++)s[o]=i[r+o];e._set=this._sets[t]}_grow(){const t=this._size<<1,e=new Uint16Array(t*(0|n)),s=new Uint32Array(t);e.set(this._stack,0),s.set(this._sets,0),this._stack=e,this._sets=s,this._size=t}};const o=new i.c;class h{constructor(t){this.gl=t,this.cfgStack=new r,this.cfgStack.initFromGL(t),this._validCfg=!1}static config(){return new i.c}push(t){this.cfgStack.push(t),this._validCfg=!1}pop(){this.cfgStack.pop(),this._validCfg=!1}apply(){this._validCfg||(this.cfgStack.commit(o),o.setupGL(this.gl),this._validCfg=!0)}now(t){this.push(t),this.apply(),this.pop()}config(){return new a(this)}}class a extends i.c{constructor(t){super(),this.state=t}apply(){this.state.now(this)}}},267:function(t,e){var s=function(t){return"precision highp float;\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec2 aTexCoord0;\n\nOUT vec2 vTexCoordVP;\nOUT vec2 vTexCoordFull;\n\nuniform vec2 uViewportScale;\n\nvoid main(void)\n{\n  vTexCoordVP   = aTexCoord0 * uViewportScale;\n  vTexCoordFull = aTexCoord0;\n\n  gl_Position.xy = 2.0 * aTexCoord0-vec2(1.0,1.0);\n  gl_Position.zw = vec2(0.0,1.0);\n}\n","precision highp float;\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec2 aTexCoord0;\n\nOUT vec2 vTexCoordVP;\nOUT vec2 vTexCoordFull;\n\nuniform vec2 uViewportScale;\n\nvoid main(void)\n{\n  vTexCoordVP   = aTexCoord0 * uViewportScale;\n  vTexCoordFull = aTexCoord0;\n\n  gl_Position.xy = 2.0 * aTexCoord0-vec2(1.0,1.0);\n  gl_Position.zw = vec2(0.0,1.0);\n}\n"};s.toString=s,t.exports=s},292:function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var i=s(222),n=s(309),r=s.n(n);class o extends i.b{constructor(){super(),this._code=r()()}genCode(t,e){e.push(this._code)}init(){}release(){}preRender(){}setupProgram(t){}resize(t,e){}}},293:function(t,e,s){"use strict";s.d(e,"a",(function(){return l}));var i=s(76),n=s(77),r=s(41),o=s(86),h=s(310),a=s.n(h),d=s(267),c=s.n(d),u=s(222),f=s(15);class l{constructor(t,e=!1){if(this.gl=t,this._effects=[],this._flags=0,this._shaderInvalid=!0,this.renderWidth=1,this.renderHeight=1,this.bufferWidth=1,this.bufferHeight=1,this.enabled=!0,this.mipmap=e,this.float_texture_ext=t.getExtension("OES_texture_float"),this.halfFloat=t.getExtension("OES_texture_half_float"),this.float_texture_ext_l=t.getExtension("OES_texture_half_float_linear"),this.halfFloat_l=t.getExtension("OES_texture_float_linear"),this.color_buffer_float=t.getExtension("EXT_color_buffer_float"),this.hasDepthTexture=o.a.getInstance(t).hasDepthTexture(),this.mainFbo=this.genFbo(),this.mainColor=this.mainFbo.getColor(0),this.mipmap){this.mainColor.bind(),t.generateMipmap(t.TEXTURE_2D),t.getError()&&(this.mipmap=!1,this.mainFbo.dispose(),this.mainFbo=this.genFbo(),this.mainColor=this.mainFbo.getColor(0))}this.mainColor.setFilter(!1,this.mipmap,!1),this.prg=new i.a(t);const s=new Float32Array([0,0,1,0,0,1,1,1]);this.fsPlane=new r.a(t,s),this.fsPlane.attrib("aTexCoord0",2,t.FLOAT)}dispose(){this.mainFbo.dispose(),this.fsPlane.dispose(),this.prg.dispose()}_needDepth(){return 0!=(this._flags&u.a.DEPTH)}_needLinear(){return 0!=(this._flags&u.a.LINEAR)}genFbo(){const t=this.gl,e=o.a.getInstance(t),s=t.getContextAttributes(),i=[e.RGB16F,e.RGBA16F,e.RGB32F,e.RGBA32F,e.RGB8];Object(f.a)(t);const r=e.getRenderableFormat(i),h=new n.a(t);h.bind(),h.attachColor(r.format,r.type,r.internal),h.attachDepth(s.depth,s.stencil,this.hasDepthTexture),h.resize(4,4);const a=h.getColor(0);if(a.bind(),a.clamp(),this.hasDepthTexture){const t=h.getDepth();t.bind(),t.clamp(),t.setFilter(!1,!1,!1)}return h}add(t){-1===this._effects.indexOf(t)&&(this._effects.push(t),t._init(this),t.resize(this.renderWidth,this.renderHeight),this._flags|=t._flags,this._shaderInvalid=!0)}remove(t){const e=this._effects.indexOf(t);if(e>-1&&(this._effects.splice(e,1),t.release(),t.post=null,this._shaderInvalid=!0,0!==t._flags)){this._flags=0;for(var s=0;s<this._effects.length;s++)this._flags|=t._flags}}resize(t,e){this.bufferWidth=t,this.bufferHeight=e,this.mainFbo.resize(this.bufferWidth,this.bufferHeight);for(var s=0;s<this._effects.length;s++)this._effects[s].resize(t,e)}preRender(t,e){if(this.renderWidth=t,this.renderHeight=e,this.enabled){const s=this.mipmap?p(t):t,i=this.mipmap?p(e):e;this.bufferWidth===s&&this.bufferHeight===i||this.resize(s,i)}}needDepthPass(){return this.enabled&&this._needDepth()&&!this.hasDepthTexture}bindColor(){const t=this.gl;this.enabled?this.mainFbo.bind():t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.renderWidth,this.renderHeight),this.mainFbo.clear()}render(t){if(!this.enabled)return;const e=this.gl;this.mainColor.bind(),this.mipmap&&e.generateMipmap(e.TEXTURE_2D);for(var s=0;s<this._effects.length;s++)this._effects[s].preRender();void 0!==t?(t.resize(this.renderWidth,this.renderHeight),t.bind()):e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.renderWidth,this.renderHeight),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this._shaderInvalid&&this.buildProgram(),this.prg.use();for(s=0;s<this._effects.length;s++)this._effects[s].setupProgram(this.prg);if(this.prg.tInput(this.mainColor),this._needDepth()){if(!this.hasDepthTexture)throw"no depth texture";this.prg.tDepth(this.mainFbo.getDepth())}this.fillScreen(this.prg)}fillScreen(t,e=!1){!0===e?t.uViewportScale(1,1):t.uViewportScale(this.renderWidth/this.bufferWidth,this.renderHeight/this.bufferHeight),this.fsPlane.attribPointer(t),this.fsPlane.drawTriangleStrip()}buildProgram(){for(var t=[],e=[],s=this._effects,i=0;i<s.length;i++)s[i].genCode(e,t);const n=t.join("\n"),r=e.join("\n");var o=a()({code:n,precode:r}),h=c()(),d=this._needDepth()&&this.hasDepthTexture,u="";Object(f.a)(this.gl)&&(u+="#version 300 es\n"),u+="precision highp float;\n",u+="#define NEED_DEPTH "+ +this._needDepth()+"\n",u+="#define TEXTURE_DEPTH "+ +d+"\n",this.prg.compile(h,o,u),this._shaderInvalid=!1,this.mainColor.bind(),this.mainColor.setFilter(this._needLinear(),this.mipmap,!1)}}function p(t){for(var e=1;e<t;)e<<=1;return e>4096&&(e=4096),e}},309:function(t,e){var s=function(t){return"\nc = texture2D(tInput,texCoordVP).xyz;","\nc = texture2D(tInput,texCoordVP).xyz;"};s.toString=s,t.exports=s},310:function(t,e){var s=function(t){var e="";return e+="\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\nuniform sampler2D tInput;\nIN vec2 vTexCoordVP;\nIN vec2 vTexCoordFull;\n\n#if NEED_DEPTH\n  uniform sampler2D tDepth;\n#endif\n\n\n#if TEXTURE_DEPTH\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return texture2D(t,uvs).x;\n  }\n#else\n  \n  highp float decodeDepthRGB(highp vec3 rgb){\n    return(rgb.x+rgb.y*(1.0/255.0))+rgb.z*(1.0/65025.0);\n  }\n\n  float FETCH_DEPTH( sampler2D t, vec2 uvs ){\n    return decodeDepthRGB( texture2D(t,uvs).xyz );\n  }\n#endif\n\n\n\nvec3 sRGB( vec3 c )\n{\n  return c * ( c * ( c*0.305306011 + vec3(0.682171111) ) + vec3(0.012522878) );\n}\n\nfloat luminance( vec3 c )\n{\n  return dot( c, vec3(0.3,0.59,0.11) );\n}\n\n\n\n"+t.precode+"\n\n\nvoid main(void){\n  vec3 c;\n\n  vec2 texCoordVP   = vTexCoordVP;\n  vec2 texCoordFull = vTexCoordFull;\n\n\n  #if NEED_DEPTH\n    float sceneDepth = FETCH_DEPTH( tDepth, texCoordVP );\n  #endif\n\n  "+t.code+"\n\n  FragColor.xyz=c;\n  FragColor.w=1.0;\n\n}"};s.toString=s,t.exports=s}}]);