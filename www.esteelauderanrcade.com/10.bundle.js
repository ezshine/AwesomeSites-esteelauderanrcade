(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{487:function(t,e){var i=function(t){return"attribute vec3 aPosition;\nattribute float aSize;\nattribute float aLife;\n\nattribute vec4 aSettings;\n\nuniform mat4 uMVP;\nuniform mat4 uMV;\n\nvoid main(void)\n{\n    // Position\n    vec4 finalPosition = uMVP * vec4(aPosition, 1.0);\n    gl_Position = finalPosition;\n\n    // Size\n    vec4 modelViewPosition = uMV * vec4(aPosition, 1.0);\n\n    gl_PointSize = aSize * aLife;\n    gl_PointSize *= (1.0 / - modelViewPosition.z);\n    gl_PointSize = max(gl_PointSize, 1.0);\n}","attribute vec3 aPosition;\nattribute float aSize;\nattribute float aLife;\n\nattribute vec4 aSettings;\n\nuniform mat4 uMVP;\nuniform mat4 uMV;\n\nvoid main(void)\n{\n    // Position\n    vec4 finalPosition = uMVP * vec4(aPosition, 1.0);\n    gl_Position = finalPosition;\n\n    // Size\n    vec4 modelViewPosition = uMV * vec4(aPosition, 1.0);\n\n    gl_PointSize = aSize * aLife;\n    gl_PointSize *= (1.0 / - modelViewPosition.z);\n    gl_PointSize = max(gl_PointSize, 1.0);\n}"};i.toString=i,t.exports=i},488:function(t,e){var i=function(t){return"uniform vec3 uColor;\n\nvoid main(void)\n{\n    float intensity = distance(gl_PointCoord, vec2(0.5));\n    intensity = step(intensity, 0.5);\n\n    gl_FragColor = vec4(uColor * 1.75, pow(intensity, 3.0));\n}\n","uniform vec3 uColor;\n\nvoid main(void)\n{\n    float intensity = distance(gl_PointCoord, vec2(0.5));\n    intensity = step(intensity, 0.5);\n\n    gl_FragColor = vec4(uColor * 1.75, pow(intensity, 3.0));\n}\n"};i.toString=i,t.exports=i},489:function(t,e){var i=function(t){return"uniform mat4 uM;\nuniform mat4 uMVP;\nuniform float uTime;\nuniform vec3 uCameraPosition;\nuniform float uFresnelPower;\nuniform float uFresnelMultiplier;\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\n\nvarying vec3 vPosition;\nvarying float vFresnel;\n\nvoid main(void)\n{\n    // Position\n    vec3 position = aPosition;\n    position += aNormal * sin(position.y * 5.0 - uTime * 3.0) * 0.02;\n    position += aNormal * sin(position.x * 5.0 - uTime * 2.567) * 0.02;\n\n    vec4 finalPosition = uMVP * vec4(position, 1.0);\n    gl_Position = finalPosition;\n\n    // Fresnel\n    vec4 modelPosition = uM * vec4(aPosition, 1.0);\n    vec3 cameraToVertex = normalize(modelPosition.xyz - uCameraPosition);\n    float fresnel = dot(aNormal, cameraToVertex);\n    fresnel = abs(fresnel);\n    fresnel = 1.0 - clamp(fresnel, 0.0, 1.0);\n    fresnel = pow(fresnel, uFresnelPower);\n    fresnel *= uFresnelMultiplier;\n\n    // Attributes\n    vFresnel = fresnel;\n    vPosition = aPosition;\n}","uniform mat4 uM;\nuniform mat4 uMVP;\nuniform float uTime;\nuniform vec3 uCameraPosition;\nuniform float uFresnelPower;\nuniform float uFresnelMultiplier;\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\n\nvarying vec3 vPosition;\nvarying float vFresnel;\n\nvoid main(void)\n{\n    // Position\n    vec3 position = aPosition;\n    position += aNormal * sin(position.y * 5.0 - uTime * 3.0) * 0.02;\n    position += aNormal * sin(position.x * 5.0 - uTime * 2.567) * 0.02;\n\n    vec4 finalPosition = uMVP * vec4(position, 1.0);\n    gl_Position = finalPosition;\n\n    // Fresnel\n    vec4 modelPosition = uM * vec4(aPosition, 1.0);\n    vec3 cameraToVertex = normalize(modelPosition.xyz - uCameraPosition);\n    float fresnel = dot(aNormal, cameraToVertex);\n    fresnel = abs(fresnel);\n    fresnel = 1.0 - clamp(fresnel, 0.0, 1.0);\n    fresnel = pow(fresnel, uFresnelPower);\n    fresnel *= uFresnelMultiplier;\n\n    // Attributes\n    vFresnel = fresnel;\n    vPosition = aPosition;\n}"};i.toString=i,t.exports=i},490:function(t,e,i){var s=function(t){var e="";return e+="uniform float uTime;\nuniform vec3 uPerlinPositionFrequency;\nuniform float uPerlinTimeFrequency;\nuniform float uPerlinOffset;\nuniform float uPerlinMultiplier;\nuniform vec3 uColorStart;\nuniform vec3 uColorEnd;\nuniform float uGlowMask;\nuniform float uGlowMultiplier;\n\nvarying vec3 vPosition;\nvarying float vFresnel;\n\n"+i(491)()+"\n\nvoid main(void)\n{\n    float intensity = uPerlinOffset - abs(snoise(vec4(vPosition * uPerlinPositionFrequency, uTime * uPerlinTimeFrequency)) * uPerlinMultiplier);\n    intensity += vFresnel;\n\n    vec3 color = mix(uColorStart, uColorEnd, intensity);\n    float glowMask = step(- intensity, - uGlowMask);\n    color *= 1.0 + glowMask * uGlowMultiplier;\n    // color = vec3(glowMask);\n\n    gl_FragColor = vec4(color, 1.0);\n}\n"};s.toString=s,t.exports=s},491:function(t,e){var i=function(t){return"//\tSimplex 4D Noise \n//\tby Ian McEwan, Ashima Arts\n//\n\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\nfloat permute(float x){return floor(mod(((x*34.0)+1.0)*x, 289.0));}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\nfloat taylorInvSqrt(float r){return 1.79284291400159 - 0.85373472095314 * r;}\n\nvec4 grad4(float j, vec4 ip){\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www; \n\n  return p;\n}\n\nfloat snoise(vec4 v){\n  const vec2  C = vec2( 0.138196601125010504,  // (5 - sqrt(5))/20  G4\n                        0.309016994374947451); // (sqrt(5) - 1)/4   F4\n// First corner\n  vec4 i  = floor(v + dot(v, C.yyyy) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C \n  vec4 x1 = x0 - i1 + 1.0 * C.xxxx;\n  vec4 x2 = x0 - i2 + 2.0 * C.xxxx;\n  vec4 x3 = x0 - i3 + 3.0 * C.xxxx;\n  vec4 x4 = x0 - 1.0 + 4.0 * C.xxxx;\n\n// Permutations\n  i = mod(i, 289.0); \n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n// Gradients\n// ( 7*7*6 points uniformly over a cube, mapped onto a 4-octahedron.)\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n}","//\tSimplex 4D Noise \n//\tby Ian McEwan, Ashima Arts\n//\n\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\nfloat permute(float x){return floor(mod(((x*34.0)+1.0)*x, 289.0));}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\nfloat taylorInvSqrt(float r){return 1.79284291400159 - 0.85373472095314 * r;}\n\nvec4 grad4(float j, vec4 ip){\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www; \n\n  return p;\n}\n\nfloat snoise(vec4 v){\n  const vec2  C = vec2( 0.138196601125010504,  // (5 - sqrt(5))/20  G4\n                        0.309016994374947451); // (sqrt(5) - 1)/4   F4\n// First corner\n  vec4 i  = floor(v + dot(v, C.yyyy) );\n  vec4 x0 = v -   i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n//  i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  //  x0 = x0 - 0.0 + 0.0 * C \n  vec4 x1 = x0 - i1 + 1.0 * C.xxxx;\n  vec4 x2 = x0 - i2 + 2.0 * C.xxxx;\n  vec4 x3 = x0 - i3 + 3.0 * C.xxxx;\n  vec4 x4 = x0 - 1.0 + 4.0 * C.xxxx;\n\n// Permutations\n  i = mod(i, 289.0); \n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n// Gradients\n// ( 7*7*6 points uniformly over a cube, mapped onto a 4-octahedron.)\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0,   ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n// Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n// Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n}"};i.toString=i,t.exports=i},492:function(t,e){var i=function(t){return"attribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\nvoid main(void)\n{\n    // Position\n    vec4 finalPosition = uMVP * vec4(aPosition, 1.0);\n    gl_Position = finalPosition;\n}","attribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\nvoid main(void)\n{\n    // Position\n    vec4 finalPosition = uMVP * vec4(aPosition, 1.0);\n    gl_Position = finalPosition;\n}"};i.toString=i,t.exports=i},493:function(t,e){var i=function(t){return"uniform vec3 uColor;\nuniform float uAlpha;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(uColor, uAlpha);\n}\n","uniform vec3 uColor;\nuniform float uAlpha;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(uColor, uAlpha);\n}\n"};i.toString=i,t.exports=i},494:function(t,e){var i=function(t){return"// attribute vec3 aNormal;\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord0;\n\nuniform mat4 uMVP;\nuniform float uProgress;\nuniform float uGrow;\n\n#define M_PI 3.1415926535897932384626433832795\n\nvoid main(void)\n{\n    // Position\n    vec3 basePosition = aPosition;\n    basePosition += aNormal * uGrow;\n    float radius = distance(basePosition, vec3(0.0));\n    float angle = atan(basePosition.x, basePosition.z);\n\n    // Apply progress base on text coordinate Y\n    float progressOffset = (aTexCoord0.y - 0.5) * 2.0 * M_PI * (1.0 - uProgress);\n    angle += progressOffset;\n\n    // Pop the rounded tip\n    float tipSelector = step(0.999, abs((aTexCoord0.y - 0.5) * 2.0));\n    angle += tipSelector * M_PI * (1.2 / 180.0) * (- sign(aTexCoord0.y - 0.5));\n\n    // Set the final position\n    vec3 position = vec3(\n        sin(angle) * radius,\n        basePosition.y,\n        cos(angle) * radius\n    );\n\n    vec4 finalPosition = uMVP * vec4(position, 1.0);\n    gl_Position = finalPosition;\n}","// attribute vec3 aNormal;\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord0;\n\nuniform mat4 uMVP;\nuniform float uProgress;\nuniform float uGrow;\n\n#define M_PI 3.1415926535897932384626433832795\n\nvoid main(void)\n{\n    // Position\n    vec3 basePosition = aPosition;\n    basePosition += aNormal * uGrow;\n    float radius = distance(basePosition, vec3(0.0));\n    float angle = atan(basePosition.x, basePosition.z);\n\n    // Apply progress base on text coordinate Y\n    float progressOffset = (aTexCoord0.y - 0.5) * 2.0 * M_PI * (1.0 - uProgress);\n    angle += progressOffset;\n\n    // Pop the rounded tip\n    float tipSelector = step(0.999, abs((aTexCoord0.y - 0.5) * 2.0));\n    angle += tipSelector * M_PI * (1.2 / 180.0) * (- sign(aTexCoord0.y - 0.5));\n\n    // Set the final position\n    vec3 position = vec3(\n        sin(angle) * radius,\n        basePosition.y,\n        cos(angle) * radius\n    );\n\n    vec4 finalPosition = uMVP * vec4(position, 1.0);\n    gl_Position = finalPosition;\n}"};i.toString=i,t.exports=i},495:function(t,e){var i=function(t){return"uniform vec3 uColor;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(uColor, 1.0);\n}\n","uniform vec3 uColor;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(uColor, 1.0);\n}\n"};i.toString=i,t.exports=i},496:function(t,e){var i=function(t){return"attribute vec2 aPosition;\nattribute vec2 aUv;\n\nvarying vec2 vUv;\n\nvoid main(void)\n{\n    vUv = aUv;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}","attribute vec2 aPosition;\nattribute vec2 aUv;\n\nvarying vec2 vUv;\n\nvoid main(void)\n{\n    vUv = aUv;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}"};i.toString=i,t.exports=i},497:function(t,e){var i=function(t){return"uniform vec2 uResolution;\nuniform float uTime;\nuniform vec3 uColorStart;\nuniform vec3 uColorEnd;\n\nuniform float uStarFrequency;\nuniform float uStarSize;\nuniform float uGlowStrength;\nuniform float uTimeFrequency;\nuniform vec2 uOffset;\n\nvarying vec2 vUv;\n\nfloat random(in vec2 _st)\n{\n    return fract(sin(dot(_st.xy, vec2(12.9898,78.233))) * 43758.5453123);\n}\n\nvoid main(void)\n{\n    // Base color gradient\n    vec3 backgroundColor = mix(uColorStart, uColorEnd, vUv.y);\n\n    // Add stars\n    vec2 starUv = (vUv + uOffset) * uResolution * vec2(uStarFrequency);\n    vec2 starTile = mod(starUv, 1.0);\n    float starSize = random(floor(starUv)) * uStarSize;\n    vec2 starCenter = vec2(\n        0.5 + (random(floor(starUv + 10.0)) - 0.5) * 0.5,\n        0.5 + (random(floor(starUv + 20.0)) - 0.5) * 0.5\n    );\n\n    float starStrength = step(distance(starTile, starCenter), starSize);\n\n    float starChance = random(floor(starUv + 30.0));\n    starStrength *= step(starChance, pow(vUv.y, 3.0));\n\n    float randomTimeOffset = random(floor(starUv + 40.0));\n    starStrength *= sin(uTime * uTimeFrequency + randomTimeOffset * 3.14 * 2.0);\n    starStrength = clamp(starStrength, 0.0, 100.0);\n\n    backgroundColor = mix(backgroundColor, vec3(1.0), starStrength * uGlowStrength);\n\n    // Output\n    gl_FragColor = vec4(backgroundColor, 1.0);\n}","uniform vec2 uResolution;\nuniform float uTime;\nuniform vec3 uColorStart;\nuniform vec3 uColorEnd;\n\nuniform float uStarFrequency;\nuniform float uStarSize;\nuniform float uGlowStrength;\nuniform float uTimeFrequency;\nuniform vec2 uOffset;\n\nvarying vec2 vUv;\n\nfloat random(in vec2 _st)\n{\n    return fract(sin(dot(_st.xy, vec2(12.9898,78.233))) * 43758.5453123);\n}\n\nvoid main(void)\n{\n    // Base color gradient\n    vec3 backgroundColor = mix(uColorStart, uColorEnd, vUv.y);\n\n    // Add stars\n    vec2 starUv = (vUv + uOffset) * uResolution * vec2(uStarFrequency);\n    vec2 starTile = mod(starUv, 1.0);\n    float starSize = random(floor(starUv)) * uStarSize;\n    vec2 starCenter = vec2(\n        0.5 + (random(floor(starUv + 10.0)) - 0.5) * 0.5,\n        0.5 + (random(floor(starUv + 20.0)) - 0.5) * 0.5\n    );\n\n    float starStrength = step(distance(starTile, starCenter), starSize);\n\n    float starChance = random(floor(starUv + 30.0));\n    starStrength *= step(starChance, pow(vUv.y, 3.0));\n\n    float randomTimeOffset = random(floor(starUv + 40.0));\n    starStrength *= sin(uTime * uTimeFrequency + randomTimeOffset * 3.14 * 2.0);\n    starStrength = clamp(starStrength, 0.0, 100.0);\n\n    backgroundColor = mix(backgroundColor, vec3(1.0), starStrength * uGlowStrength);\n\n    // Output\n    gl_FragColor = vec4(backgroundColor, 1.0);\n}"};i.toString=i,t.exports=i},498:function(t,e){var i=function(t){return"applyZboing(vertex.position.xyz, vertex.normal);","applyZboing(vertex.position.xyz, vertex.normal);"};i.toString=i,t.exports=i},499:function(t,e){var i=function(t){return"uniform float uDropPressure;\n\n// mat4 rotationMatrix(vec3 axis, float angle)\n// {\n//     axis = normalize(axis);\n//     float s = sin(angle);\n//     float c = cos(angle);\n//     float oc = 1.0 - c;\n    \n//     return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n//                 oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n//                 oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n//                 0.0,                                0.0,                                0.0,                                1.0);\n// }\n\n#define M_PI 3.1415926535897932384626433832795\n\nvoid applyZboing(inout vec3 pos, inout vec3 nrm)\n{\n    vec3 originalPos = pos;\n\n    // Apply compression\n    float distanceToCenter = length(originalPos.xz);\n    float compressionStrength = cos(distanceToCenter * 1.5);\n    compressionStrength *= step(- originalPos.y, 2.0);\n    compressionStrength *= uDropPressure;\n    pos.y += compressionStrength;\n\n    // Apply enlargement\n    float distanceToTop = abs(pos.y);\n    float enlargementStrength = sin((min(distanceToTop * 0.8, M_PI * 0.5) - 0.5) * M_PI) + 1.0;\n    enlargementStrength *= - uDropPressure * 0.03;\n    vec2 enlargementDirection = nrm.xz;\n    pos.xz += enlargementDirection * enlargementStrength;\n\n    // // Normal\n    // float strengthTemp = (cos(distanceToCenter * 1.5 * 2.0 + 3.1415) + 1.0) * 0.5;\n    // strengthTemp *= step(- pos.y, 2.0);\n    // strengthTemp *= uDropPressure;\n\n    // vec3 axis = cross(nrm, - pos);\n    // mat4 rotationMat = rotationMatrix(axis, - strengthTemp * 0.4);\n    // vec4 newNormal = rotationMat * vec4(nrm, 1.0);\n    // nrm.xyz = newNormal.xyz;\n}","uniform float uDropPressure;\n\n// mat4 rotationMatrix(vec3 axis, float angle)\n// {\n//     axis = normalize(axis);\n//     float s = sin(angle);\n//     float c = cos(angle);\n//     float oc = 1.0 - c;\n    \n//     return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n//                 oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n//                 oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n//                 0.0,                                0.0,                                0.0,                                1.0);\n// }\n\n#define M_PI 3.1415926535897932384626433832795\n\nvoid applyZboing(inout vec3 pos, inout vec3 nrm)\n{\n    vec3 originalPos = pos;\n\n    // Apply compression\n    float distanceToCenter = length(originalPos.xz);\n    float compressionStrength = cos(distanceToCenter * 1.5);\n    compressionStrength *= step(- originalPos.y, 2.0);\n    compressionStrength *= uDropPressure;\n    pos.y += compressionStrength;\n\n    // Apply enlargement\n    float distanceToTop = abs(pos.y);\n    float enlargementStrength = sin((min(distanceToTop * 0.8, M_PI * 0.5) - 0.5) * M_PI) + 1.0;\n    enlargementStrength *= - uDropPressure * 0.03;\n    vec2 enlargementDirection = nrm.xz;\n    pos.xz += enlargementDirection * enlargementStrength;\n\n    // // Normal\n    // float strengthTemp = (cos(distanceToCenter * 1.5 * 2.0 + 3.1415) + 1.0) * 0.5;\n    // strengthTemp *= step(- pos.y, 2.0);\n    // strengthTemp *= uDropPressure;\n\n    // vec3 axis = cross(nrm, - pos);\n    // mat4 rotationMat = rotationMatrix(axis, - strengthTemp * 0.4);\n    // vec4 newNormal = rotationMat * vec4(nrm, 1.0);\n    // nrm.xyz = newNormal.xyz;\n}"};i.toString=i,t.exports=i},500:function(t,e,i){t.exports=i.p+"assets/img/logo-beauty-bounce-cf400f54.png"},501:function(t,e,i){t.exports=i.p+"assets/img/poster-game4-rule1-53faa0a0.jpg"},502:function(t,e,i){t.exports=i.p+"assets/img/poster-game4-rule2-d8b54a7a.jpg"},503:function(t,e,i){t.exports=i.p+"assets/img/poster-game4-rule3-087e477f.jpg"},504:function(t,e,i){var s={"./share-challenge-game-4-desktop.png":505,"./share-challenge-game-4-mobile.png":506};function a(t){var e=o(t);return i(e)}function o(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}a.keys=function(){return Object.keys(s)},a.resolve=o,t.exports=a,a.id=504},505:function(t,e,i){t.exports=i.p+"assets/img/share-challenge-game-4-desktop-b21faf38.png"},506:function(t,e,i){t.exports=i.p+"assets/img/share-challenge-game-4-mobile-f8b00139.png"},507:function(t,e,i){t.exports=i.p+"assets/img/share-game-4-7161933f.png"},512:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("score-ui",{attrs:{active:t.isStarted&&!t.gameState.ended,score:t.gameState.score,health:t.gameState.health}}),t._v(" "),t.isLoaded?i("scoreboard",{attrs:{"is-game-ended":t.gameState.ended,"game-id":t.gameState.gameId,score:t.finalScore,"product-img":this.getResource("share-product"),"push-img":this.getResource("share-push"),"share-game-img":this.getResource("share-game"),"share-game-canvas-img":this.getResource("share-game-canvas"),"share-label":t.t("gaming.score_name_points"),"share-text-y":225,"game-thumbnails":[this.getResource("game-thumbnail-1"),this.getResource("game-thumbnail-2"),this.getResource("game-thumbnail-3"),this.getResource("game-thumbnail-4")]},on:{onRestart:t.onClickRestart}}):t._e(),t._v(" "),i("instructions-panel",{ref:"loader",attrs:{active:t.instructionActive,onStart:t.onStart,title:t.t("gaming.game4_name"),legends:[t.t("gaming.game4_tuto1"),t.labelForDesktop("gaming.game4_tuto2","gaming.game4_tuto2_desktop"),t.t("gaming.game4_tuto3")],videos:["/assets/video/rules/game4-rule1.mp4","/assets/video/rules/game4-rule2.mp4","/assets/video/rules/game4-rule3.mp4"],posters:[this.getResource("poster-rule1"),this.getResource("poster-rule2"),this.getResource("poster-rule3")],background:this.getResource("game-preview"),logo:this.getResource("game-logo")}}),t._v(" "),t.isLoaded?i("PraiseCvs",{ref:"praise",staticClass:"praise-game-4"}):t._e()],1)};s._withStripped=!0;var a=i(239),o=i(27),n=i(47),r=i(230),h=i(217),l=i(219),c=i(76),m=i(487),u=i.n(m),d=i(488),p=i.n(d),g=i(489),v=i.n(g),f=i(490),P=i.n(f),x=i(492),w=i.n(x),y=i(493),b=i.n(y),M=i(494),S=i.n(M),C=i(495),_=i.n(C),T=i(496),z=i.n(T),R=i(497),A=i.n(R);c.a.debug=!1;class L{constructor(t){this.hasHighp=function(t){const e=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT);return t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0&&e.precision>0}(t.gl),this.programs=[this.particles=new c.a(t.gl),this.drop=new c.a(t.gl),this.ringDot=new c.a(t.gl),this.ringActive=new c.a(t.gl),this.background=new c.a(t.gl)],this.compile()}precision(){return this.hasHighp?"highp":"mediump"}compile(){let t="\n";t+="precision "+this.precision()+" float;\n",this.particles.compile(u()(),p()(),t),this.drop.compile(v()(),P()(),t),this.ringDot.compile(w()(),b()(),t),this.ringActive.compile(S()(),_()(),t),this.background.compile(z()(),A()(),t),this.process()}process(){for(const t of this.programs)t.use()}dispose(){for(const t of this.programs)t.dispose();this.programs=null}}var D=i(28),I=i(257),O=i(275),F=i(37),G=i(40),E=i(247),N=i(3),V=i(26),k=i(36),B=i(291),U=i(87);const q=["Game2_HDRI_3","Game2_HDRI_2","royal_esplanade_2k","EsteeLauder_Game4_Dev_v1_HDRI"];var H=class{constructor(t){this.EXPO=1.5,this.GAMMA=1.4,this.convertSH=t=>{this.shBase=new Float32Array(t,0,27),this.ibl.sh=E.a.convert(this.shBase,this.shMul)};const e=t.gl;this.scene=t,this.gl=e,this.envTex=new k.a(this.gl,this.gl.RGBA),this.envHi=new k.a(this.gl,this.gl.RGBA),this.envBg=new k.a(this.gl,this.gl.RGB),this.ibl=new O.a(this.envTex,this.envHi,this.envBg),this.envTex.setFilter(!1),this.lights=new B.a(t),this.lights.setup.add(this.ibl),this.shMul=1,this.gammaMode=new V.a("gammaMode",U.a),this.gamma=new N.d("gamma",1,N.d.ALL),this.exposure=new N.d("exposure",1,N.d.ALL),this.gammaMode.set("GAMMA_STD"),this.expoUniform=this.exposure.attachUniform("utmExpo"),this.gammaUniform=this.gamma.attachUniform("uTMGamma"),this.expoUniform.set(this.EXPO),this.gammaUniform.set(1/this.GAMMA)}setupMat(t){t.setLightSetup(this.lights.setup),t.iGamma.proxy(this.gamma),t.iExposure.proxy(this.exposure),t.gammaMode.proxy(this.gammaMode)}dispose(){this.envTex.dispose(),this.envHi.dispose(),this.envBg.dispose(),this.envTex=null,this.envHi=null,this.envBg=null,this.ibl=null,this.scene=null,this.shBase=null,this.shMul=1}async loadDefault(){return this.load("envs/"+q[0])}async load(t){return Promise.all([F.d(G.a.asset_url(t+"/env.png")).then(t=>this.envTex.fromImage(t)),F.c(G.a.asset_url(t+"/sh.bin")).then(this.convertSH)])}preRender(){this.lights.preRender()}},j=i(30),Y=i(82),X=i(1),Z=(X.mat4.create(),X.quat.create(),X.vec3.create(),X.vec3.create());X.vec3.create();function W(t,e,i){var s,a;t.touches&&t.touches[0]?(s=t.touches[0].clientX,a=t.touches[0].clientY):(s=t.clientX,a=t.clientY),i[0]=2*s/e.width-1,i[1]=-(2*a/e.height-1)}class J{constructor(t,e={}){this.onMouseWheel=t=>{var e=t.deltaY>0?1:-1;e*=this.wheelSpeed,this.dist+=e,this.dist=Math.max(this.minDist,Math.min(this.dist,this.maxDist))},this.onMouseDown=t=>{this.mouseButton1=!0,W(t,this.el,this.mouse),X.vec3.copy(this.mStartDrag,this.mouse)},this.onRightClick=t=>(t.preventDefault(),this.mouseButton2=!0,W(t,this.el,this.mouse),X.vec3.copy(this.panInitialX,[this.cam._matrix[0],this.cam._matrix[1],this.cam._matrix[2]]),X.vec3.copy(this.panInitialP,this.cam.position),this.panInitialY[0]=this.cam._matrix[4],this.panInitialY[1]=this.cam._matrix[5],this.panInitialY[2]=this.cam._matrix[6],X.vec3.copy(this.mStartDrag,this.mouse),!1),this.onMouseMove=t=>{this.mouseButton1&&(this.mouseButton2?this._pan(t):(W(t,this.el,this.mouse),this.mDrag[0]=this.mouse[0]-this.mStartDrag[0],this.mDrag[1]=this.mouse[1]-this.mStartDrag[1],X.vec3.copy(this.mStartDrag,this.mouse),this._drag[0]-=this.mDrag[0]*this.dragSpeed/4,this._drag[1]+=this.mDrag[1]*this.dragSpeed/4,this._drag[1]<=.001&&(this._drag[1]=.001),this._drag[1]>=Math.PI-.001&&(this._drag[1]=Math.PI-.001)))},this.onMouseUp=t=>{this.mouseButton1=!1,this.mouseButton2=!1},this._pan=t=>{W(t,this.el,this.mouse),this.mDrag[0]=this.mouse[0]-this.mStartDrag[0],this.mDrag[1]=this.mouse[1]-this.mStartDrag[1],X.vec3.copy(this.mStartDrag,this.mouse);var e=X.vec3.create();X.vec3.scale(e,this.panInitialX,-this.mDrag[0]*this.dragSpeed),X.vec3.scaleAndAdd(e,e,this.panInitialY,-this.mDrag[1]*this.dragSpeed),this.pan=e},this.el=t,this.rotateSpeed=e.rotateSpeed?e.rotateSpeed:30,this.wheelSpeed=e.wheelSpeed?e.wheelSpeed:.5,this.dragSpeed=e.dragSpeed?e.dragSpeed:30,this.dist=e.dist?e.dist:10,this.minDist=e.minDist?e.minDist:1,this.maxDist=e.maxDist?e.maxDist:100,this.center=e.center?e.center:X.vec3.fromValues(0,0,0),this._theta=e._theta?e._theta:0,this._phi=e._phi?e._phi:.5*Math.PI,this.mouseButton1=!1,this.mouseButton2=!1,this.mouse=X.vec3.fromValues(0,0,1),this.mStartDrag=X.vec3.fromValues(0,0,1),this.mDrag=X.vec3.fromValues(0,0,1),this.pan=X.vec3.fromValues(0,0,0),this.panInitialX=X.vec3.create(),this.panInitialY=X.vec3.create(),this.panInitialP=X.vec3.create(),this._drag=X.vec3.fromValues(this._theta,this._phi,1),this.cam=null}start(t){this.cam=t,this.el.addEventListener("mousemove",this.onMouseMove),this.el.addEventListener("touchmove",this.onMouseMove),this.el.addEventListener("touchstart",this.onMouseDown),this.el.addEventListener("mousedown",this.onMouseDown),this.el.addEventListener("mouseup",this.onMouseUp),this.el.addEventListener("touchend",this.onMouseUp),this.el.addEventListener("wheel",this.onMouseWheel),this.el.addEventListener("contextmenu",this.onRightClick),this.onMouseDown({clientX:0,clientY:0}),this.onMouseMove({clientX:0,clientY:0}),this.onMouseUp({clientX:0,clientY:0})}stop(){this.cam=null,this.el.removeEventListener("mousemove",this.onMouseMove),this.el.removeEventListener("touchmove",this.onMouseMove),this.el.removeEventListener("touchstart",this.onMouseDown),this.el.removeEventListener("mousedown",this.onMouseDown),this.el.removeEventListener("mouseup",this.onMouseUp),this.el.removeEventListener("touchend",this.onMouseUp),this.el.removeEventListener("wheel",this.onMouseWheel),this.el.removeEventListener("contextmenu",this.onRightClick)}update(t){if(this.cam){var e=this.dist,i=t*this.rotateSpeed;this._theta+=(this._drag[0]-this._theta)*i,this._phi+=(this._drag[1]-this._phi)*i,Z[0]=this.center[0]+e*Math.sin(this._phi)*Math.sin(this._theta),Z[1]=this.center[1]+e*Math.cos(this._phi),Z[2]=this.center[2]+e*Math.sin(this._phi)*Math.cos(this._theta),X.vec3.copy(this.cam.position,Z),X.vec3.add(this.cam.position,this.cam.position,this.pan),X.vec3.add(this.center,this.center,this.pan),this.pan=X.vec3.create(),this.cam.lookAt(this.center),this.cam.invalidate()}}}var $=i(242),Q=i(218);class K{constructor(t){this.debugActive=!1,this.scene=t,this.animated=this.createCamera(),this.debug=this.createCamera(),this.default=this.animated,this.cameraControls=new $.a(this.scene,this.debug),this.orbitController=new J(this.scene.ilayer,{dist:10,minDist:.5,maxDist:50,rotateSpeed:15,wheelSpeed:.15,dragSpeed:15,center:X.vec3.fromValues(0,0,0),_theta:0,_phi:1}),this.cameraControls.setControler(this.orbitController),this.scene.root.add(this.animated),this.scene.root.add(this.debug)}createCamera(){const t=new j.a(new Y.a);return t.lens.setVerticalFov(45*Q.a),t.lens.near=.1,t.lens.far=100,t.x=0,t.y=6,t.z=10,t.lookAt(X.vec3.fromValues(0,0,0)),t}preRender(){X.vec3.copy(this.animated.position,this.scene.game.state.camera.position),this.animated.lookAt(this.scene.game.state.camera.focusPosition),this.animated.invalidate(),this.cameraControls.preRender()}update(t,e){this.default.updateViewProjectionMatrix(t,e),this.debug.updateViewProjectionMatrix(t,e)}dispose(){this.cameraControls.setControler(null)}}var tt=i(232),et=i(234),it=i(243),st=i(246),at=i(279),ot=i(41);function nt(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}class rt{constructor(t){this.colorStartString="#243057",this.colorEndString="#030b1d",this.parallax=[.03,.01],this.uStarFrequency=1/30,this.uStarSize=.04,this.uGlowStrength=1.75,this.uTimeFrequency=1,this.game=t,this.glview=this.game.scene.glview,this.program=this.game.scene.programs.background,this.buffer=new ot.a(this.glview.gl),this.buffer.attrib("aPosition",2,this.glview.gl.FLOAT),this.buffer.attrib("aUv",2,this.glview.gl.FLOAT),this.data=new Float32Array(24),this.data[0]=-1,this.data[1]=-1,this.data[2]=0,this.data[3]=0,this.data[4]=-1,this.data[5]=1,this.data[6]=0,this.data[7]=1,this.data[8]=1,this.data[9]=1,this.data[10]=1,this.data[11]=1,this.data[12]=1,this.data[13]=1,this.data[14]=1,this.data[15]=1,this.data[16]=1,this.data[17]=-1,this.data[18]=1,this.data[19]=0,this.data[20]=-1,this.data[21]=-1,this.data[22]=0,this.data[23]=0,this.buffer.data(this.data),this.colorStart=nt(this.colorStartString),this.colorEnd=nt(this.colorEndString)}init(){}render(t){t.mask===l.a.OPAQUE&&t.pass===h.a.COLOR&&(this.program.use(),this.program.uResolution([this.glview.width,this.glview.height]),this.program.uTime(this.game.scene.time),this.program.uColorStart(this.colorStart),this.program.uColorEnd(this.colorEnd),this.program.uStarFrequency(this.uStarFrequency),this.program.uStarSize(this.uStarSize),this.program.uGlowStrength(this.uGlowStrength),this.program.uTimeFrequency(this.uTimeFrequency),this.program.uOffset([this.game.state.camera.position[0]*this.parallax[0],-this.game.state.camera.position[2]*this.parallax[1]]),this.buffer.bind(),this.buffer.attribPointer(this.program),this.buffer.drawTriangles())}dispose(){this.buffer.dispose()}}var ht=i(228),lt=i(16);class ct{constructor(t){this.fresnelPower=2,this.fresnelMultiplier=.5,this.perlinPositionFrequency=[1,3,1],this.perlinTimeFrequency=.3,this.perlinOffset=.9,this.perlinMultiplier=1.3,this.colorStartString="#ad8d5a",this.colorEndString="#fff7d1",this.glowMask=1,this.glowMultiplier=.5,this.game=t,this.root=new o.a,this.game.scene.root.add(this.root),this.program=this.game.scene.programs.drop,this.colorStart=nt(this.colorStartString),this.colorEnd=nt(this.colorEndString),this.resource=new ht.a("drop",G.a.asset_url("game-4/drop.gltf"),this.game.scene.gltfs),this.game.state.gotHardChoice.on(()=>{this.lightUp()}),this.game.state.gotBottle.on(()=>{this.lightUp()})}init(){this.primitive=this.resource.gltf.renderables[0].mesh.primitives[0],this.vao=this.primitive.getVao(this.program)}lightUp(){const t=this.glowMask;lt.b.to(this,.1,{glowMask:0,onComplete:()=>{lt.b.to(this,.8,{glowMask:t})}})}preRender(){X.vec3.copy(this.root.position,this.game.state.drop.position),this.root.invalidate()}render(t){const e=this.root._wmatrix,i=t.camera.getMVP(this.root._wmatrix);this.program.use(),this.program.uTime(this.game.scene.time),this.program.uM(e),this.program.uMVP(i),this.program.uCameraPosition(t.camera.position),this.program.uFresnelPower(this.fresnelPower),this.program.uFresnelMultiplier(this.fresnelMultiplier),this.program.uPerlinPositionFrequency(this.perlinPositionFrequency),this.program.uPerlinTimeFrequency(this.perlinTimeFrequency),this.program.uPerlinOffset(this.perlinOffset),this.program.uPerlinMultiplier(this.perlinMultiplier),this.program.uColorStart(this.colorStart),this.program.uColorEnd(this.colorEnd),this.program.uGlowMask(this.glowMask),this.program.uGlowMultiplier(this.glowMultiplier),this.vao.bind(),this.primitive.render(),this.vao.unbind()}dispose(){this.program.dispose(),this.vao.dispose()}}var mt=i(7),ut=i(498),dt=i.n(ut),pt=i(499),gt=i.n(pt);class vt extends mt.a{constructor(){super(!0,!0),this.dropPressure=0}setup(t){t.uDropPressure(this.dropPressure)}_genCode(t){t.add("vertex_warp",dt()()),t.add("pv",gt()())}_getHash(){return"pillarMorph"}}var ft=i(0);
/*!
 * paths 3.3.3
 * https://greensock.com
 *
 * Copyright 2008-2020, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/let Pt=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,xt=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/gi,wt=Math.PI/180,yt=(Math.PI,Math.sin),bt=Math.cos,Mt=Math.abs,St=Math.sqrt,Ct=(Math.atan2,t=>"number"==typeof t),_t=t=>Math.round(1e5*t)/1e5||0;function Tt(t,e,i,s,a,o,n,r,h){if(t===r&&e===h)return;i=Mt(i),s=Mt(s);let l=a%360*wt,c=bt(l),m=yt(l),u=Math.PI,d=2*u,p=(t-r)/2,g=(e-h)/2,v=c*p+m*g,f=-m*p+c*g,P=v*v,x=f*f,w=P/(i*i)+x/(s*s);w>1&&(i=St(w)*i,s=St(w)*s);let y=i*i,b=s*s,M=(y*b-y*x-b*P)/(y*x+b*P);M<0&&(M=0);let S=(o===n?-1:1)*St(M),C=S*(i*f/s),_=S*(-s*v/i),T=(t+r)/2+(c*C-m*_),z=(e+h)/2+(m*C+c*_),R=(v-C)/i,A=(f-_)/s,L=(-v-C)/i,D=(-f-_)/s,I=R*R+A*A,O=(A<0?-1:1)*Math.acos(R/St(I)),F=(R*D-A*L<0?-1:1)*Math.acos((R*L+A*D)/St(I*(L*L+D*D)));isNaN(F)&&(F=u),!n&&F>0?F-=d:n&&F<0&&(F+=d),O%=d,F%=d;let G,E=Math.ceil(Mt(F)/(d/4)),N=[],V=F/E,k=4/3*yt(V/2)/(1+bt(V/2)),B=c*i,U=m*i,q=m*-s,H=c*s;for(G=0;G<E;G++)v=bt(a=O+G*V),f=yt(a),R=bt(a+=V),A=yt(a),N.push(v-k*f,f+k*v,R+k*A,A-k*R,R,A);for(G=0;G<N.length;G+=2)v=N[G],f=N[G+1],N[G]=v*B+f*q+T,N[G+1]=v*U+f*H+z;return N[G-2]=r,N[G-1]=h,N}function zt(t){let e,i,s,a,o,n,r,h,l,c,m,u,d,p,g,v=(t+"").replace(xt,t=>{let e=+t;return e<1e-4&&e>-1e-4?0:e}).match(Pt)||[],f=[],P=0,x=0,w=v.length,y=0,b="ERROR: malformed path: "+t,M=function(t,e,i,s){c=(i-t)/3,m=(s-e)/3,r.push(t+c,e+m,i-c,s-m,i,s)};if(!t||!isNaN(v[0])||isNaN(v[1]))return console.log(b),f;for(e=0;e<w;e++)if(d=o,isNaN(v[e])?(o=v[e].toUpperCase(),n=o!==v[e]):e--,s=+v[e+1],a=+v[e+2],n&&(s+=P,a+=x),e||(h=s,l=a),"M"===o)r&&(r.length<8?f.length-=1:y+=r.length),P=h=s,x=l=a,r=[s,a],f.push(r),e+=2,o="L";else if("C"===o)r||(r=[0,0]),n||(P=x=0),r.push(s,a,P+1*v[e+3],x+1*v[e+4],P+=1*v[e+5],x+=1*v[e+6]),e+=6;else if("S"===o)c=P,m=x,"C"!==d&&"S"!==d||(c+=P-r[r.length-4],m+=x-r[r.length-3]),n||(P=x=0),r.push(c,m,s,a,P+=1*v[e+3],x+=1*v[e+4]),e+=4;else if("Q"===o)c=P+2/3*(s-P),m=x+2/3*(a-x),n||(P=x=0),P+=1*v[e+3],x+=1*v[e+4],r.push(c,m,P+2/3*(s-P),x+2/3*(a-x),P,x),e+=4;else if("T"===o)c=P-r[r.length-4],m=x-r[r.length-3],r.push(P+c,x+m,s+2/3*(P+1.5*c-s),a+2/3*(x+1.5*m-a),P=s,x=a),e+=2;else if("H"===o)M(P,x,P=s,x),e+=1;else if("V"===o)M(P,x,P,x=s+(n?x-P:0)),e+=1;else if("L"===o||"Z"===o)"Z"===o&&(s=h,a=l,r.closed=!0),("L"===o||Mt(P-s)>.5||Mt(x-a)>.5)&&(M(P,x,s,a),"L"===o&&(e+=2)),P=s,x=a;else if("A"===o){if(p=v[e+4],g=v[e+5],c=v[e+6],m=v[e+7],i=7,p.length>1&&(p.length<3?(m=c,c=g,i--):(m=g,c=p.substr(2),i-=2),g=p.charAt(1),p=p.charAt(0)),u=Tt(P,x,+v[e+1],+v[e+2],+v[e+3],+p,+g,(n?P:0)+1*c,(n?x:0)+1*m),e+=i,u)for(i=0;i<u.length;i++)r.push(u[i]);P=r[r.length-2],x=r[r.length-1]}else console.log(b);return e=r.length,e<6?(f.pop(),e=0):r[0]===r[e-2]&&r[1]===r[e-1]&&(r.closed=!0),f.totalPoints=y+e,f}function Rt(t){Ct(t[0])&&(t=[t]);let e,i,s,a,o="",n=t.length;for(i=0;i<n;i++){for(a=t[i],o+="M"+_t(a[0])+","+_t(a[1])+" C",e=a.length,s=2;s<e;s++)o+=_t(a[s++])+","+_t(a[s++])+" "+_t(a[s++])+","+_t(a[s++])+" "+_t(a[s++])+","+_t(a[s])+" ";a.closed&&(o+="z")}return o}
/*!
 * CustomEase 3.3.3
 * https://greensock.com
 *
 * @license Copyright 2008-2020, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/let At,Lt,Dt=()=>At||"undefined"!=typeof window&&(At=window.gsap)&&At.registerPlugin&&At,It=()=>{At=Dt(),At?(At.registerEase("_CE",Nt.create),Lt=1):console.warn("Please gsap.registerPlugin(CustomEase)")},Ot=t=>~~(1e3*t+(t<0?-.5:.5))/1e3,Ft=/[-+=\.]*\d+[\.e\-\+]*\d*[e\-\+]*\d*/gi,Gt=/[cLlsSaAhHvVtTqQ]/g,Et=function(t,e,i,s,a,o,n,r,h,l,c){let m,u=(t+i)/2,d=(e+s)/2,p=(i+a)/2,g=(s+o)/2,v=(a+n)/2,f=(o+r)/2,P=(u+p)/2,x=(d+g)/2,w=(p+v)/2,y=(g+f)/2,b=(P+w)/2,M=(x+y)/2,S=n-t,C=r-e,_=Math.abs((i-n)*C-(s-r)*S),T=Math.abs((a-n)*C-(o-r)*S);return l||(l=[{x:t,y:e},{x:n,y:r}],c=1),l.splice(c||l.length-1,0,{x:b,y:M}),(_+T)*(_+T)>h*(S*S+C*C)&&(m=l.length,Et(t,e,u,d,P,x,b,M,h,l,c),Et(b,M,w,y,v,f,n,r,h,l,c+1+(l.length-m))),l};class Nt{constructor(t,e,i){Lt||It(),this.id=t,this.setData(e,i)}setData(t,e){e=e||{};let i,s,a,o,n,r,h,l,c,m=(t=t||"0,0,1,1").match(Ft),u=1,d=[],p=[],g=e.precision||1,v=g<=1;if(this.data=t,(Gt.test(t)||~t.indexOf("M")&&t.indexOf("C")<0)&&(m=zt(t)[0]),i=m.length,4===i)m.unshift(0,0),m.push(1,1),i=8;else if((i-2)%6)throw"Invalid CustomEase";for(0==+m[0]&&1==+m[i-2]||((t,e,i)=>{i||0===i||(i=Math.max(+t[t.length-1],+t[1]));let s,a=-1*+t[0],o=-i,n=t.length,r=1/(+t[n-2]+a),h=-e||(Math.abs(+t[n-1]-+t[1])<.01*(+t[n-2]-+t[0])?(t=>{let e,i=t.length,s=1e20;for(e=1;e<i;e+=6)+t[e]<s&&(s=+t[e]);return s})(t)+o:+t[n-1]+o);for(h=h?1/h:-r,s=0;s<n;s+=2)t[s]=(+t[s]+a)*r,t[s+1]=(+t[s+1]+o)*h})(m,e.height,e.originY),this.segment=m,o=2;o<i;o+=6)s={x:+m[o-2],y:+m[o-1]},a={x:+m[o+4],y:+m[o+5]},d.push(s,a),Et(s.x,s.y,+m[o],+m[o+1],+m[o+2],+m[o+3],a.x,a.y,1/(2e5*g),d,d.length-1);for(i=d.length,o=0;o<i;o++)h=d[o],l=d[o-1]||h,h.x>l.x||l.y!==h.y&&l.x===h.x||h===l?(l.cx=h.x-l.x,l.cy=h.y-l.y,l.n=h,l.nx=h.x,v&&o>1&&Math.abs(l.cy/l.cx-d[o-2].cy/d[o-2].cx)>2&&(v=0),l.cx<u&&(l.cx?u=l.cx:(l.cx=.001,o===i-1&&(l.x-=.001,u=Math.min(u,.001),v=0)))):(d.splice(o--,1),i--);if(i=1/u+1|0,n=1/i,r=0,h=d[0],v){for(o=0;o<i;o++)c=o*n,h.nx<c&&(h=d[++r]),s=h.y+(c-h.x)/h.cx*h.cy,p[o]={x:c,cx:n,y:s,cy:0,nx:9},o&&(p[o-1].cy=s-p[o-1].y);p[i-1].cy=d[d.length-1].y-s}else{for(o=0;o<i;o++)h.nx<o*n&&(h=d[++r]),p[o]=h;r<d.length-1&&(p[o-1]=d[d.length-2])}return this.ease=t=>{let e=p[t*i|0]||p[i-1];return e.nx<t&&(e=e.n),e.y+(t-e.x)/e.cx*e.cy},this.ease.custom=this,this.id&&At.registerEase(this.id,this.ease),this}getSVGData(t){return Nt.getSVGData(this,t)}static create(t,e,i){return new Nt(t,e,i).ease}static register(t){At=t,It()}static get(t){return At.parseEase(t)}static getSVGData(t,e){let i,s,a,o,n,r,h,l,c,m,u=(e=e||{}).width||100,d=e.height||100,p=e.x||0,g=(e.y||0)+d,v=At.utils.toArray(e.path)[0];if(e.invert&&(d=-d,g=0),"string"==typeof t&&(t=At.parseEase(t)),t.custom&&(t=t.custom),t instanceof Nt)i=Rt(function(t,e,i,s,a,o,n){let r,h,l,c,m,u=t.length;for(;--u>-1;)for(r=t[u],h=r.length,l=0;l<h;l+=2)c=r[l],m=r[l+1],r[l]=c*e+m*s+o,r[l+1]=c*i+m*a+n;return t._dirty=1,t}([t.segment],u,0,0,-d,p,g));else{for(i=[p,g],h=Math.max(5,200*(e.precision||1)),o=1/h,h+=2,l=5/h,c=Ot(p+o*u),m=Ot(g+t(o)*-d),s=(m-g)/(c-p),a=2;a<h;a++)n=Ot(p+a*o*u),r=Ot(g+t(a*o)*-d),(Math.abs((r-m)/(n-c)-s)>l||a===h-1)&&(i.push(c,m),s=(r-m)/(n-c)),c=n,m=r;i="M"+i.join(",")}return v&&v.setAttribute("d",i),i}}Dt()&&At.registerPlugin(Nt),Nt.version="3.3.3";var Vt=i(78);window.gsap=lt.b,lt.b.registerPlugin(Nt);const kt=0,Bt=1,Ut=2,qt=0,Ht=1;class jt{constructor(){this.speed=X.vec3.create(),this.position=X.vec3.create(),this.target=X.vec3.create(),this.focusPosition=X.vec3.create(),this.offset=X.vec3.fromValues(0,4,10),this.acceleration=.1,this.dumping=.045}}class Yt{constructor(){this.hardChoice=!1}}class Xt{constructor(){this.x=0,this.y=20,this.z=0,this.radius=.5,this.horizontalDuration=.6,this.verticalTarget=.5,this.verticalSpeed=0,this.verticalAcceleration=1.4,this.verticalDumping=.19,this.verticalJumpSpeed=.5,this.gravity=-.03,this.state=kt,this.position=X.vec3.create(),this.previousPosition=X.vec3.create(),this.deltaPosition=X.vec3.create(),this.speedPosition=0}}class Zt{constructor(){this.position=X.vec3.create(),this.scale=0,this.activeRotation1=0,this.activeProgress1=0,this.dotTargetRotation1=0,this.activeRotation2=0,this.activeProgress2=0,this.dotTargetRotation2=0,this.dotRotation=0,this.dotSpeed=1}}class Wt{constructor(){this.active=!1,this.render=!1,this.position=X.vec3.create(),this.scale=X.vec3.fromValues(0,0,0)}}class Jt{constructor(t){this.drop=new Xt,this.ring=new Zt,this.bottle=new Wt,this.camera=new jt,this.pillarInterElevation=.5,this.pillarOutOffset=25,this.score=0,this.canJump=!1,this.maxLives=4,this.startedOnce=!1,this.lives=this.maxLives,this.difficulty=1,this.totalCounts=0,this.successiveCounts=0,this.sinceBottleCounts=0,this.livesWon=0,this.hasHardChoice=!1,this.sinceHardChoiceCounts=0,this.hardChoiceCounts=0,this.startTime=Date.now()/1e3,this.time=0,this.delta=1/60,this.timeScale=1,this.jumped=new Vt.a,this.started=new Vt.a,this.ended=new Vt.a,this.gotBottle=new Vt.a,this.showBottle=new Vt.a,this.hardChoiceAppears=new Vt.a,this.gotHardChoice=new Vt.a,this.keydown=t=>{"Space"!==t.code&&"Enter"!==t.code&&"ArrowUp"!==t.code||this.jump()},this.touchStart=()=>{this.game.scene.cameraManager.default!==this.game.scene.cameraManager.debug&&this.jump()},this.mouseDown=()=>{this.game.scene.cameraManager.default!==this.game.scene.cameraManager.debug&&this.jump()},this.game=t,this.currentPosition=X.vec3.create(),this.timeouts=[],this.pillars=[]}init(){window.addEventListener("keydown",this.keydown),this.game.scene.glview.canvas.addEventListener("touchstart",this.touchStart),this.game.scene.glview.canvas.addEventListener("mousedown",this.mouseDown)}start(){this.startedOnce?this.restart():this.realStart()}restart(){lt.b.to(this,1,{timeScale:1}),lt.b.to(this.game.scene.saturation,1,{amount:1});let t=0;for(const e of this.pillars)lt.b.to(e.position,.8,{1:e.position[1]-15,ease:ft.d.easeIn,delay:.6+.1*t}),t++;const e=window.setTimeout(()=>{this.timeouts=this.timeouts.filter(t=>t!==e),this.pillars=[]},2300);this.timeouts.push(e),lt.b.to(this.ring,.4,{scale:0,ease:ft.d.easeIn,delay:.6}),window.setTimeout(()=>{this.realStart()},2500)}realStart(){this.lives=this.maxLives,this.game.scene.data.gameState.health=this.lives,this.score=0,this.game.scene.data.gameState.score=this.score,this.totalCounts=0,this.successiveCounts=0,this.sinceBottleCounts=0,this.difficulty=1;const t=window.setTimeout(()=>{this.timeouts=this.timeouts.filter(e=>e!==t),this.canJump=!0},3e3);this.timeouts.push(t),this.started.emit();const e=X.vec3.clone(this.currentPosition);this.pillars.push({finalPosition:X.vec3.clone(e),position:e,current:!0}),this.currentPillar=this.pillars[0];const i=X.vec3.fromValues(this.currentPosition[0]+2.2,this.currentPosition[1]-this.pillarInterElevation,this.currentPosition[2]+1.3);this.pillars.unshift({finalPosition:X.vec3.clone(i),position:i,current:!1});const s=X.vec3.fromValues(this.currentPosition[0]-1.4,this.currentPosition[1]-2*this.pillarInterElevation,this.currentPosition[2]+2.6);this.pillars.unshift({finalPosition:X.vec3.clone(s),position:s,current:!1}),lt.b.fromTo(this.pillars[0].position,2,{1:this.pillars[0].position[1]+this.pillarOutOffset},{1:this.pillars[0].position[1],ease:ft.d.easeOut,delay:0}),lt.b.fromTo(this.pillars[1].position,2,{1:this.pillars[1].position[1]+this.pillarOutOffset},{1:this.pillars[1].position[1],ease:ft.d.easeOut,delay:.2}),lt.b.fromTo(this.pillars[2].position,2,{1:this.pillars[2].position[1]+this.pillarOutOffset},{1:this.pillars[2].position[1],ease:ft.d.easeOut,delay:.4});const a=-Math.abs(this.getTargetAngle()),o=window.setTimeout(()=>{this.timeouts=this.timeouts.filter(t=>t!==o),this.targetPillar1=this.addPillar(a)},2e3);this.timeouts.push(o),this.ring.dotTargetRotation1=a,this.resetDrop(1800);const n=window.setTimeout(()=>{this.timeouts=this.timeouts.filter(t=>t!==o),lt.b.to(this.ring,1,{activeProgress1:.4,ease:ft.d.easeInOut,delay:.2}),X.vec3.copy(this.ring.position,this.currentPosition),this.ring.activeRotation1=a,this.ring.dotRotation=0;const t=.5/(1+.5*Math.log(this.difficulty));lt.b.to(this.ring,t,{scale:1,ease:ft.c.easeOut})},2300);this.timeouts.push(n),this.camera.target[0]=this.currentPosition[0],this.camera.target[1]=this.currentPosition[1],this.camera.target[2]=this.currentPosition[2],this.startedOnce=!0}retry(){this.difficulty=Math.max(Math.floor(this.difficulty/2),1);const t=window.setTimeout(()=>{this.timeouts=this.timeouts.filter(e=>e!==t),this.canJump=!0},300);this.timeouts.push(t),this.resetDrop();const e=.5/(1+.5*Math.log(this.difficulty)),i=.4/(.5*this.difficulty);lt.b.to(this.ring,e,{activeProgress1:i,ease:ft.c.easeOut,delay:.8*e})}end(){lt.b.to(this.game.scene.saturation,1.2,{amount:0,delay:.3}),lt.b.to(this,1.2,{timeScale:.02,delay:.3});const t=window.setTimeout(()=>{this.timeouts=this.timeouts.filter(e=>e!==t),this.game.scene.data.gameState.ended=!0},900);this.timeouts.push(t),this.ended.emit()}jump(){if(!this.canJump)return;this.canJump=!1;const t=this.testAngle(this.ring.dotRotation,this.ring.activeRotation1,this.ring.activeProgress1),e=this.hasHardChoice&&this.testAngle(this.ring.dotRotation,this.ring.activeRotation2,this.ring.activeProgress2);t?this.jumpSuccess(2===t,!1):e?this.jumpSuccess(2===e,!0):this.jumpFail()}testAngle(t,e,i){const s=t%(2*Math.PI),a=e-i*Math.PI+Math.PI,o=e+i*Math.PI+Math.PI;return s>a-.1&&s<o+.1?Math.abs(s-(a+.5*(o-a)))<.1?2:1:0}jumpSuccess(t=!1,e=!1){const i=e?this.targetPillar2:this.targetPillar1;if(this.score+=e?100:t?30:10,this.game.scene.data.gameState.score=this.score,this.totalCounts++,this.successiveCounts++,this.sinceBottleCounts++,this.sinceHardChoiceCounts++,e){this.hardChoiceCounts++,this.difficulty=Math.max(Math.floor(.75*this.difficulty),1);const t=window.setTimeout(()=>{this.gotHardChoice.emit()},540);this.timeouts.push(t)}else this.difficulty++;this.jumped.emit(!0),this.drop.verticalTarget=i.finalPosition[1]+this.drop.radius,lt.b.set(this.drop,{x:this.drop.x,z:this.drop.z}),lt.b.to(this.drop,this.drop.horizontalDuration,{x:i.finalPosition[0],z:i.finalPosition[2]}),this.drop.verticalSpeed=this.drop.verticalJumpSpeed,this.drop.state=Bt,this.camera.target[0]=i.finalPosition[0],this.camera.target[1]=i.finalPosition[1],this.camera.target[2]=i.finalPosition[2];const s=this.getTargetAngle();if(this.currentPillar.current=!1,this.currentPillar=i,this.currentPillar.current=!0,X.vec3.copy(this.currentPosition,this.currentPillar.finalPosition),this.targetPillar1=this.addPillar(s),this.hasHardChoice&&!e&&lt.b.to(this.targetPillar2.position,1,{1:this.targetPillar2.finalPosition[1]-20,ease:ft.d.easeIn}),this.hasHardChoice=this.totalCounts>6&&this.sinceHardChoiceCounts>3&&Math.random()<.25/(1+.5*this.hardChoiceCounts),this.hasHardChoice&&(this.hardChoiceAppears.emit(),this.sinceHardChoiceCounts=0,this.targetPillar2=this.addPillar(-s,!0)),this.bottle.active){this.lives++,this.livesWon++;const t=window.setTimeout(()=>{this.game.scene.data.gameState.health=this.lives,this.gotBottle.emit()},540);this.timeouts.push(t),this.hideBottle(!0)}else this.hasHardChoice||this.tryAddingBottle();const a=.5/(1+.5*Math.log(this.difficulty));lt.b.killTweensOf(this.ring,"activeProgress1"),lt.b.killTweensOf(this.ring,"activeProgress2"),lt.b.to(this.ring,a,{activeProgress1:0,ease:ft.c.easeIn}),lt.b.to(this.ring,a,{activeProgress2:0,ease:ft.c.easeIn}),lt.b.to(this.ring,.7*a,{scale:0,ease:ft.c.easeIn,delay:.7*a});const o=window.setTimeout(()=>{this.timeouts=this.timeouts.filter(t=>t!==o),X.vec3.copy(this.ring.position,this.currentPosition),this.ring.dotTargetRotation1=s,this.ring.dotTargetRotation2=s,this.ring.activeRotation1=s,this.ring.activeRotation2=-s,lt.b.killTweensOf(this.ring,"activeProgress1,activeProgress2");const t=.4/(.5*this.difficulty);if(lt.b.to(this.ring,a,{activeProgress1:t,ease:ft.c.easeOut,delay:.6*a}),this.hasHardChoice){const t=.4/(.5*this.difficulty)*.5;lt.b.killTweensOf(this.ring,"activeProgress2"),lt.b.to(this.ring,a,{activeProgress2:t,ease:ft.c.easeOut,delay:.6*a+.15})}lt.b.to(this.ring,a,{scale:1,ease:ft.c.easeOut}),this.canJump=!0},1e3);this.timeouts.push(o)}getTargetAngle(){return(.8+.4*Math.random())*(Math.random()>.5?-1:1)}jumpFail(){if(this.hasHardChoice){const t=.5/(1+.5*Math.log(this.difficulty));lt.b.killTweensOf(this.ring,"activeProgress2"),lt.b.killTweensOf(this.targetPillar2.position,"1"),lt.b.to(this.ring,t,{activeProgress2:0,ease:ft.c.easeIn}),lt.b.to(this.targetPillar2.position,1,{1:this.targetPillar2.finalPosition[1]-20,ease:ft.d.easeIn})}const t=Math.random()*Math.PI*.3+(Math.random()<.5?Math.PI:0),e=2+1.5*Math.random();if(this.drop.verticalTarget=this.targetPillar1.finalPosition[1]-100,lt.b.set(this.drop,{x:this.drop.x,z:this.drop.z}),lt.b.to(this.drop,1.5*this.drop.horizontalDuration,{x:this.targetPillar1.finalPosition[0]+Math.cos(t)*e,z:this.targetPillar1.finalPosition[2]+Math.sin(t)*e}),this.drop.verticalSpeed=this.drop.verticalJumpSpeed,this.drop.state=Bt,this.bottle.active&&this.hideBottle(!1),this.lives--,this.game.scene.data.gameState.health=this.lives,this.successiveCounts=0,this.jumped.emit(!1),0===this.lives)this.end();else{lt.b.to(this.camera.target,.3,{0:this.targetPillar1.finalPosition[0],1:this.targetPillar1.finalPosition[1],2:this.targetPillar1.finalPosition[2],ease:ft.b.easeOut,onComplete:()=>{lt.b.to(this.camera.target,.5,{0:this.currentPillar.finalPosition[0],1:this.currentPillar.finalPosition[1],2:this.currentPillar.finalPosition[2],ease:ft.b.easeInOut})}});const t=window.setTimeout(()=>{this.timeouts=this.timeouts.filter(e=>e!==t),this.retry()},1e3);this.timeouts.push(t)}}resetDrop(t=0){if(this.drop.state=kt,this.drop.x=this.currentPosition[0],this.drop.y=this.currentPosition[1]+6.5,this.drop.z=this.currentPosition[2],this.drop.verticalTarget=this.currentPosition[1]+this.drop.radius,this.drop.verticalSpeed=0,t>0){const e=window.setTimeout(()=>{this.timeouts=this.timeouts.filter(t=>t!==e),this.drop.state=Bt},t);this.timeouts.push(e)}else this.drop.state=Bt}addPillar(t,e=!1){let i=t*(this.screenOrientation===qt?.7:.85);const s=new Yt;s.hardChoice=e,s.current=!1;let a=3+.2*this.difficulty;e&&(a=a*=2,i*=.75);const o=X.vec3.clone(this.currentPillar.finalPosition);o[0]+=Math.sin(i)*a,o[1]+=this.pillarInterElevation,o[2]-=Math.cos(i)*a;const n=X.vec3.clone(o);return lt.b.fromTo(n,e?.8:1,{1:this.currentPillar.finalPosition[1]+this.pillarOutOffset},{1:this.currentPillar.finalPosition[1]+.5,delay:e?1:0,ease:Nt.create("custom","M0,0 C0,0 0,1 1,1")}),s.finalPosition=o,s.position=n,this.pillars.push(s),this.pillars.length>6&&(this.pillars=this.pillars.slice(this.pillars.length-6)),s}tryAddingBottle(){this.lives>=this.maxLives||this.sinceBottleCounts<5||Math.random()>.125/(this.livesWon+1)||(this.sinceBottleCounts=0,X.vec3.copy(this.bottle.position,this.targetPillar1.finalPosition),lt.b.fromTo(this.bottle.scale,.5,{0:0,2:0},{0:1,2:1,delay:.8,ease:Nt.create("custom","M0,0 C0.126,0.382 0.266,0.938 0.424,1.086 0.616,1.266 0.818,1.001 1,1")}),lt.b.fromTo(this.bottle.scale,.65,{1:0},{1:1,delay:.8,ease:Nt.create("custom","M0,0 C0.126,0.382 0.266,0.938 0.424,1.086 0.616,1.266 0.818,1.001 1,1")}),this.bottle.render=!0,this.bottle.active=!0,this.showBottle.emit())}hideBottle(t){this.bottle.active=!1,t?(lt.b.fromTo(this.bottle.scale,.15,{0:1,2:1},{0:0,2:0,delay:.42,ease:"linear",onComplete:()=>{this.bottle.render=!1}}),lt.b.fromTo(this.bottle.scale,.1,{1:1},{1:0,delay:.42,ease:"linear"})):(lt.b.fromTo(this.bottle.scale,.5,{0:1,2:1},{0:0,2:0,delay:.3,ease:Nt.create("custom","M0,0 C0.142,0 0.394,-0.202 0.552,-0.054 0.744,0.126 1,1 1,1 ")}),lt.b.fromTo(this.bottle.scale,.65,{1:1},{1:0,delay:.3,ease:Nt.create("custom","M0,0 C0.142,0 0.394,-0.202 0.552,-0.054 0.744,0.126 1,1 1,1 ")}))}update(){this.screenOrientation=this.game.scene.glview.width<this.game.scene.glview.height?qt:Ht;const t=Date.now()/1e3-this.startTime;if(this.delta=t-this.time,this.time=t,this.delta>.2?this.delta=.2:this.delta<1/300&&this.delta,this.delta*=this.timeScale,this.drop.state!==kt){if(this.drop.state===Bt)this.drop.verticalSpeed+=this.drop.gravity*this.delta/(1/60);else if(this.drop.state===Ut){const t=this.drop.verticalTarget-this.drop.y;this.drop.verticalSpeed*=1-this.drop.verticalDumping*this.delta/(1/60),this.drop.verticalSpeed+=t*this.drop.verticalAcceleration*this.delta}this.drop.y+=this.drop.verticalSpeed,this.drop.state===Bt&&this.drop.y<this.drop.verticalTarget&&this.drop.deltaPosition[1]<-.01&&(this.drop.state=Ut)}this.drop.previousPosition=X.vec3.clone(this.drop.position),this.drop.position[0]=this.drop.x,this.drop.position[1]=this.drop.y,this.drop.position[2]=this.drop.z,X.vec3.sub(this.drop.deltaPosition,this.drop.position,this.drop.previousPosition),this.drop.speedPosition=Math.min(X.vec3.length(this.drop.deltaPosition),3),this.ring.dotRotation+=(1+2*Math.log(this.difficulty))*this.ring.dotSpeed*this.delta;const e=this.camera.target[0]-this.camera.focusPosition[0],i=this.camera.target[1]-this.camera.focusPosition[1],s=this.camera.target[2]-this.camera.focusPosition[2];this.camera.speed[0]+=e*this.camera.acceleration*this.delta,this.camera.speed[1]+=i*this.camera.acceleration*this.delta,this.camera.speed[2]+=s*this.camera.acceleration*this.delta,this.camera.speed[0]*=1-this.camera.dumping,this.camera.speed[1]*=1-this.camera.dumping,this.camera.speed[2]*=1-this.camera.dumping,this.camera.focusPosition[0]+=this.camera.speed[0],this.camera.focusPosition[1]+=this.camera.speed[1],this.camera.focusPosition[2]+=this.camera.speed[2],this.camera.position[0]=this.camera.focusPosition[0]+this.camera.offset[0]*(this.screenOrientation===qt?1.25:1),this.camera.position[1]=this.camera.focusPosition[1]+this.camera.offset[1]*(this.screenOrientation===qt?1.25:1),this.camera.position[2]=this.camera.focusPosition[2]+this.camera.offset[2]*(this.screenOrientation===qt?1.25:1)}dispose(){window.removeEventListener("keydown",this.keydown),this.game.scene.glview.canvas.removeEventListener("touchstart",this.touchStart),this.game.scene.glview.canvas.removeEventListener("mousedown",this.mouseDown);for(const t of this.timeouts)window.clearTimeout(t)}}class $t{constructor(t){this.game=t,this.resource=new ht.a("pillar",G.a.asset_url("game-4/pillar.gltf"),this.game.scene.gltfs)}init(){this.mainGltf=this.resource.gltf,this.game.scene.root.add(this.mainGltf.root),this.top=this.mainGltf.renderables[1],this.bottom=this.mainGltf.renderables[0],this.topMaterials=this.top.materials,this.bottomMaterials=this.bottom.materials,this.setMaterials()}setMaterials(){this.pillarChunk=new vt;for(const t of this.mainGltf.materials)t.materialPass.inputs.add(this.pillarChunk);for(const t of this.mainGltf.materials){const e=t.materialPass;e&&this.game.scene.iblMngr.setupMat(e)}}render(t){for(const e of this.game.state.pillars){const i=X.vec3.distance(this.game.state.drop.position,e.finalPosition);e.current&&this.game.state.drop.state!==Bt&&this.game.state.drop.position[1]-this.game.state.drop.radius<e.position[1]&&i<2?this.pillarChunk.dropPressure=this.game.state.drop.position[1]-this.game.state.drop.radius-e.finalPosition[1]:this.pillarChunk.dropPressure=0,X.vec3.copy(this.mainGltf.root.position,e.position),this.mainGltf.root.invalidate(),this.mainGltf.root.updateWorldMatrix(),e.hardChoice?this.top.materials=this.bottomMaterials:this.top.materials=this.topMaterials;for(const e of this.mainGltf.renderables)e.render(this.game.scene,t.camera,t.mask,t.pass)}if(0===this.game.state.pillars.length){this.mainGltf.root.position[0]=0,this.mainGltf.root.position[1]=0,this.mainGltf.root.position[2]=10,this.mainGltf.root.invalidate(),this.mainGltf.root.updateWorldMatrix();for(const e of this.mainGltf.renderables)e.render(this.game.scene,t.camera,t.mask,t.pass)}}dispose(){}}function Qt(){const t=.5*Math.random(),e=Math.random(),i=2*Math.PI*t,s=Math.acos(2*e-1);return{x:Math.sin(s)*Math.cos(i),y:Math.sin(s)*Math.sin(i),z:Math.cos(s)}}class Kt{}class te{constructor(t){this.maxCount=110,this.count=0,this.size=90,this.inertia=.04,this.gravityMin=.005,this.gravityMax=.01,this.glowColorString="#ffd0ae",this.glowStrength=1.5,this.game=t,this.gl=this.game.scene.gl,this.root=new o.a,this.game.scene.root.add(this.root),this.config=this.game.scene.glstate.config(),this.config.enableDepthTest(!0).depthMask(!1).enableBlend(!0).blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.program=this.game.scene.programs.particles,this.glowColor=nt(this.glowColorString),this.glowColor=this.glowColor.map(t=>t*this.glowStrength),this.vbuffer=new ot.a(this.gl),this.vbuffer.attrib("aLife",1,this.gl.FLOAT),this.vbuffer.attrib("aPosition",3,this.gl.FLOAT),this.vbuffer.attrib("aSize",1,this.gl.FLOAT),this.attributesSize=5,this.items=[];for(let t=0;t<this.maxCount;t++){const t=new Kt;t.x=0,t.y=0,t.z=0,t.inertiaX=0,t.inertiaY=0,t.inertiaZ=0,t.life=0,t.size=0,t.gravity=0,this.items.push(t)}this.game.state.gotHardChoice.on(()=>{this.explode()}),this.game.state.gotBottle.on(()=>{this.explode()})}init(){this.vdata=new Float32Array(this.maxCount*this.attributesSize),this.addParticle(),this.vbuffer.data(this.vdata)}addParticle(){const t=this.items.find(t=>t.life<=0);if(t&&!document.hidden){const e=Math.random()*Math.PI*2,i=this.game.state.drop.state===Bt?0:.5;t.x=this.game.state.drop.position[0]+Math.cos(e)*i,t.y=this.game.state.drop.position[1]+.2*(Math.random()-.5),t.z=this.game.state.drop.position[2]+Math.sin(e)*i,t.inertiaX=this.game.state.drop.deltaPosition[0]*this.inertia+.004*Math.cos(e),t.inertiaY=this.game.state.drop.deltaPosition[1]*this.inertia+.008*(Math.random()-.5),t.inertiaZ=this.game.state.drop.deltaPosition[2]*this.inertia+.004*Math.sin(e),t.life=1,t.size=20+Math.random()*(this.game.scene.glview.height/5)/this.game.scene.glview.pixelRatio,t.gravity=-(this.gravityMin+(this.gravityMax-this.gravityMin)*Math.random())}const e=this.game.state.drop.state===Bt?16:80;this.timeout=window.setTimeout(()=>{this.addParticle()},e)}explode(){let t=this.items.filter(t=>t.life<=0);t=t.slice(0,30);for(const e of t){const t=Qt();e.x=this.game.state.currentPillar.position[0]+.5*t.x,e.y=this.game.state.currentPillar.position[1]+.5*t.y,e.z=this.game.state.currentPillar.position[2]+.5*t.z,e.inertiaX=.04*t.x,e.inertiaY=.05*t.y+.08,e.inertiaZ=.04*t.z,e.life=1,e.size=20+Math.random()*(this.game.scene.glview.height/5)/this.game.scene.glview.pixelRatio,e.gravity=-(this.gravityMin+(this.gravityMax-this.gravityMin)*Math.random()),e.gravity*=20}}preRender(){let t=0;for(const e of this.items)e.life>0&&(e.life-=.4*this.game.state.delta,e.x+=e.inertiaX,e.y+=e.inertiaY,e.z+=e.inertiaZ,e.inertiaY+=e.gravity*this.game.state.delta),this.vdata[t+0]=e.life,this.vdata[t+1]=e.x,this.vdata[t+2]=e.y,this.vdata[t+3]=e.z,this.vdata[t+4]=e.size,t+=this.attributesSize;this.vbuffer.data(this.vdata)}render(t){const e=t.camera.getMVP(this.root._wmatrix),i=X.mat4.create();t.camera.modelViewMatrix(i,this.root._wmatrix),this.program.use(),this.program.uMVP(e),this.program.uMV(i),this.program.uColor(this.glowColor),this.vbuffer.bind(),this.vbuffer.attribPointer(this.program),this.config.apply(),this.vbuffer.drawPoints()}dispose(){this.vbuffer.dispose(),window.clearTimeout(this.timeout)}}class ee{constructor(t){this.activeGrow2=0,this.defaultGlowColorString="#ffd0ae",this.defaultGlowStrength=1.75,this.hardGlowColorString="#ff8630",this.hardGlowStrength=2.2,this.activeProgress=0,this.game=t,this.gl=this.game.scene.gl,this.dotProgram=this.game.scene.programs.ringDot,this.activeProgram=this.game.scene.programs.ringActive,this.dotTargetProgram=this.game.scene.programs.ringDot,this.config=this.game.scene.glstate.config(),this.config.enableDepthTest(!0).depthMask(!0).enableBlend(!0).blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.defaultGlowColor=nt(this.defaultGlowColorString),this.defaultGlowColor=this.defaultGlowColor.map(t=>t*this.defaultGlowStrength),this.hardGlowColor=nt(this.hardGlowColorString),this.hardGlowColor=this.hardGlowColor.map(t=>t*this.hardGlowStrength),this.baseResource=new ht.a("ringBase",G.a.asset_url("game-4/ringBase.gltf"),this.game.scene.gltfs),this.activeResource=new ht.a("ringActive",G.a.asset_url("game-4/ringActive.gltf"),this.game.scene.gltfs),this.dotResource=new ht.a("ringDot",G.a.asset_url("game-4/ringDot.gltf"),this.game.scene.gltfs),this.growInterval=window.setInterval(()=>{lt.a.to(this,.1,{activeGrow2:.02,onComplete:()=>{lt.a.to(this,.25,{activeGrow2:0})}})},710)}init(){this.mainNode=new o.a,this.game.scene.root.add(this.mainNode),this.baseGltf=this.baseResource.gltf,this.mainNode.add(this.baseGltf.root),this.activeNode1=new o.a,this.mainNode.add(this.activeNode1),this.activePrimitive1=this.activeResource.gltf.renderables[0].mesh.primitives[0],this.activeVao1=this.activePrimitive1.getVao(this.activeProgram),this.activeNode2=new o.a,this.mainNode.add(this.activeNode2),this.activePrimitive2=this.activeResource.gltf.renderables[0].mesh.primitives[0],this.activeVao2=this.activePrimitive2.getVao(this.activeProgram),this.dotNode=new o.a,this.mainNode.add(this.dotNode),this.dotPrimitive=this.dotResource.gltf.renderables[0].mesh.primitives[0],this.dotVao=this.dotPrimitive.getVao(this.dotProgram),this.dotTargetNode=new o.a,this.mainNode.add(this.dotTargetNode),this.dotTargetPrimitive=this.dotResource.gltf.renderables[0].mesh.primitives[0],this.dotTargetVao=this.dotTargetPrimitive.getVao(this.dotTargetProgram),this.setMaterials()}setMaterials(){for(const t of this.baseGltf.materials){const e=t.materialPass;e&&this.game.scene.iblMngr.setupMat(e)}}preRender(){this.mainNode.position[0]=this.game.state.ring.position[0],this.mainNode.position[1]=this.game.state.ring.position[1],this.mainNode.position[2]=this.game.state.ring.position[2],this.mainNode.scale[0]=this.game.state.ring.scale,this.mainNode.scale[1]=this.game.state.ring.scale,this.mainNode.scale[2]=this.game.state.ring.scale,this.mainNode.invalidate(),this.activeNode1.rotation.set([0,0,0,1]),this.activeNode1.rotateY(-this.game.state.ring.activeRotation1+Math.PI),this.activeNode2.rotation.set([0,0,0,1]),this.activeNode2.rotateY(-this.game.state.ring.activeRotation2+Math.PI),this.dotNode.rotation.set([0,0,0,1]),this.dotNode.rotateY(-this.game.state.ring.dotRotation+Math.PI),this.dotTargetNode.rotation.set([0,0,0,1]),this.dotTargetNode.rotateY(-this.game.state.ring.dotTargetRotation1)}render(t){const e=X.mat4.create();t.camera.modelViewProjectionMatrix(e,this.dotNode._wmatrix),this.dotProgram.use(),this.dotProgram.uMVP(e),this.dotProgram.uColor(this.defaultGlowColor),this.dotProgram.uAlpha(1),this.dotVao.bind(),this.dotPrimitive.render(),this.dotVao.unbind(),this.game.state.totalCounts<3&&(this.config.apply(),t.camera.modelViewProjectionMatrix(e,this.dotTargetNode._wmatrix),this.dotTargetProgram.use(),this.dotTargetProgram.uMVP(e),this.dotTargetProgram.uColor(this.defaultGlowColor),this.dotTargetProgram.uAlpha(.4*Math.sin(18*this.game.scene.time)+.4),this.dotTargetVao.bind(),this.dotTargetPrimitive.render(),this.dotTargetVao.unbind()),this.game.state.ring.activeProgress1>0&&(t.camera.modelViewProjectionMatrix(e,this.activeNode1._wmatrix),this.activeProgram.use(),this.activeProgram.uMVP(e),this.activeProgram.uProgress(this.game.state.ring.activeProgress1),this.activeProgram.uColor(this.defaultGlowColor),this.activeProgram.uGrow(0),this.activeVao1.bind(),this.activePrimitive1.render(),this.activeVao1.unbind()),this.game.state.ring.activeProgress2>0&&(t.camera.modelViewProjectionMatrix(e,this.activeNode2._wmatrix),this.activeProgram.use(),this.activeProgram.uMVP(e),this.activeProgram.uProgress(this.game.state.ring.activeProgress2),this.activeProgram.uColor(this.hardGlowColor),this.activeProgram.uGrow(this.activeGrow2),this.activeVao2.bind(),this.activePrimitive2.render(),this.activeVao2.unbind());for(const e of this.baseGltf.renderables)e.render(this.game.scene,t.camera,t.mask,t.pass)}dispose(){window.clearInterval(this.growInterval)}}class ie{constructor(t){this.game=t,this.baseResource=new ht.a("bottle",G.a.asset_url("game-4/bottle.gltf"),this.game.scene.gltfs)}init(){this.mainNode=new o.a,this.game.scene.root.add(this.mainNode),this.baseGltf=this.baseResource.gltf,this.mainNode.add(this.baseGltf.root),this.setMaterials()}setMaterials(){for(const t of this.baseGltf.materials){const e=t.materialPass;e&&this.game.scene.iblMngr.setupMat(e)}}preRender(){this.mainNode.invalidate(),X.vec3.copy(this.mainNode.position,this.game.state.bottle.position),X.vec3.copy(this.mainNode.scale,this.game.state.bottle.scale)}render(t){if(this.game.state.bottle.render)for(const e of this.baseGltf.renderables)e.render(this.game.scene,t.camera,t.mask,t.pass)}dispose(){}}var se=i(38);const ae=["RING_APPEARS","BALL_FALL","BALL_JUMP","BALL_LAND","BOTTLE_APPEARS","BOTTLE_CATCH","GOLDEN_DROPPER","HYPE_WORDS-V2","INTRO","MUSIC_LOOP","PERFECT_LANDING"];class oe{constructor(t){this.game=t,this.lowPassConnected=!1,this._lowpass=0,this.sounds={},this.group=this.game.scene.audioResources,this.context=this.group.audioModule.context,this.masterDest=this.group.audioModule.masterNode,this.masterGain=this.context.createGain(),this.masterGain.connect(this.masterDest),this.lowpassFilter=this.context.createBiquadFilter(),this.lowpassFilter.type="lowpass",this.lowpassFilter.frequency.value=2e3,this.lowpassMaxFreq=this.context.sampleRate/2,this.load()}init(){for(const t of ae){const e=this.group.get(t);e.output=this.masterGain,this.sounds[t]=e}this.game.state.jumped.on(t=>{this.play("BALL_JUMP"),t?(window.setTimeout(()=>{this.play("BALL_LAND")},500),window.setTimeout(()=>{this.play("RING_APPEARS")},1100)):window.setTimeout(()=>{this.play("BALL_FALL")},250)}),this.game.state.started.on(t=>{lt.a.to(this,.4,{lowpass:0}),window.setTimeout(()=>{this.play("INTRO")},300),window.setTimeout(()=>{this.play("BALL_LAND")},1950),window.setTimeout(()=>{this.play("RING_APPEARS")},2450)}),this.game.state.ended.on(t=>{window.setTimeout(()=>{lt.a.to(this,.4,{lowpass:1})},900)}),this.game.state.showBottle.on(t=>{window.setTimeout(()=>{this.play("BOTTLE_APPEARS")},750)}),this.game.state.gotBottle.on(t=>{this.play("BOTTLE_CATCH")}),this.game.state.gotHardChoice.on(t=>{this.play("PERFECT_LANDING")}),this.game.state.hardChoiceAppears.on(t=>{window.setTimeout(()=>{this.play("GOLDEN_DROPPER")},1050)})}load(){for(const t of ae)new se.a(t,"game-4/G4_"+t,this.group)}start(){this.soundtrack||(this.soundtrack=this.play("MUSIC_LOOP",.8,!0),this.soundtrack.node.loopStart=11.486,this.soundtrack.node.loopEnd=74.352)}play(t,e=1,i=!1){return this.sounds[t].play(e,i)}fade(t,e=1,i=0){lt.a.to(t.gain.gain,{duration:e,value:i})}setLowPassActve(t){this.lowPassConnected!=t&&(this.lowPassConnected=t,this.masterGain.disconnect(),this.lowpassFilter.disconnect(),t?(this.masterGain.connect(this.lowpassFilter),this.lowpassFilter.connect(this.masterDest)):this.masterGain.connect(this.masterDest))}set lowpass(t){this._lowpass=Object(Q.d)(t),this.setLowPassActve(t>0);const e=Math.pow(this._lowpass,.2);this.lowpassFilter.frequency.value=this.lowpassMaxFreq*(1-.96*e),this.masterGain.gain.value=1-.6*this._lowpass}get lowpass(){return this._lowpass}dispose(){this.soundtrack&&(this.fade(this.soundtrack,1,0),this.soundtrack.node.loop=!1);for(const t in this.sounds){this.sounds[t].dispose()}this.masterGain.disconnect(),this.lowpassFilter.disconnect()}}class ne{constructor(t){this.scene=t,this.state=new Jt(this),this.background=new rt(this),this.pillars=new $t(this),this.drop=new ct(this),this.ring=new ee(this),this.bottle=new ie(this),this.particles=new te(this),this.audio=new oe(this)}onLoaded(){this.background.init(),this.pillars.init(),this.drop.init(),this.ring.init(),this.bottle.init(),this.state.init(),this.particles.init(),this.audio.init()}enter(){this.state.start(),this.audio.start()}leave(){}restart(){this.state.start()}preRender(){this.state.update(),this.drop.preRender(),this.ring.preRender(),this.bottle.preRender(),this.particles.preRender()}render(t){this.background.render(t),this.pillars.render(t),this.drop.render(t),this.ring.render(t),this.bottle.render(t),this.particles.render(t)}dispose(){this.background.dispose(),this.pillars.dispose(),this.drop.dispose(),this.ring.dispose(),this.bottle.dispose(),this.particles.dispose(),this.state.dispose(),this.audio.dispose()}}function re(t,e,i){return{maxDpr:t,fxaa:e,post:i}}const he=[re(2,!0,!0),re(1.5,!0,!0),re(1.5,!1,!0),re(1,!1,!0),re(1,!1,!1)];function le(t){return new Promise(e=>setTimeout(e,t))}function ce(){return performance.now()/1e3}class me{constructor(){this._running=!1,this.lastFrameTime=-1,this.startTime=-1,this.record=[],this.onRaf=()=>{if(!this._running)return;const t=ce();if(this.lastFrameTime>0&&this.record.push(t-this.lastFrameTime),this.lastFrameTime=t,t-this.startTime>this._sampleDuration)return this._defer.resolve(this.getResult()),void this._stop();requestAnimationFrame(this.onRaf)}}start(t=1){if(!this._running)return this._sampleDuration=t,this._defer=new D.a,this.startTime=ce(),this._running=!0,requestAnimationFrame(this.onRaf),this._defer.promise}stop(){this._defer.reject("stopped"),this._stop()}_stop(){this._defer=null,this._running=!1,this.record.length=0}getResult(){let t=0;const e=this.record;for(let i=0;i<e.length;i++){t+=e[i]}t/=e.length;let i=0,s=0;for(let a=0;a<e.length;a++){const o=e[a],n=o/t;n>.25&&n<4&&(i+=o,s++)}return i/=s,{meanFrame:i}}}class ue{constructor(t){this.scene=t,this._currentLevel=0,this._forceQuality=!1,this._debugLevel=1,this.level=0}async startAutoLevel(t){const e=new me;for(await le(1e3);;){let i=await e.start();if(t.signal.aborted)throw"";if(console.log("fps "+1/i.meanFrame),!(i.meanFrame>.02))return;if(!this.reduceQuality())return;await le(200)}}set level(t){t<0||t>=he.length||(this._currentLevel=t,this._applyLevel())}get level(){return this._currentLevel}reduceQuality(){return!(this.level>=he.length-1)&&(this.level++,console.log("reduced quality to "+this.level),!0)}_applyLevel(){let t=he[this._currentLevel];this.scene.maxDpr=t.maxDpr,this.scene.enableFxaa=t.fxaa,this.scene.postProcess.enabled=t.post}}var de=i(514),pe=i(241);class ge{constructor(t,e,i){this.enableFxaa=!0,this.maxDpr=2,this.preCompileMats=()=>(this.iblMngr.lights.setup.prepare(this.gl),this.matlib.compileAllAsync()),this.onLoaded=()=>{this.game.onLoaded(),this.loaded=!0},this.data=t,this.resources=e,this.audioResources=i,this.dt=0,this.time=0,this.ratio=1,this.ilayer=null,this.loaded=!1}enter(){this.game.enter(),this.quality.startAutoLevel(this.mainCTS)}leave(){this.game.leave()}restart(){this.game.restart()}attachResources(t){}init(t){this.loaddefer=new D.a,this.mainCTS=new de.a,this.glview=t,this.gl=this.glview.gl,this.glstate=new a.a(this.gl),this.quad=new r.a(this.gl),this.inputs=new tt.a(this.ilayer),this.postProcess=new et.a(this,"games"),this.matlib=new I.a(this),this.iblMngr=new H(this),this.fxaa=new st.a(this.gl),this.quality=new ue(this),this.sroot=new o.a,this.root=new o.a,this.envRotation=0,this.sroot.add(this.root),this.cameraManager=new K(this),this.camera=this.cameraManager.default,this.gltfs=new pe.a("gltfs",this.gl,this.resources),this.programs=new L(this),this.game=new ne(this),this.setupPostProcess(),this.inputs.start()}setupPostProcess(){this.postProcess.enabled=!0;const t=new it.a;t.scatter=.69,t.clamp=20,t.threshold=1.6;t.color.set([7,7,7]),this.postProcess.addEffect(t),this.saturation=new at.a(1),this.postProcess.addEffect(this.saturation)}render(t){this.loaded&&!this.data.gameState.paused&&(this.dt=t,this.time+=t,this.drawScene(this.cameraManager.default))}drawScene(t,e=null,i=!1){const s=this.maxDpr,a=this.gl,o=e?e.width:this.glview.width,n=e?e.height:this.glview.height;let r,c;this.postProcess.enabled?(r=e?e.width:this.glview.canvasWidth*s,c=e?e.height:this.glview.canvasHeight*s):(r=o,c=n),this.ratio=r/c,this.game.preRender(),this.cameraManager.preRender(),this.iblMngr.preRender(),this.root.rotation.set([0,0,0,1]),this.root.rotateY(this.envRotation),this.sroot.updateWorldMatrix(),this.cameraManager.update(r,c),this.iblMngr.lights.setup.prepare(a),this.renderLightmaps(),this.glstate.apply();const m=nt("#0f182a");a.clearColor(m[0],m[1],m[2],1),this.fxaa.resize(r,c),this.postProcess.preRender(r,c),this.postProcess.bindColor(),this.game.render({camera:t,mask:l.a.OPAQUE,pass:h.a.COLOR}),this.glstate.apply(),this.enableFxaa?(this.postProcess.render(this.fxaa.fbo),a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,o,n),this.fxaa.render()):(a.viewport(0,0,o,n),this.postProcess.render(void 0,o,n))}renderLightmaps(){const t=this.gl,e=this.iblMngr.lights,i=(e.depthPass,this.glstate),s="D_RGB"===this.iblMngr.lights.setup.depthFormat.value(),a=(new n.c).enableCullface(!0).enableDepthTest(!0).depthMask(!0).colorMask(s,s,s,s);for(const s of e.list)s._castShadows&&(s.bindShadowmap(),t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),i.push(a),this.game.render({camera:s._camera,mask:l.a.SHADOW_CASTER,pass:h.a.DEPTH}),i.pop());i.apply()}handleResize(){}async load(){await this.iblMngr.load("envs/Game4_HDRI_1"),await this.preCompileMats()}async dispose(){var t,e,i,s,a,o;null===(t=this.mainCTS)||void 0===t||t.abort(),this.mainCTS=null,null===(e=this.programs)||void 0===e||e.dispose(),null===(i=this.cameraManager)||void 0===i||i.dispose(),null===(s=this.inputs)||void 0===s||s.release(),null===(a=this.matlib)||void 0===a||a.dispose(),null===(o=this.game)||void 0===o||o.dispose();const n=this.glview.gl,r=n.getParameter(n.MAX_VERTEX_ATTRIBS);for(let t=0;t<r;t++)n.disableVertexAttribArray(t)}}var ve=i(83),fe=i(18),Pe=i(249),xe=i(6);class we extends ve.a{constructor(){super(),this.name="Game 4",this.data.gameState=Object(Pe.d)(new Pe.e,new Pe.c,new Pe.a),this.data.gameState.gameId=xe.a.GAME_4,this.resetState()}resetState(){this.data.gameState.health=4,this.data.gameState.score=0}restart(){this.resetState(),this._scene.restart()}init(t){super.init(t),this._scene=new ge(this.data,this.resources,this.audioResources);let e=window.innerWidth>=768?"desktop":"mobile";new fe.a("game-preview",i(125)("./bg-stars-"+e+".jpg"),this.preloadedResources),new fe.a("game-logo",i(500),this.preloadedResources),new fe.a("poster-rule1",i(501),this.preloadedResources),new fe.a("poster-rule2",i(502),this.preloadedResources),new fe.a("poster-rule3",i(503),this.preloadedResources),new fe.a("share-push",i(126),this.resources),new fe.a("share-product",i(250),this.resources),new fe.a("share-game",i(504)("./share-challenge-game-4-"+e+".png"),this.resources),new fe.a("share-game-canvas",i(507),this.resources),new fe.a("game-thumbnail-1",i(121),this.resources),new fe.a("game-thumbnail-2",i(122),this.resources),new fe.a("game-thumbnail-3",i(123),this.resources),new fe.a("game-thumbnail-4",i(124),this.resources),new se.a("INSIDE_PORTAL_MAIN_LOOP","main/INSIDE_PORTAL_MAIN_LOOP",this.audioResources);for(let t=0;t<43;t++)new fe.a("praise-amazing-"+t,`/assets/img/game-4/amazing/Cheering_All_Isolated_Cropped_00${325+t}.png`,this.resources);for(let t=0;t<43;t++)new fe.a("praise-beautiful-"+t,`/assets/img/game-4/beautiful/Cheering_All_Isolated_Cropped_00${325+t}.png`,this.resources);for(let t=0;t<43;t++)new fe.a("praise-wow-"+t,`/assets/img/game-4/wow/Cheering_All_Isolated_Cropped_00${325+t}.png`,this.resources)}onLoaded(){this.playIntroGameLoop()}playIntroGameLoop(){this.gameMusicLoop=this.audioResources.get("INSIDE_PORTAL_MAIN_LOOP").play(1,!0),this.gameMusicLoop.node.loopStart=1,this.gameMusicLoop.node.loopEnd=11}stopIntroGameLoop(){lt.a.to(this.gameMusicLoop.gain.gain,{duration:1,value:0,onComplete:()=>{this.gameMusicLoop.dispose(),this.gameMusicLoop=null}})}getSprites(t){return this.resources.getResources(new RegExp(`^${t}[-_][0-9]+.`),!0)}async leave(){let t=null;return this.gameMusicLoop&&(t=new Promise(t=>{lt.a.to(this.gameMusicLoop.gain.gain,{duration:1,value:0,onComplete:()=>{t()}})})),Promise.all([t,super.leave()]).then(()=>{this.dispose()})}dispose(){var t;null===(t=this.gameMusicLoop)||void 0===t||t.dispose(),this.gameMusicLoop=null}}var ye=i(39),be=i(84),Me=i(251),Se=i(252),Ce=i(254),_e=i(253),Te=i(255);const ze=Object(be.a)(we);var Re={_module:ze,mixins:[ze,ye.a,Me.a],components:{Scoreboard:Se.a,ScoreUi:Ce.a,InstructionsPanel:_e.a,PraiseCvs:Te.a},data:()=>({isLoaded:!1,isStarted:!1,instructionActive:!1,finalScore:0,praiseImages:[],praise:{step:200,audioDelay:0}}),watch:{"$data.gameState.ended":"onEnded"},methods:{preparePraise(){const t=this.getModule();this.$refs.praise.addSprites(t.getSprites("praise-wow")),this.$refs.praise.addSprites(t.getSprites("praise-beautiful")),this.$refs.praise.addSprites(t.getSprites("praise-amazing"))},onPraiseRequest(){this.$refs.praise.play()},onPraiseAudioRequest(){this.getModule().getScene().game.audio.play("HYPE_WORDS-V2")}}},Ae=i(5),Le=Object(Ae.a)(Re,s,[],!1,null,null,null);Le.options.__file="src/modules/game4/Game4.vue";e.default=Le.exports}}]);